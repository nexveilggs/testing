
local QuantumFlex = {
    _VERSION = "2.0.0",
    _AUTHOR = "Flexa",
    _DESCRIPTION = "Professional UI Library for Roblox Executors",

    Windows = {},
    Notifications = {},
    Themes = {},
    Config = {},
    Cache = {},
    Connections = {},

    Settings = {
        TooltipDelay = 0.5,
        NotificationDuration = 3,
        AnimationSpeed = 0.3,
        SaveConfiguration = true,
        ConfigurationFolder = "QuantumFlex",
        BlurIntensity = 25,
        TransparencyEnabled = true,
        RainbowSpeed = 5,
        FPSLimit = 60,
        PerformanceMode = false
    }
}

QuantumFlex.__index = QuantumFlex



local Services = setmetatable({}, {
    __index = function(self, serviceName)
        local service = game:GetService(serviceName)
        rawset(self, serviceName, service)
        return service
    end
})

local TweenService = Services.TweenService
local UserInputService = Services.UserInputService
local RunService = Services.RunService
local Players = Services.Players
local HttpService = Services.HttpService
local TextService = Services.TextService
local StarterGui = Services.StarterGui
local CoreGui = Services.CoreGui
local Lighting = Services.Lighting


local function GetCoreGui()
    local success, result = pcall(function()
        return CoreGui
    end)
    
    if success then
        return result
    else
        return Players.LocalPlayer:WaitForChild("PlayerGui")
    end
end

local GuiParent = GetCoreGui()


local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera
local Viewport = Camera.ViewportSize


local DeviceType = {
    Mobile = false,
    Tablet = false,
    Desktop = false,
    Console = false
}

local function DetectDevice()
    local viewportX = Viewport.X
    
    if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
        if viewportX < 600 then
            DeviceType.Mobile = true
            return "Mobile"
        elseif viewportX >= 600 and viewportX < 1024 then
            DeviceType.Tablet = true
            return "Tablet"
        end
    elseif UserInputService.GamepadEnabled then
        DeviceType.Console = true
        return "Console"
    else
        DeviceType.Desktop = true
        return "Desktop"
    end
    
    DeviceType.Desktop = true
    return "Desktop"
end

local CurrentDevice = DetectDevice()
local IsMobile = DeviceType.Mobile or DeviceType.Tablet
local IsPC = DeviceType.Desktop

Viewport = Camera.ViewportSize
Camera:GetPropertyChangedSignal("ViewportSize"):Connect(function()
    Viewport = Camera.ViewportSize
    CurrentDevice = DetectDevice()
end)

local ThemeManager = {}
ThemeManager.__index = ThemeManager

function ThemeManager.new()
    local self = setmetatable({}, ThemeManager)
    self.Themes = {}
    self.CurrentTheme = nil
    return self
end

QuantumFlex.Themes = {
    DarkFlex = {
        Name = "Dark Flex",
        Author = "Quantum",

        Primary = Color3.fromRGB(15, 15, 20),
        Secondary = Color3.fromRGB(20, 20, 28),
        Tertiary = Color3.fromRGB(25, 25, 35),
        Quaternary = Color3.fromRGB(30, 30, 40),

        Accent = Color3.fromRGB(138, 43, 226),
        AccentHover = Color3.fromRGB(155, 65, 240),
        AccentPressed = Color3.fromRGB(120, 30, 200),
        AccentDisabled = Color3.fromRGB(100, 30, 150),
        

        TextPrimary = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(180, 180, 190),
        TextTertiary = Color3.fromRGB(130, 130, 140),
        TextDisabled = Color3.fromRGB(80, 80, 90),
        TextAccent = Color3.fromRGB(138, 43, 226),
        
        
        Border = Color3.fromRGB(40, 40, 50),
        BorderHover = Color3.fromRGB(60, 60, 70),
        BorderActive = Color3.fromRGB(138, 43, 226),
        Stroke = Color3.fromRGB(255, 255, 255),
        StrokeTransparency = 0.8,
        

        Success = Color3.fromRGB(46, 204, 113),
        Warning = Color3.fromRGB(241, 196, 15),
        Error = Color3.fromRGB(231, 76, 60),
        Info = Color3.fromRGB(52, 152, 219),
        

        Glow = Color3.fromRGB(138, 43, 226),
        Shadow = Color3.fromRGB(0, 0, 0),
        Overlay = Color3.fromRGB(0, 0, 0),
        Highlight = Color3.fromRGB(255, 255, 255),

        BackgroundTransparency = 0.3,
        ElementTransparency = 0.2,
        HoverTransparency = 0.15,
        PressedTransparency = 0.1,
        OverlayTransparency = 0.7,
        DisabledTransparency = 0.5,
        

        BlurSize = 25,
        BlurEnabled = true,
        

        GradientStart = Color3.fromRGB(138, 43, 226),
        GradientMiddle = Color3.fromRGB(147, 51, 234),
        GradientEnd = Color3.fromRGB(155, 65, 240),
        

        SliderFill = Color3.fromRGB(138, 43, 226),
        SliderBackground = Color3.fromRGB(40, 40, 50),
        ToggleOn = Color3.fromRGB(46, 204, 113),
        ToggleOff = Color3.fromRGB(60, 60, 70),
        DropdownArrow = Color3.fromRGB(180, 180, 190),
        InputBackground = Color3.fromRGB(25, 25, 35),
        InputBorder = Color3.fromRGB(40, 40, 50),

        ScrollbarColor = Color3.fromRGB(138, 43, 226),
        ScrollbarBackground = Color3.fromRGB(30, 30, 40),
        

        TabActive = Color3.fromRGB(138, 43, 226),
        TabInactive = Color3.fromRGB(25, 25, 35),
        TabHover = Color3.fromRGB(40, 40, 50),
    },
    
    CyberFlex = {
        Name = "Cyber Flex",
        Author = "Quantum",
        
        Primary = Color3.fromRGB(5, 10, 20),
        Secondary = Color3.fromRGB(10, 15, 25),
        Tertiary = Color3.fromRGB(15, 20, 30),
        Quaternary = Color3.fromRGB(20, 25, 35),
        
        Accent = Color3.fromRGB(0, 255, 255),
        AccentHover = Color3.fromRGB(0, 220, 255),
        AccentPressed = Color3.fromRGB(0, 180, 220),
        AccentDisabled = Color3.fromRGB(0, 150, 180),
        
        TextPrimary = Color3.fromRGB(0, 255, 255),
        TextSecondary = Color3.fromRGB(100, 200, 255),
        TextTertiary = Color3.fromRGB(80, 150, 200),
        TextDisabled = Color3.fromRGB(50, 100, 150),
        TextAccent = Color3.fromRGB(255, 0, 255),
        
        Border = Color3.fromRGB(0, 150, 200),
        BorderHover = Color3.fromRGB(0, 200, 255),
        BorderActive = Color3.fromRGB(0, 255, 255),
        Stroke = Color3.fromRGB(0, 255, 255),
        StrokeTransparency = 0.7,
        
        Success = Color3.fromRGB(0, 255, 150),
        Warning = Color3.fromRGB(255, 200, 0),
        Error = Color3.fromRGB(255, 0, 100),
        Info = Color3.fromRGB(0, 150, 255),
        
        Glow = Color3.fromRGB(0, 255, 255),
        Shadow = Color3.fromRGB(0, 0, 0),
        Overlay = Color3.fromRGB(0, 10, 20),
        Highlight = Color3.fromRGB(0, 255, 255),
        
        BackgroundTransparency = 0.25,
        ElementTransparency = 0.15,
        HoverTransparency = 0.1,
        PressedTransparency = 0.05,
        OverlayTransparency = 0.65,
        DisabledTransparency = 0.6,
        
        BlurSize = 30,
        BlurEnabled = true,
        
        GradientStart = Color3.fromRGB(0, 255, 255),
        GradientMiddle = Color3.fromRGB(128, 128, 255),
        GradientEnd = Color3.fromRGB(255, 0, 255),
        
        SliderFill = Color3.fromRGB(0, 255, 255),
        SliderBackground = Color3.fromRGB(0, 50, 80),
        ToggleOn = Color3.fromRGB(0, 255, 150),
        ToggleOff = Color3.fromRGB(0, 100, 150),
        DropdownArrow = Color3.fromRGB(0, 255, 255),
        InputBackground = Color3.fromRGB(10, 15, 25),
        InputBorder = Color3.fromRGB(0, 150, 200),
        
        ScrollbarColor = Color3.fromRGB(0, 255, 255),
        ScrollbarBackground = Color3.fromRGB(10, 20, 30),
        
        TabActive = Color3.fromRGB(0, 255, 255),
        TabInactive = Color3.fromRGB(15, 20, 30),
        TabHover = Color3.fromRGB(20, 40, 60),
    },
    
    NeonFlex = {
        Name = "Neon Flex",
        Author = "Quantum",
        
        Primary = Color3.fromRGB(10, 5, 15),
        Secondary = Color3.fromRGB(15, 10, 20),
        Tertiary = Color3.fromRGB(20, 15, 25),
        Quaternary = Color3.fromRGB(25, 20, 30),
        
        Accent = Color3.fromRGB(255, 0, 150),
        AccentHover = Color3.fromRGB(255, 50, 180),
        AccentPressed = Color3.fromRGB(200, 0, 120),
        AccentDisabled = Color3.fromRGB(150, 0, 90),
        
        TextPrimary = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(255, 150, 200),
        TextTertiary = Color3.fromRGB(200, 100, 150),
        TextDisabled = Color3.fromRGB(100, 50, 80),
        TextAccent = Color3.fromRGB(255, 0, 150),
        
        Border = Color3.fromRGB(255, 0, 150),
        BorderHover = Color3.fromRGB(255, 50, 180),
        BorderActive = Color3.fromRGB(255, 100, 200),
        Stroke = Color3.fromRGB(255, 100, 200),
        StrokeTransparency = 0.7,
        
        Success = Color3.fromRGB(100, 255, 150),
        Warning = Color3.fromRGB(255, 200, 50),
        Error = Color3.fromRGB(255, 50, 100),
        Info = Color3.fromRGB(100, 150, 255),
        
        Glow = Color3.fromRGB(255, 0, 150),
        Shadow = Color3.fromRGB(0, 0, 0),
        Overlay = Color3.fromRGB(10, 0, 10),
        Highlight = Color3.fromRGB(255, 100, 200),
        
        BackgroundTransparency = 0.35,
        ElementTransparency = 0.25,
        HoverTransparency = 0.2,
        PressedTransparency = 0.15,
        OverlayTransparency = 0.7,
        DisabledTransparency = 0.55,
        
        BlurSize = 28,
        BlurEnabled = true,
        
        GradientStart = Color3.fromRGB(255, 0, 150),
        GradientMiddle = Color3.fromRGB(200, 0, 200),
        GradientEnd = Color3.fromRGB(150, 0, 255),
        
        SliderFill = Color3.fromRGB(255, 0, 150),
        SliderBackground = Color3.fromRGB(40, 20, 50),
        ToggleOn = Color3.fromRGB(100, 255, 150),
        ToggleOff = Color3.fromRGB(80, 40, 100),
        DropdownArrow = Color3.fromRGB(255, 150, 200),
        InputBackground = Color3.fromRGB(15, 10, 20),
        InputBorder = Color3.fromRGB(255, 0, 150),
        
        ScrollbarColor = Color3.fromRGB(255, 0, 150),
        ScrollbarBackground = Color3.fromRGB(20, 10, 25),
        
        TabActive = Color3.fromRGB(255, 0, 150),
        TabInactive = Color3.fromRGB(20, 15, 25),
        TabHover = Color3.fromRGB(40, 20, 50),
    },
    
    LightFlex = {
        Name = "Light Flex",
        Author = "Quantum",
        
        Primary = Color3.fromRGB(240, 242, 245),
        Secondary = Color3.fromRGB(255, 255, 255),
        Tertiary = Color3.fromRGB(250, 251, 253),
        Quaternary = Color3.fromRGB(245, 247, 250),
        
        Accent = Color3.fromRGB(99, 102, 241),
        AccentHover = Color3.fromRGB(79, 70, 229),
        AccentPressed = Color3.fromRGB(67, 56, 202),
        AccentDisabled = Color3.fromRGB(165, 180, 252),
        
        TextPrimary = Color3.fromRGB(17, 24, 39),
        TextSecondary = Color3.fromRGB(75, 85, 99),
        TextTertiary = Color3.fromRGB(156, 163, 175),
        TextDisabled = Color3.fromRGB(209, 213, 219),
        TextAccent = Color3.fromRGB(99, 102, 241),
        
        Border = Color3.fromRGB(229, 231, 235),
        BorderHover = Color3.fromRGB(209, 213, 219),
        BorderActive = Color3.fromRGB(99, 102, 241),
        Stroke = Color3.fromRGB(99, 102, 241),
        StrokeTransparency = 0.8,
        
        Success = Color3.fromRGB(34, 197, 94),
        Warning = Color3.fromRGB(234, 179, 8),
        Error = Color3.fromRGB(239, 68, 68),
        Info = Color3.fromRGB(59, 130, 246),
        
        Glow = Color3.fromRGB(99, 102, 241),
        Shadow = Color3.fromRGB(0, 0, 0),
        Overlay = Color3.fromRGB(255, 255, 255),
        Highlight = Color3.fromRGB(99, 102, 241),
        
        BackgroundTransparency = 0.4,
        ElementTransparency = 0.3,
        HoverTransparency = 0.2,
        PressedTransparency = 0.1,
        OverlayTransparency = 0.75,
        DisabledTransparency = 0.6,
        
        BlurSize = 20,
        BlurEnabled = true,
        
        GradientStart = Color3.fromRGB(99, 102, 241),
        GradientMiddle = Color3.fromRGB(124, 58, 237),
        GradientEnd = Color3.fromRGB(139, 92, 246),
        
        SliderFill = Color3.fromRGB(99, 102, 241),
        SliderBackground = Color3.fromRGB(229, 231, 235),
        ToggleOn = Color3.fromRGB(34, 197, 94),
        ToggleOff = Color3.fromRGB(209, 213, 219),
        DropdownArrow = Color3.fromRGB(75, 85, 99),
        InputBackground = Color3.fromRGB(255, 255, 255),
        InputBorder = Color3.fromRGB(229, 231, 235),
        
        ScrollbarColor = Color3.fromRGB(99, 102, 241),
        ScrollbarBackground = Color3.fromRGB(243, 244, 246),
        
        TabActive = Color3.fromRGB(99, 102, 241),
        TabInactive = Color3.fromRGB(250, 251, 253),
        TabHover = Color3.fromRGB(243, 244, 246),
    },
    
    MatrixFlex = {
        Name = "Matrix Flex",
        Author = "Quantum",
        
        Primary = Color3.fromRGB(0, 0, 0),
        Secondary = Color3.fromRGB(5, 10, 5),
        Tertiary = Color3.fromRGB(10, 15, 10),
        Quaternary = Color3.fromRGB(15, 20, 15),
        
        Accent = Color3.fromRGB(0, 255, 65),
        AccentHover = Color3.fromRGB(0, 220, 50),
        AccentPressed = Color3.fromRGB(0, 180, 40),
        AccentDisabled = Color3.fromRGB(0, 120, 30),
        
        TextPrimary = Color3.fromRGB(0, 255, 65),
        TextSecondary = Color3.fromRGB(0, 200, 50),
        TextTertiary = Color3.fromRGB(0, 150, 40),
        TextDisabled = Color3.fromRGB(0, 80, 20),
        TextAccent = Color3.fromRGB(0, 255, 65),
        
        Border = Color3.fromRGB(0, 100, 25),
        BorderHover = Color3.fromRGB(0, 150, 40),
        BorderActive = Color3.fromRGB(0, 255, 65),
        Stroke = Color3.fromRGB(0, 255, 65),
        StrokeTransparency = 0.6,
        
        Success = Color3.fromRGB(0, 255, 100),
        Warning = Color3.fromRGB(200, 255, 0),
        Error = Color3.fromRGB(255, 0, 0),
        Info = Color3.fromRGB(0, 200, 255),
        
        Glow = Color3.fromRGB(0, 255, 65),
        Shadow = Color3.fromRGB(0, 0, 0),
        Overlay = Color3.fromRGB(0, 5, 0),
        Highlight = Color3.fromRGB(0, 255, 65),
        
        BackgroundTransparency = 0.2,
        ElementTransparency = 0.1,
        HoverTransparency = 0.05,
        PressedTransparency = 0,
        OverlayTransparency = 0.6,
        DisabledTransparency = 0.5,
        
        BlurSize = 35,
        BlurEnabled = true,
        
        GradientStart = Color3.fromRGB(0, 255, 65),
        GradientMiddle = Color3.fromRGB(0, 200, 50),
        GradientEnd = Color3.fromRGB(0, 150, 40),
        
        SliderFill = Color3.fromRGB(0, 255, 65),
        SliderBackground = Color3.fromRGB(0, 50, 15),
        ToggleOn = Color3.fromRGB(0, 255, 65),
        ToggleOff = Color3.fromRGB(0, 80, 20),
        DropdownArrow = Color3.fromRGB(0, 200, 50),
        InputBackground = Color3.fromRGB(5, 10, 5),
        InputBorder = Color3.fromRGB(0, 100, 25),
        
        ScrollbarColor = Color3.fromRGB(0, 255, 65),
        ScrollbarBackground = Color3.fromRGB(0, 20, 5),
        
        TabActive = Color3.fromRGB(0, 255, 65),
        TabInactive = Color3.fromRGB(10, 15, 10),
        TabHover = Color3.fromRGB(15, 30, 15),
    }
}


QuantumFlex.CurrentTheme = QuantumFlex.Themes.DarkFlex

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     UTILITY FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Utility = {}
Utility.__index = Utility

-- Instance Creation
function Utility:Create(className, properties)
    local success, instance = pcall(function()
        return Instance.new(className)
    end)
    
    if not success then
        warn("[Quantum Flex] Failed to create instance:", className)
        return nil
    end
    
    for property, value in pairs(properties or {}) do
        if property ~= "Parent" then
            local propSuccess = pcall(function()
                instance[property] = value
            end)
            
            if not propSuccess then
                warn("[Quantum Flex] Failed to set property:", property, "on", className)
            end
        end
    end
    
    if properties.Parent then
        instance.Parent = properties.Parent
    end
    
    return instance
end

-- Safe Tween
function Utility:Tween(instance, properties, duration, style, direction, callback)
    if not instance or not instance.Parent then
        return
    end
    
    duration = duration or 0.3
    style = style or Enum.EasingStyle.Quad
    direction = direction or Enum.EasingDirection.Out
    
    local tweenInfo = TweenInfo.new(duration, style, direction)
    
    local success, tween = pcall(function()
        return TweenService:Create(instance, tweenInfo, properties)
    end)
    
    if not success then
        warn("[Quantum Flex] Failed to create tween")
        return
    end
    
    if callback then
        tween.Completed:Connect(callback)
    end
    
    local playSuccess = pcall(function()
        tween:Play()
    end)
    
    if not playSuccess then
        warn("[Quantum Flex] Failed to play tween")
    end
    
    return tween
end

-- Add Corner Radius
function Utility:AddCorner(instance, radius)
    if not instance then return nil end
    
    return self:Create("UICorner", {
        CornerRadius = UDim.new(0, radius or 8),
        Parent = instance
    })
end

-- Add Stroke
function Utility:AddStroke(instance, color, thickness, transparency)
    if not instance then return nil end
    
    return self:Create("UIStroke", {
        Color = color or Color3.fromRGB(255, 255, 255),
        Thickness = thickness or 1,
        Transparency = transparency or 0,
        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
        Parent = instance
    })
end

-- Add Gradient
function Utility:AddGradient(instance, colorSequence, rotation, transparency)
    if not instance then return nil end
    
    local gradient = self:Create("UIGradient", {
        Rotation = rotation or 0,
        Parent = instance
    })
    
    if colorSequence then
        gradient.Color = colorSequence
    end
    
    if transparency then
        gradient.Transparency = transparency
    end
    
    return gradient
end

-- Add Padding
function Utility:AddPadding(instance, padding)
    if not instance then return nil end
    
    if type(padding) == "number" then
        return self:Create("UIPadding", {
            PaddingTop = UDim.new(0, padding),
            PaddingBottom = UDim.new(0, padding),
            PaddingLeft = UDim.new(0, padding),
            PaddingRight = UDim.new(0, padding),
            Parent = instance
        })
    else
        return self:Create("UIPadding", {
            PaddingTop = UDim.new(0, padding.Top or 0),
            PaddingBottom = UDim.new(0, padding.Bottom or 0),
            PaddingLeft = UDim.new(0, padding.Left or 0),
            PaddingRight = UDim.new(0, padding.Right or 0),
            Parent = instance
        })
    end
end

-- Add List Layout
function Utility:AddListLayout(instance, padding, fillDirection, alignment, sortOrder)
    if not instance then return nil end
    
    return self:Create("UIListLayout", {
        Padding = UDim.new(0, padding or 5),
        FillDirection = fillDirection or Enum.FillDirection.Vertical,
        HorizontalAlignment = alignment or Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        SortOrder = sortOrder or Enum.SortOrder.LayoutOrder,
        Parent = instance
    })
end

-- Add Shadow Effect
function Utility:AddShadow(instance, size, transparency, color)
    if not instance then return nil end
    
    local shadow = self:Create("ImageLabel", {
        Name = "Shadow",
        Size = UDim2.new(1, size or 30, 1, size or 30),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = color or Color3.fromRGB(0, 0, 0),
        ImageTransparency = transparency or 0.7,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277),
        ZIndex = (instance.ZIndex or 1) - 1,
        Parent = instance
    })
    
    return shadow
end

-- Create Ripple Effect
function Utility:CreateRipple(parent, color, position)
    if not parent then return end
    
    local ripple = self:Create("Frame", {
        Size = UDim2.new(0, 0, 0, 0),
        Position = position or UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = color or Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        ZIndex = (parent.ZIndex or 1) + 10,
        Parent = parent
    })
    
    self:AddCorner(ripple, 1000)
    
    local size = math.max(parent.AbsoluteSize.X, parent.AbsoluteSize.Y) * 2
    
    self:Tween(ripple, {
        Size = UDim2.new(0, size, 0, size),
        BackgroundTransparency = 1
    }, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, function()
        if ripple and ripple.Parent then
            ripple:Destroy()
        end
    end)
end

-- Apply Glassmorphism
function Utility:ApplyGlassmorphism(instance, blurSize, transparency)
    if not instance then return nil end
    
    instance.BackgroundTransparency = transparency or 0.3
    
    local blurEffect = self:Create("ImageLabel", {
        Name = "GlassBlur",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Image = "rbxassetid://8992230677",
        ImageColor3 = instance.BackgroundColor3,
        ImageTransparency = 0.98,
        ScaleType = Enum.ScaleType.Tile,
        TileSize = UDim2.new(0, 128, 0, 128),
        ZIndex = (instance.ZIndex or 1),
        Parent = instance
    })
    
    return blurEffect
end

-- Generate UUID
function Utility:GenerateUUID()
    local success, result = pcall(function()
        return HttpService:GenerateGUID(false)
    end)
    
    if success then
        return result
    else
        -- Fallback UUID generation
        local template = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"
        return string.gsub(template, "[xy]", function(c)
            local v = (c == "x") and math.random(0, 0xf) or math.random(8, 0xb)
            return string.format("%x", v)
        end)
    end
end

-- Get Text Size
function Utility:GetTextSize(text, fontSize, font, maxWidth)
    local success, result = pcall(function()
        local params = Instance.new("GetTextBoundsParams")
        params.Text = text
        params.Size = fontSize
        params.Font = font
        params.Width = maxWidth or 10000
        
        return TextService:GetTextBoundsAsync(params)
    end)
    
    if success then
        return result
    else
        -- Fallback estimation
        return Vector2.new(#text * (fontSize * 0.6), fontSize * 1.2)
    end
end

-- Format Number
function Utility:FormatNumber(number)
    if number >= 1000000000 then
        return string.format("%.1fB", number / 1000000000)
    elseif number >= 1000000 then
        return string.format("%.1fM", number / 1000000)
    elseif number >= 1000 then
        return string.format("%.1fK", number / 1000)
    else
        return tostring(math.floor(number))
    end
end

-- Clamp Value
function Utility:Clamp(value, min, max)
    return math.max(min, math.min(max, value))
end

-- Lerp
function Utility:Lerp(a, b, t)
    return a + (b - a) * t
end

-- Color Lerp
function Utility:LerpColor(color1, color2, t)
    return Color3.new(
        self:Lerp(color1.R, color2.R, t),
        self:Lerp(color1.G, color2.G, t),
        self:Lerp(color1.B, color2.B, t)
    )
end

-- Color from Hex
function Utility:ColorFromHex(hex)
    hex = hex:gsub("#", "")
    
    local r = tonumber("0x" .. hex:sub(1, 2))
    local g = tonumber("0x" .. hex:sub(3, 4))
    local b = tonumber("0x" .. hex:sub(5, 6))
    
    return Color3.fromRGB(r, g, b)
end

-- Color to Hex
function Utility:ColorToHex(color)
    return string.format("#%02X%02X%02X", 
        math.floor(color.R * 255),
        math.floor(color.G * 255),
        math.floor(color.B * 255)
    )
end

-- Deep Copy Table
function Utility:DeepCopy(original)
    local copy
    if type(original) == 'table' then
        copy = {}
        for key, value in next, original, nil do
            copy[Utility:DeepCopy(key)] = Utility:DeepCopy(value)
        end
        setmetatable(copy, Utility:DeepCopy(getmetatable(original)))
    else
        copy = original
    end
    return copy
end

-- Safe Wait
function Utility:SafeWait(duration)
    local start = tick()
    while tick() - start < duration do
        RunService.Heartbeat:Wait()
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     ICON LIBRARY
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Icons = {
    -- Navigation
    Home = "ğŸ ",
    Settings = "âš™ï¸",
    Menu = "â˜°",
    Back = "â†",
    Forward = "â†’",
    Up = "â†‘",
    Down = "â†“",
    
    -- Actions
    Plus = "+",
    Minus = "-",
    Close = "âœ•",
    Check = "âœ“",
    Search = "ğŸ”",
    Refresh = "ğŸ”„",
    Download = "â¬‡ï¸",
    Upload = "â¬†ï¸",
    Save = "ğŸ’¾",
    Delete = "ğŸ—‘ï¸",
    Edit = "âœï¸",
    Copy = "ğŸ“‹",
    Share = "ğŸ“¤",
    
    -- Status
    Success = "âœ…",
    Error = "âŒ",
    Warning = "âš ï¸",
    Info = "â„¹ï¸",
    
    -- UI Elements
    User = "ğŸ‘¤",
    Crown = "ğŸ‘‘",
    Star = "â­",
    Heart = "â¤ï¸",
    Fire = "ğŸ”¥",
    Lightning = "âš¡",
    Shield = "ğŸ›¡ï¸",
    Sword = "âš”ï¸",
    Trophy = "ğŸ†",
    Target = "ğŸ¯",
    
    -- Files & Folders
    Folder = "ğŸ“",
    File = "ğŸ“„",
    Image = "ğŸ–¼ï¸",
    Video = "ğŸ¥",
    Music = "ğŸµ",
    
    -- Communication
    Mail = "ğŸ“§",
    Message = "ğŸ’¬",
    Notification = "ğŸ””",
    Phone = "ğŸ“±",
    
    -- Media
    Play = "â–¶ï¸",
    Pause = "â¸ï¸",
    Stop = "â¹ï¸",
    Skip = "â­ï¸",
    Rewind = "â®ï¸",
    Volume = "ğŸ”Š",
    Mute = "ğŸ”‡",
    Camera = "ğŸ“·",
    Mic = "ğŸ¤",
    
    -- System
    Lock = "ğŸ”’",
    Unlock = "ğŸ”“",
    Eye = "ğŸ‘ï¸",
    EyeOff = "ğŸ™ˆ",
    Power = "âš¡",
    Battery = "ğŸ”‹",
    Wifi = "ğŸ“¶",
    Link = "ğŸ”—",
    
    -- Time & Calendar
    Clock = "ğŸ•",
    Calendar = "ğŸ“…",
    Timer = "â±ï¸",
    
    -- Location
    Map = "ğŸ—ºï¸",
    Location = "ğŸ“",
    Flag = "ğŸš©",
    
    -- Gaming
    Gamepad = "ğŸ®",
    Dice = "ğŸ²",
    
    -- Special
    Rocket = "ğŸš€",
    Gem = "ğŸ’",
    Coin = "ğŸª™",
    Gift = "ğŸ",
    Box = "ğŸ“¦",
    Tag = "ğŸ·ï¸",
    Key = "ğŸ”‘",
    Magic = "âœ¨",
    Rainbow = "ğŸŒˆ",
    
    -- Nature
    Sun = "â˜€ï¸",
    Moon = "ğŸŒ™",
    Cloud = "â˜ï¸",
    Flower = "ğŸŒ¸",
    Tree = "ğŸŒ³",
    
    -- Data & Analytics
    Chart = "ğŸ“Š",
    Graph = "ğŸ“ˆ",
    
    -- Tech
    Robot = "ğŸ¤–",
    Bug = "ğŸ›",
    Code = "</>",
    Terminal = ">_",
    
    -- Arrows
    ArrowRight = "â†’",
    ArrowLeft = "â†",
    ArrowUp = "â†‘",
    ArrowDown = "â†“",
    ArrowUpRight = "â†—",
    ArrowUpLeft = "â†–",
    ArrowDownRight = "â†˜",
    ArrowDownLeft = "â†™",
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     ANIMATION PRESETS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local AnimationPresets = {
    Instant = {
        Duration = 0,
        Style = Enum.EasingStyle.Linear,
        Direction = Enum.EasingDirection.InOut
    },
    Fast = {
        Duration = 0.15,
        Style = Enum.EasingStyle.Quad,
        Direction = Enum.EasingDirection.Out
    },
    Normal = {
        Duration = 0.3,
        Style = Enum.EasingStyle.Quad,
        Direction = Enum.EasingDirection.Out
    },
    Slow = {
        Duration = 0.5,
        Style = Enum.EasingStyle.Quad,
        Direction = Enum.EasingDirection.Out
    },
    Smooth = {
        Duration = 0.4,
        Style = Enum.EasingStyle.Sine,
        Direction = Enum.EasingDirection.InOut
    },
    Bounce = {
        Duration = 0.6,
        Style = Enum.EasingStyle.Back,
        Direction = Enum.EasingDirection.Out
    },
    Elastic = {
        Duration = 0.8,
        Style = Enum.EasingStyle.Elastic,
        Direction = Enum.EasingDirection.Out
    },
    Sharp = {
        Duration = 0.2,
        Style = Enum.EasingStyle.Linear,
        Direction = Enum.EasingDirection.In
    },
    Spring = {
        Duration = 0.5,
        Style = Enum.EasingStyle.Sine,
        Direction = Enum.EasingDirection.Out
    },
    EaseIn = {
        Duration = 0.3,
        Style = Enum.EasingStyle.Quad,
        Direction = Enum.EasingDirection.In
    },
    EaseOut = {
        Duration = 0.3,
        Style = Enum.EasingStyle.Quad,
        Direction = Enum.EasingDirection.Out
    },
    EaseInOut = {
        Duration = 0.3,
        Style = Enum.EasingStyle.Quad,
        Direction = Enum.EasingDirection.InOut
    }
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     DRAG CONTROLLER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local DragController = {}
DragController.__index = DragController

function DragController.new(frame, dragHandle)
    local self = setmetatable({}, DragController)
    
    self.Frame = frame
    self.DragHandle = dragHandle or frame
    self.Dragging = false
    self.DragInput = nil
    self.DragStart = nil
    self.StartPos = nil
    self.Connections = {}
    
    self:Initialize()
    
    return self
end

function DragController:Initialize()
    local function update(input)
        if not self.Dragging or not self.Frame or not self.Frame.Parent then 
            return 
        end
        
        local delta = input.Position - self.DragStart
        local newPos = UDim2.new(
            self.StartPos.X.Scale,
            self.StartPos.X.Offset + delta.X,
            self.StartPos.Y.Scale,
            self.StartPos.Y.Offset + delta.Y
        )
        
        -- Boundary checking
        local vpSize = Viewport
        local frameSize = self.Frame.AbsoluteSize
        
        local clampedX = math.clamp(newPos.X.Offset, 0, vpSize.X - frameSize.X)
        local clampedY = math.clamp(newPos.Y.Offset, 0, vpSize.Y - frameSize.Y)
        
        self.Frame.Position = UDim2.new(0, clampedX, 0, clampedY)
    end
    
    table.insert(self.Connections, self.DragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            self.Dragging = true
            self.DragStart = input.Position
            self.StartPos = self.Frame.Position
            
            table.insert(self.Connections, input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    self.Dragging = false
                end
            end))
        end
    end))
    
    table.insert(self.Connections, self.DragHandle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or 
           input.UserInputType == Enum.UserInputType.Touch then
            self.DragInput = input
        end
    end))
    
    table.insert(self.Connections, UserInputService.InputChanged:Connect(function(input)
        if input == self.DragInput and self.Dragging then
            update(input)
        end
    end))
end

function DragController:Destroy()
    self.Dragging = false
    self.DragInput = nil
    self.DragStart = nil
    self.StartPos = nil
    
    for _, connection in ipairs(self.Connections) do
        if connection and connection.Connected then
            connection:Disconnect()
        end
    end
    
    self.Connections = {}
end

local ResizeController = {}
ResizeController.__index = ResizeController

function ResizeController.new(frame, minSize, maxSize)
    local self = setmetatable({}, ResizeController)
    
    self.Frame = frame
    self.MinSize = minSize or Vector2.new(300, 200)
    self.MaxSize = maxSize or Vector2.new(1920, 1080)
    self.Resizing = false
    self.Handles = {}
    self.Connections = {}
    
    self:CreateHandles()
    
    return self
end

function ResizeController:CreateHandles()
    local theme = QuantumFlex.CurrentTheme
    
    local handlePositions = {
        {
            Name = "BottomRight",
            AnchorPoint = Vector2.new(1, 1),
            Position = UDim2.new(1, 0, 1, 0),
            Cursor = "rbxasset://SystemCursors/SizeNWSE"
        },
        {
            Name = "BottomLeft",
            AnchorPoint = Vector2.new(0, 1),
            Position = UDim2.new(0, 0, 1, 0),
            Cursor = "rbxasset://SystemCursors/SizeNESW"
        },
        {
            Name = "TopRight",
            AnchorPoint = Vector2.new(1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            Cursor = "rbxasset://SystemCursors/SizeNESW"
        },
        {
            Name = "TopLeft",
            AnchorPoint = Vector2.new(0, 0),
            Position = UDim2.new(0, 0, 0, 0),
            Cursor = "rbxasset://SystemCursors/SizeNWSE"
        },
        {
            Name = "Right",
            AnchorPoint = Vector2.new(1, 0.5),
            Position = UDim2.new(1, 0, 0.5, 0),
            Cursor = "rbxasset://SystemCursors/SizeEW"
        },
        {
            Name = "Left",
            AnchorPoint = Vector2.new(0, 0.5),
            Position = UDim2.new(0, 0, 0.5, 0),
            Cursor = "rbxasset://SystemCursors/SizeEW"
        },
        {
            Name = "Bottom",
            AnchorPoint = Vector2.new(0.5, 1),
            Position = UDim2.new(0.5, 0, 1, 0),
            Cursor = "rbxasset://SystemCursors/SizeNS"
        },
        {
            Name = "Top",
            AnchorPoint = Vector2.new(0.5, 0),
            Position = UDim2.new(0.5, 0, 0, 0),
            Cursor = "rbxasset://SystemCursors/SizeNS"
        }
    }
    
    for _, handleData in ipairs(handlePositions) do
        local handle = Utility:Create("Frame", {
            Name = handleData.Name .. "Handle",
            Size = UDim2.new(0, 12, 0, 12),
            Position = handleData.Position,
            AnchorPoint = handleData.AnchorPoint,
            BackgroundColor3 = theme.Accent,
            BackgroundTransparency = 0.7,
            BorderSizePixel = 0,
            ZIndex = 1000,
            Parent = self.Frame
        })
        
        Utility:AddCorner(handle, 6)
        
        -- Hover effect
        handle.MouseEnter:Connect(function()
            Mouse.Icon = handleData.Cursor
            Utility:Tween(handle, {
                BackgroundTransparency = 0.3,
                Size = UDim2.new(0, 14, 0, 14)
            }, 0.2)
        end)
        
        handle.MouseLeave:Connect(function()
            if not self.Resizing then
                Mouse.Icon = ""
                Utility:Tween(handle, {
                    BackgroundTransparency = 0.7,
                    Size = UDim2.new(0, 12, 0, 12)
                }, 0.2)
            end
        end)
        
        self:BindHandle(handle, handleData.Name)
        table.insert(self.Handles, handle)
    end
end

function ResizeController:BindHandle(handle, direction)
    local dragging = false
    local dragStart = nil
    local startSize = nil
    local startPos = nil
    
    local inputBegan
    inputBegan = handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startSize = self.Frame.AbsoluteSize
            startPos = self.Frame.AbsolutePosition
            self.Resizing = true
        end
    end)
    
    local inputEnded
    inputEnded = handle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
            self.Resizing = false
            Mouse.Icon = ""
        end
    end)
    
    local inputChanged
    inputChanged = UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or 
           input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            local newSize = startSize
            local newPos = startPos
            
            -- Calculate new size based on direction
            if direction:find("Right") then
                newSize = Vector2.new(startSize.X + delta.X, newSize.Y)
            elseif direction:find("Left") then
                newSize = Vector2.new(startSize.X - delta.X, newSize.Y)
                newPos = Vector2.new(startPos.X + delta.X, newPos.Y)
            end
            
            if direction:find("Bottom") then
                newSize = Vector2.new(newSize.X, startSize.Y + delta.Y)
            elseif direction:find("Top") then
                newSize = Vector2.new(newSize.X, startSize.Y - delta.Y)
                newPos = Vector2.new(newPos.X, startPos.Y + delta.Y)
            end
            

            newSize = Vector2.new(
                Utility:Clamp(newSize.X, self.MinSize.X, self.MaxSize.X),
                Utility:Clamp(newSize.Y, self.MinSize.Y, self.MaxSize.Y)
            )
            

            self.Frame.Size = UDim2.new(0, newSize.X, 0, newSize.Y)
            self.Frame.Position = UDim2.new(0, newPos.X, 0, newPos.Y)
        end
    end)
    
    table.insert(self.Connections, inputBegan)
    table.insert(self.Connections, inputEnded)
    table.insert(self.Connections, inputChanged)
end

function ResizeController:Destroy()
    self.Resizing = false
    
    for _, handle in ipairs(self.Handles) do
        if handle and handle.Parent then
            handle:Destroy()
        end
    end
    
    for _, connection in ipairs(self.Connections) do
        if connection and connection.Connected then
            connection:Disconnect()
        end
    end
    
    self.Handles = {}
    self.Connections = {}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     WINDOW CLASS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Window = {}
Window.__index = Window

function Window.new(config)
    local self = setmetatable({}, Window)
    
    -- Configuration with defaults
    config = config or {}
    self.Name = config.Name or "Quantum Flex UI"
    self.Theme = QuantumFlex.Themes[config.Theme] or QuantumFlex.CurrentTheme
    self.Size = config.Size or (IsMobile and UDim2.new(0, 380, 0, 680) or UDim2.new(0, 680, 0, 580))
    self.MinSize = config.MinSize or Vector2.new(400, 350)
    self.MaxSize = config.MaxSize or Vector2.new(1400, 900)
    self.Position = config.Position
    self.Resizable = config.Resizable ~= false and not IsMobile
    self.Draggable = config.Draggable ~= false
    self.SaveConfig = config.SaveConfig ~= false
    self.ConfigFolder = config.ConfigFolder or "QuantumFlex"
    self.Acrylic = config.Acrylic ~= false
    self.CloseCallback = config.CloseCallback
    self.PrefixIcon = config.PrefixIcon or "Q"
    
    -- Internal State
    self.Tabs = {}
    self.CurrentTab = nil
    self.Elements = {}
    self.Notifications = {}
    self.Minimized = false
    self.Closed = false
    self.Visible = true
    self._index = Utility:GenerateUUID()
    self.Connections = {}
    
    -- Create UI
    self:CreateUI()
    
    -- Register Window
    table.insert(QuantumFlex.Windows, self)
    QuantumFlex._index = QuantumFlex._index or {}
    QuantumFlex._index[self._index] = self
    
    return self
end

function Window:CreateUI()
    local theme = self.Theme
    
    -- Screen Gui with protection
    local success, gui = pcall(function()
        return Utility:Create("ScreenGui", {
            Name = "QuantumFlex_" .. HttpService:GenerateGUID(false):sub(1, 8),
            Parent = GuiParent,
            ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
            ResetOnSpawn = false,
            IgnoreGuiInset = true,
            DisplayOrder = 100
        })
    end)
    
    if not success then
        warn("[Quantum Flex] Failed to create ScreenGui")
        return
    end
    
    self.ScreenGui = gui
    
    -- Blur Effect
    if theme.BlurEnabled and not IsMobile then
        pcall(function()
            self.Blur = Utility:Create("BlurEffect", {
                Name = "QuantumBlur",
                Size = 0,
                Parent = Lighting
            })
            
            Utility:Tween(self.Blur, {Size = theme.BlurSize}, 0.5)
        end)
    end
    
    -- Main Container with CanvasGroup for performance
    self.Container = Utility:Create("CanvasGroup", {
        Name = "MainContainer",
        Size = self.Size,
        Position = self.Position or UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = theme.Primary,
        BackgroundTransparency = theme.BackgroundTransparency,
        BorderSizePixel = 0,
        GroupTransparency = 0,
        ClipsDescendants = false,
        Parent = self.ScreenGui
    })
    
    Utility:AddCorner(self.Container, IsMobile and 20 or 14)
    Utility:AddStroke(self.Container, theme.Border, 2, 0.4)
    
    -- Glassmorphism effect
    if self.Acrylic then
        Utility:ApplyGlassmorphism(self.Container, theme.BlurSize, theme.BackgroundTransparency)
    end
    
    -- Drop Shadow
    Utility:AddShadow(self.Container, 60, 0.85)
    
    -- Glow Effect
    if not IsMobile then
        local glow = Utility:Create("ImageLabel", {
            Name = "Glow",
            Size = UDim2.new(1, 80, 1, 80),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Image = "rbxassetid://5554236805",
            ImageColor3 = theme.Accent,
            ImageTransparency = 0.92,
            ScaleType = Enum.ScaleType.Slice,
            SliceCenter = Rect.new(23, 23, 277, 277),
            ZIndex = 0,
            Parent = self.Container
        })
    end
    
    -- Create UI Components
    self:CreateTopBar()
    self:CreateNavigationBar()
    self:CreateContentContainer()
    self:CreateStatusBar()
    
    -- Initialize Controllers
    if self.Draggable then
        self.DragController = DragController.new(self.Container, self.TopBar)
        table.insert(self.Connections, self.DragController)
    end
    
    if self.Resizable then
        self.ResizeController = ResizeController.new(self.Container, self.MinSize, self.MaxSize)
        table.insert(self.Connections, self.ResizeController)
    end
    
    -- Entrance Animation
    self.Container.GroupTransparency = 1
    self.Container.Size = UDim2.new(0, 0, 0, 0)
    
    task.wait(0.05)
    
    Utility:Tween(self.Container, {
        Size = self.Size,
        GroupTransparency = 0
    }, 0.7, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    -- Add to cleanup
    table.insert(self.Connections, self.ScreenGui)
end

function Window:CreateTopBar()
    local theme = self.Theme
    local topBarHeight = IsMobile and 60 or 55
    
    self.TopBar = Utility:Create("Frame", {
        Name = "TopBar",
        Size = UDim2.new(1, 0, 0, topBarHeight),
        BackgroundColor3 = theme.Secondary,
        BackgroundTransparency = theme.ElementTransparency,
        BorderSizePixel = 0,
        Parent = self.Container
    })
    
    Utility:AddCorner(self.TopBar, IsMobile and 20 or 14)
    
    -- Gradient overlay
    local gradient = Utility:AddGradient(self.TopBar, ColorSequence.new({
        ColorSequenceKeypoint.new(0, theme.Secondary),
        ColorSequenceKeypoint.new(1, theme.Tertiary)
    }), 90)
    
    -- Cover bottom corners
    local topBarCover = Utility:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 28),
        Position = UDim2.new(0, 0, 1, -28),
        BackgroundColor3 = theme.Secondary,
        BackgroundTransparency = theme.ElementTransparency,
        BorderSizePixel = 0,
        Parent = self.TopBar
    })
    
    -- Logo Container with gradient
    local logoSize = IsMobile and 44 or 40
    local logoContainer = Utility:Create("Frame", {
        Name = "LogoContainer",
        Size = UDim2.new(0, logoSize, 0, logoSize),
        Position = UDim2.new(0, 12, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundColor3 = theme.Accent,
        BackgroundTransparency = 0.15,
        BorderSizePixel = 0,
        Parent = self.TopBar
    })
    
    Utility:AddCorner(logoContainer, 12)
    Utility:AddGradient(logoContainer, ColorSequence.new({
        ColorSequenceKeypoint.new(0, theme.GradientStart),
        ColorSequenceKeypoint.new(0.5, theme.GradientMiddle),
        ColorSequenceKeypoint.new(1, theme.GradientEnd)
    }), 45)
    
    -- Animated glow around logo
    local logoGlow = Utility:Create("ImageLabel", {
        Size = UDim2.new(1, 20, 1, 20),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = theme.Accent,
        ImageTransparency = 0.7,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277),
        ZIndex = -1,
        Parent = logoContainer
    })
    
    -- Pulsing animation for logo glow
    task.spawn(function()
        while self.ScreenGui and self.ScreenGui.Parent do
            Utility:Tween(logoGlow, {ImageTransparency = 0.5}, 1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut)
            task.wait(1)
            Utility:Tween(logoGlow, {ImageTransparency = 0.8}, 1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut)
            task.wait(1)
        end
    end)
    
    -- Logo Icon/Text
    local logoText = Utility:Create("TextLabel", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = self.PrefixIcon,
        Font = Enum.Font.GothamBold,
        TextSize = IsMobile and 24 : 22,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Parent = logoContainer
    })
    
    -- Title with shadow effect
    self.TitleLabel = Utility:Create("TextLabel", {
        Name = "Title",
        Size = UDim2.new(0, 250, 1, 0),
        Position = UDim2.new(0, IsMobile and 68 or 64, 0, 0),
        BackgroundTransparency = 1,
        Text = self.Name,
        Font = Enum.Font.GothamBold,
        TextSize = IsMobile and 17 or 16,
        TextColor3 = theme.TextPrimary,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
        Parent = self.TopBar
    })
    
    -- Subtitle/Version
    local subtitle = Utility:Create("TextLabel", {
        Name = "Subtitle",
        Size = UDim2.new(0, 250, 0, 16),
        Position = UDim2.new(0, IsMobile and 68 or 64, 0, topBarHeight - 20),
        BackgroundTransparency = 1,
        Text = "v" .. QuantumFlex._VERSION .. " â€¢ Premium",
        Font = Enum.Font.Gotham,
        TextSize = 11,
        TextColor3 = theme.TextTertiary,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
        Visible = not IsMobile,
        Parent = self.TopBar
    })
    
    -- Control Buttons Container
    local controlsWidth = IsMobile and 110 or 100
    local controlsContainer = Utility:Create("Frame", {
        Name = "ControlsContainer",
        Size = UDim2.new(0, controlsWidth, 1, 0),
        Position = UDim2.new(1, -(controlsWidth + 10), 0, 0),
        BackgroundTransparency = 1,
        Parent = self.TopBar
    })
    
    -- Theme Toggle Button
    if not IsMobile then
        self:CreateControlButton(controlsContainer, "ğŸ¨", UDim2.new(0, -50, 0.5, 0), function()
            self:ToggleThemeMenu()
        end, "Change Theme")
    end
    
    -- Minimize Button
    self.MinimizeButton = self:CreateControlButton(controlsContainer, "âˆ’", UDim2.new(0, 0, 0.5, 0), function()
        self:ToggleMinimize()
    end, "Minimize")
    
    -- Close Button
    self.CloseButton = self:CreateControlButton(controlsContainer, "âœ•", UDim2.new(0, IsMobile and 55 or 50, 0.5, 0), function()
        self:Close()
    end, "Close", true)
    
    -- FPS Counter (Desktop only)
    if not IsMobile then
        self.FPSCounter = Utility:Create("TextLabel", {
            Size = UDim2.new(0, 60, 0, 20),
            Position = UDim2.new(1, -180, 0.5, 0),
            AnchorPoint = Vector2.new(0, 0.5),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = 0.3,
            BorderSizePixel = 0,
            Text = "60 FPS",
            Font = Enum.Font.GothamBold,
            TextSize = 11,
            TextColor3 = theme.Success,
            Parent = self.TopBar
        })
        
        Utility:AddCorner(self.FPSCounter, 6)
        
        -- FPS Update
        local lastUpdate = 0
        local frameCount = 0
        
        table.insert(self.Connections, RunService.RenderStepped:Connect(function()
            frameCount = frameCount + 1
            
            if tick() - lastUpdate >= 1 then
                local fps = frameCount
                frameCount = 0
                lastUpdate = tick()
                
                if self.FPSCounter and self.FPSCounter.Parent then
                    self.FPSCounter.Text = fps .. " FPS"
                    self.FPSCounter.TextColor3 = fps >= 50 and theme.Success or fps >= 30 and theme.Warning or theme.Error
                end
            end
        end))
    end
end

function Window:CreateControlButton(parent, text, position, callback, tooltip, isClose)
    local theme = self.Theme
    local buttonSize = IsMobile and 45 or 40
    
    local button = Utility:Create("TextButton", {
        Size = UDim2.new(0, buttonSize, 0, buttonSize),
        Position = position,
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundColor3 = theme.Tertiary,
        BackgroundTransparency = theme.ElementTransparency + 0.1,
        BorderSizePixel = 0,
        Text = text,
        Font = Enum.Font.GothamBold,
        TextSize = IsMobile and 22 : 20,
        TextColor3 = theme.TextPrimary,
        AutoButtonColor = false,
        Parent = parent
    })
    
    Utility:AddCorner(button, 10)
    
    -- Hover Effect
    button.MouseEnter:Connect(function()
        local hoverColor = isClose and theme.Error or theme.Accent
        Utility:Tween(button, {
            BackgroundColor3 = hoverColor,
            BackgroundTransparency = 0.2
        }, 0.2)
        
        if tooltip and not IsMobile then
            self:ShowTooltip(button, tooltip)
        end
    end)
    
    button.MouseLeave:Connect(function()
        Utility:Tween(button, {
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency + 0.1
        }, 0.2)
        
        if tooltip and not IsMobile then
            self:HideTooltip()
        end
    end)
    
    -- Click Effect
    button.MouseButton1Click:Connect(function()
        Utility:CreateRipple(button, theme.Accent)
        
        -- Button press animation
        Utility:Tween(button, {Size = UDim2.new(0, buttonSize - 4, 0, buttonSize - 4)}, 0.1)
        task.wait(0.1)
        Utility:Tween(button, {Size = UDim2.new(0, buttonSize, 0, buttonSize)}, 0.1)
        
        callback()
    end)
    
    return button
end

function Window:CreateNavigationBar()
    local theme = self.Theme
    local navWidth = IsMobile and 0 or 175
    local navHeight = IsMobile and 70 : 0
    
    self.NavigationBar = Utility:Create("ScrollingFrame", {
        Name = "NavigationBar",
        Size = IsMobile and UDim2.new(1, -20, 0, navHeight) or UDim2.new(0, navWidth, 1, -75),
        Position = IsMobile and UDim2.new(0, 10, 0, 70) or UDim2.new(0, 10, 0, 65),
        BackgroundColor3 = theme.Secondary,
        BackgroundTransparency = theme.ElementTransparency,
        BorderSizePixel = 0,
        ScrollBarThickness = 0,
        ScrollingDirection = IsMobile and Enum.ScrollingDirection.X or Enum.ScrollingDirection.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = IsMobile and Enum.AutomaticSize.X or Enum.AutomaticSize.Y,
        ClipsDescendants = true,
        Parent = self.Container
    })
    
    Utility:AddCorner(self.NavigationBar, 12)
    
    -- Add gradient overlay
    Utility:AddGradient(self.NavigationBar, ColorSequence.new({
        ColorSequenceKeypoint.new(0, theme.Secondary),
        ColorSequenceKeypoint.new(1, theme.Tertiary)
    }), IsMobile and 0 or 90)
    
    -- List Layout
    self.NavLayout = Utility:Create("UIListLayout", {
        Padding = UDim.new(0, IsMobile and 10 or 8),
        FillDirection = IsMobile and Enum.FillDirection.Horizontal or Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Left,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = self.NavigationBar
    })
    
    -- Padding
    Utility:AddPadding(self.NavigationBar, IsMobile and {Top = 10, Bottom = 10, Left = 12, Right = 12} or 12)
end

function Window:CreateContentContainer()
    local theme = self.Theme
    
    local contentPosX = IsMobile and 10 or 195
    local contentPosY = IsMobile and 150 : 65
    local contentWidth = IsMobile and -20 : -205
    local contentHeight = IsMobile and -185 : -95
    
    self.ContentContainer = Utility:Create("Frame", {
        Name = "ContentContainer",
        Size = UDim2.new(1, contentWidth, 1, contentHeight),
        Position = UDim2.new(0, contentPosX, 0, contentPosY),
        BackgroundColor3 = theme.Secondary,
        BackgroundTransparency = theme.ElementTransparency,
        BorderSizePixel = 0,
        ClipsDescendants = true,
        Parent = self.Container
    })
    
    Utility:AddCorner(self.ContentContainer, 12)
    
    -- Add subtle gradient
    Utility:AddGradient(self.ContentContainer, ColorSequence.new({
        ColorSequenceKeypoint.new(0, theme.Secondary),
        ColorSequenceKeypoint.new(1, theme.Tertiary)
    }), 180)
end

function Window:CreateStatusBar()
    if IsMobile then return end
    
    local theme = self.Theme
    
    self.StatusBar = Utility:Create("Frame", {
        Name = "StatusBar",
        Size = UDim2.new(1, -20, 0, 22),
        Position = UDim2.new(0, 10, 1, -28),
        BackgroundColor3 = theme.Tertiary,
        BackgroundTransparency = theme.ElementTransparency,
        BorderSizePixel = 0,
        Parent = self.Container
    })
    
    Utility:AddCorner(self.StatusBar, 8)
    
    -- Status Text
    self.StatusText = Utility:Create("TextLabel", {
        Size = UDim2.new(1, -20, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = "Ready",
        Font = Enum.Font.Gotham,
        TextSize = 11,
        TextColor3 = theme.TextTertiary,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = self.StatusBar
    })
    
    -- Time Label
    self.TimeLabel = Utility:Create("TextLabel", {
        Size = UDim2.new(0, 80, 1, 0),
        Position = UDim2.new(1, -90, 0, 0),
        BackgroundTransparency = 1,
        Text = os.date("%H:%M:%S"),
        Font = Enum.Font.GothamBold,
        TextSize = 11,
        TextColor3 = theme.TextSecondary,
        TextXAlignment = Enum.TextXAlignment.Right,
        Parent = self.StatusBar
    })
    
    -- Update time
    task.spawn(function()
        while self.ScreenGui and self.ScreenGui.Parent do
            if self.TimeLabel and self.TimeLabel.Parent then
                self.TimeLabel.Text = os.date("%H:%M:%S")
            end
            task.wait(1)
        end
    end)
end

function Window:SetStatus(text, duration)
    if not self.StatusText or IsMobile then return end
    
    self.StatusText.Text = text
    
    if duration then
        task.delay(duration, function()
            if self.StatusText and self.StatusText.Parent then
                self.StatusText.Text = "Ready"
            end
        end)
    end
end

function Window:ToggleMinimize()
    self.Minimized = not self.Minimized
    
    local targetHeight = self.Minimized and (IsMobile and 60 or 55) or self.Size.Y.Offset
    
    Utility:Tween(self.Container, {
        Size = UDim2.new(self.Size.X.Scale, self.Size.X.Offset, 0, targetHeight)
    }, 0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
    
    if self.MinimizeButton then
        self.MinimizeButton.Text = self.Minimized and "+" or "âˆ’"
    end
end

function Window:Close()
    if self.Closed then return end
    self.Closed = true
    
    -- Call close callback
    if self.CloseCallback then
        pcall(self.CloseCallback)
    end
    
    -- Close Animation
    Utility:Tween(self.Container, {
        Size = UDim2.new(0, 0, 0, 0),
        GroupTransparency = 1
    }, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In, function()
        -- Remove blur
        if self.Blur then
            Utility:Tween(self.Blur, {Size = 0}, 0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, function()
                pcall(function() self.Blur:Destroy() end)
            end)
        end
        
        task.wait(0.2)
        
        -- Cleanup
        self:Destroy()
    end)
end

function Window:Destroy()
    -- Disconnect all connections
    for _, connection in ipairs(self.Connections) do
        if typeof(connection) == "RBXScriptConnection" then
            pcall(function() connection:Disconnect() end)
        elseif type(connection) == "table" and connection.Destroy then
            pcall(function() connection:Destroy() end)
        end
    end
    
    -- Destroy GUI
    if self.ScreenGui and self.ScreenGui.Parent then
        pcall(function() self.ScreenGui:Destroy() end)
    end
    
    -- Remove from registry
    for i, window in ipairs(QuantumFlex.Windows) do
        if window._index == self._index then
            table.remove(QuantumFlex.Windows, i)
            break
        end
    end
    
    if QuantumFlex._index then
        QuantumFlex._index[self._index] = nil
    end
end

function Window:Toggle()
    self.Visible = not self.Visible
    
    if self.Container then
        Utility:Tween(self.Container, {
            GroupTransparency = self.Visible and 0 or 1
        }, 0.3)
        
        self.Container.Visible = self.Visible
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                        TAB SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Window:CreateTab(config)
    config = config or {}
    local tabName = config.Name or "Tab"
    local tabIcon = config.Icon or Icons.Folder
    local tabVisible = config.Visible ~= false
    
    local Tab = {
        Name = tabName,
        Icon = tabIcon,
        Window = self,
        Elements = {},
        Visible = false,
        _index = Utility:GenerateUUID(),
        Theme = self.Theme
    }
    
    setmetatable(Tab, {__index = self})
    
    -- Tab Button
    local buttonWidth = IsMobile and 130 : 0
    local buttonHeight = IsMobile and 0 : 50
    
    Tab.Button = Utility:Create("TextButton", {
        Name = tabName .. "Button",
        Size = IsMobile and UDim2.new(0, buttonWidth, 1, -5) or UDim2.new(1, -10, 0, buttonHeight),
        BackgroundColor3 = self.Theme.Tertiary,
        BackgroundTransparency = self.Theme.ElementTransparency,
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false,
        LayoutOrder = #self.Tabs + 1,
        Parent = self.NavigationBar
    })
    
    Utility:AddCorner(Tab.Button, 10)
    
    -- Tab Icon
    local iconSize = IsMobile and 26 : 22
    Tab.IconLabel = Utility:Create("TextLabel", {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = IsMobile and UDim2.new(0, 14, 0.5, 0) or UDim2.new(0, 14, 0, 12),
        AnchorPoint = IsMobile and Vector2.new(0, 0.5) or Vector2.new(0, 0),
        BackgroundTransparency = 1,
        Text = tabIcon,
        Font = Enum.Font.GothamBold,
        TextSize = IsMobile and 20 : 18,
        TextColor3 = self.Theme.TextSecondary,
        Parent = Tab.Button
    })
    
    -- Tab Label
    Tab.TabLabel = Utility:Create("TextLabel", {
        Size = IsMobile and UDim2.new(1, -50, 1, 0) or UDim2.new(1, -45, 0, 22),
        Position = IsMobile and UDim2.new(0, 46, 0, 0) or UDim2.new(0, 42, 1, -26),
        BackgroundTransparency = 1,
        Text = tabName,
        Font = Enum.Font.GothamSemibold,
        TextSize = IsMobile and 14 : 13,
        TextColor3 = self.Theme.TextSecondary,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
        Parent = Tab.Button
    })
    
    -- Active Indicator
    Tab.ActiveIndicator = Utility:Create("Frame", {
        Name = "ActiveIndicator",
        Size = IsMobile and UDim2.new(0, 0, 1, 0) or UDim2.new(0, 4, 0, 0),
        Position = IsMobile and UDim2.new(0, 0, 1, -4) or UDim2.new(0, 0, 0.5, 0),
        AnchorPoint = IsMobile and Vector2.new(0, 1) or Vector2.new(0, 0.5),
        BackgroundColor3 = self.Theme.Accent,
        BorderSizePixel = 0,
        Parent = Tab.Button
    })
    
    Utility:AddCorner(Tab.ActiveIndicator, IsMobile and 0 or 2)
    
    -- Badge (for notifications count)
    Tab.Badge = Utility:Create("Frame", {
        Name = "Badge",
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(1, -8, 0, 8),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = self.Theme.Error,
        BorderSizePixel = 0,
        Visible = false,
        ZIndex = 10,
        Parent = Tab.Button
    })
    
    Utility:AddCorner(Tab.Badge, 10)
    
    Tab.BadgeLabel = Utility:Create("TextLabel", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = "0",
        Font = Enum.Font.GothamBold,
        TextSize = 11,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Parent = Tab.Badge
    })
    
    -- Tab Content
    Tab.Content = Utility:Create("ScrollingFrame", {
        Name = tabName .. "Content",
        Size = UDim2.new(1, -24, 1, -24),
        Position = UDim2.new(0, 12, 0, 12),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = IsMobile and 3 : 5,
        ScrollBarImageColor3 = self.Theme.Accent,
        ScrollBarImageTransparency = 0.5,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        Visible = false,
        Parent = self.ContentContainer
    })
    
    -- Content Layout
    Tab.ContentLayout = Utility:Create("UIListLayout", {
        Padding = UDim.new(0, 12),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = Tab.Content
    })
    
    -- Update canvas size on content change
    Tab.ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        if Tab.Content and Tab.Content.Parent then
            Tab.Content.CanvasSize = UDim2.new(0, 0, 0, Tab.ContentLayout.AbsoluteContentSize.Y + 12)
        end
    end)
    
    -- Button Interactions
    Tab.Button.MouseButton1Click:Connect(function()
        self:SelectTab(Tab)
        Utility:CreateRipple(Tab.Button, self.Theme.Accent)
    end)
    
    Tab.Button.MouseEnter:Connect(function()
        if self.CurrentTab ~= Tab then
            Utility:Tween(Tab.Button, {
                BackgroundColor3 = self.Theme.Border,
                BackgroundTransparency = self.Theme.HoverTransparency
            }, 0.2)
            Utility:Tween(Tab.IconLabel, {TextColor3 = self.Theme.TextPrimary}, 0.2)
            Utility:Tween(Tab.TabLabel, {TextColor3 = self.Theme.TextPrimary}, 0.2)
        end
    end)
    
    Tab.Button.MouseLeave:Connect(function()
        if self.CurrentTab ~= Tab then
            Utility:Tween(Tab.Button, {
                BackgroundColor3 = self.Theme.Tertiary,
                BackgroundTransparency = self.Theme.ElementTransparency
            }, 0.2)
            Utility:Tween(Tab.IconLabel, {TextColor3 = self.Theme.TextSecondary}, 0.2)
            Utility:Tween(Tab.TabLabel, {TextColor3 = self.Theme.TextSecondary}, 0.2)
        end
    end)
    
    -- Add tab to window
    table.insert(self.Tabs, Tab)
    
    -- Auto-select first tab
    if #self.Tabs == 1 and tabVisible then
        task.defer(function()
            self:SelectTab(Tab)
        end)
    end
    
    -- Add element creation methods
    self:AddElementMethods(Tab)
    
    return Tab
end

function Window:SelectTab(tab)
    if not tab or self.CurrentTab == tab then return end
    
    -- Deselect current tab
    if self.CurrentTab then
        local oldTab = self.CurrentTab
        
        Utility:Tween(oldTab.Button, {
            BackgroundColor3 = self.Theme.Tertiary,
            BackgroundTransparency = self.Theme.ElementTransparency
        }, 0.3)
        
        Utility:Tween(oldTab.IconLabel, {TextColor3 = self.Theme.TextSecondary}, 0.3)
        Utility:Tween(oldTab.TabLabel, {TextColor3 = self.Theme.TextSecondary}, 0.3)
        
        Utility:Tween(oldTab.ActiveIndicator, {
            Size = IsMobile and UDim2.new(0, 0, 1, 0) or UDim2.new(0, 4, 0, 0)
        }, 0.3)
        
        oldTab.Content.Visible = false
    end
    
    -- Select new tab
    self.CurrentTab = tab
    
    Utility:Tween(tab.Button, {
        BackgroundColor3 = self.Theme.Accent,
        BackgroundTransparency = 0.15
    }, 0.3)
    
    Utility:Tween(tab.IconLabel, {TextColor3 = Color3.fromRGB(255, 255, 255)}, 0.3)
    Utility:Tween(tab.TabLabel, {TextColor3 = Color3.fromRGB(255, 255, 255)}, 0.3)
    
    Utility:Tween(tab.ActiveIndicator, {
        Size = IsMobile and UDim2.new(1, 0, 0, 4) or UDim2.new(0, 4, 1, -12)
    }, 0.3)
    
    tab.Content.Visible = true
    
    -- Update status
    self:SetStatus("Switched to " .. tab.Name, 2)
end

function Window:SetBadge(tab, count)
    if not tab or not tab.Badge then return end
    
    tab.Badge.Visible = count > 0
    tab.BadgeLabel.Text = count > 99 and "99+" or tostring(count)
    
    if count > 0 then
        -- Pulse animation
        tab.Badge.Size = UDim2.new(0, 16, 0, 16)
        Utility:Tween(tab.Badge, {Size = UDim2.new(0, 22, 0, 22)}, 0.2, Enum.EasingStyle.Back)
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     ELEMENT METHODS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Window:AddElementMethods(tab)
    
    -- Section
    function tab:CreateSection(name)
        local theme = self.Theme
        
        local section = Utility:Create("Frame", {
            Name = "Section_" .. name,
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency + 0.1,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            Parent = self.Content
        })
        
        Utility:AddCorner(section, 10)
        
        -- Accent bar on left
        local accentBar = Utility:Create("Frame", {
            Size = UDim2.new(0, 4, 0.7, 0),
            Position = UDim2.new(0, 6, 0.15, 0),
            BackgroundColor3 = theme.Accent,
            BorderSizePixel = 0,
            Parent = section
        })
        
        Utility:AddCorner(accentBar, 2)
        
        -- Section title
        local title = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -20, 1, 0),
            Position = UDim2.new(0, 18, 0, 0),
            BackgroundTransparency = 1,
            Text = name,
            Font = Enum.Font.GothamBold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.Accent,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = section
        })
        
        table.insert(self.Elements, section)
        
        return section
    end
    
    -- Label
    function tab:CreateLabel(config)
        config = config or {}
        local text = config.Text or "Label"
        local theme = self.Theme
        
        local labelFrame = Utility:Create("Frame", {
            Name = "Label",
            Size = UDim2.new(1, 0, 0, 35),
            BackgroundTransparency = 1,
            LayoutOrder = #self.Elements + 1,
            Parent = self.Content
        })
        
        local label = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -20, 1, 0),
            Position = UDim2.new(0, 10, 0, 0),
            BackgroundTransparency = 1,
            Text = text,
            Font = Enum.Font.Gotham,
            TextSize = IsMobile and 14 : 13,
            TextColor3 = theme.TextSecondary,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true,
            Parent = labelFrame
        })
        
        table.insert(self.Elements, labelFrame)
        
        return {
            SetText = function(newText)
                if label and label.Parent then
                    label.Text = newText
                end
            end,
            SetColor = function(color)
                if label and label.Parent then
                    Utility:Tween(label, {TextColor3 = color}, 0.2)
                end
            end
        }
    end
    
    -- Button
    function tab:CreateButton(config)
        config = config or {}
        local buttonName = config.Name or "Button"
        local callback = config.Callback or function() end
        local theme = self.Theme
        
        local buttonFrame = Utility:Create("Frame", {
            Name = "ButtonFrame",
            Size = UDim2.new(1, 0, 0, IsMobile and 48 : 45),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            Parent = self.Content
        })
        
        Utility:AddCorner(buttonFrame, 10)
        Utility:AddStroke(buttonFrame, theme.Border, 1, 0.6)
        
        local button = Utility:Create("TextButton", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = "",
            AutoButtonColor = false,
            Parent = buttonFrame
        })
        
        local buttonLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -20, 1, 0),
            Position = UDim2.new(0, 15, 0, 0),
            BackgroundTransparency = 1,
            Text = buttonName,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.TextPrimary,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = buttonFrame
        })
        
        -- Arrow indicator
        local arrow = Utility:Create("TextLabel", {
            Size = UDim2.new(0, 30, 1, 0),
            Position = UDim2.new(1, -35, 0, 0),
            BackgroundTransparency = 1,
            Text = "â†’",
            Font = Enum.Font.GothamBold,
            TextSize = IsMobile and 18 : 16,
            TextColor3 = theme.Accent,
            Parent = buttonFrame
        })
        
        -- Hover animation
        button.MouseEnter:Connect(function()
            Utility:Tween(buttonFrame, {
                BackgroundColor3 = theme.Border,
                BackgroundTransparency = theme.HoverTransparency
            }, 0.2)
            Utility:Tween(arrow, {Position = UDim2.new(1, -30, 0, 0)}, 0.2)
        end)
        
        button.MouseLeave:Connect(function()
            Utility:Tween(buttonFrame, {
                BackgroundColor3 = theme.Tertiary,
                BackgroundTransparency = theme.ElementTransparency
            }, 0.2)
            Utility:Tween(arrow, {Position = UDim2.new(1, -35, 0, 0)}, 0.2)
        end)
        
        -- Click action
        button.MouseButton1Click:Connect(function()
            Utility:CreateRipple(buttonFrame, theme.Accent)
            
            -- Flash effect
            Utility:Tween(buttonFrame, {BackgroundColor3 = theme.Accent}, 0.1)
            task.wait(0.1)
            Utility:Tween(buttonFrame, {BackgroundColor3 = theme.Tertiary}, 0.2)
            
            pcall(callback)
        end)
        
        table.insert(self.Elements, buttonFrame)
        
        return {
            SetText = function(newText)
                if buttonLabel and buttonLabel.Parent then
                    buttonLabel.Text = newText
                end
            end,
            SetCallback = function(newCallback)
                callback = newCallback
            end
        }
    end
    
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     ADVANCED ELEMENTS (Continued)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    -- Toggle Switch
    function tab:CreateToggle(config)
        config = config or {}
        local toggleName = config.Name or "Toggle"
        local default = config.Default or false
        local callback = config.Callback or function() end
        local theme = self.Theme
        
        local toggleFrame = Utility:Create("Frame", {
            Name = "ToggleFrame",
            Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            Parent = self.Content
        })
        
        Utility:AddCorner(toggleFrame, 10)
        Utility:AddStroke(toggleFrame, theme.Border, 1, 0.6)
        
        local toggleLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -80, 1, 0),
            Position = UDim2.new(0, 15, 0, 0),
            BackgroundTransparency = 1,
            Text = toggleName,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.TextPrimary,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true,
            Parent = toggleFrame
        })
        
        -- Toggle Container
        local toggleButton = Utility:Create("TextButton", {
            Size = UDim2.new(0, 52, 0, 28),
            Position = UDim2.new(1, -62, 0.5, -14),
            BackgroundColor3 = default and theme.ToggleOn or theme.ToggleOff,
            BorderSizePixel = 0,
            Text = "",
            AutoButtonColor = false,
            Parent = toggleFrame
        })
        
        Utility:AddCorner(toggleButton, 14)
        
        -- Toggle Circle
        local toggleCircle = Utility:Create("Frame", {
            Size = UDim2.new(0, 22, 0, 22),
            Position = default and UDim2.new(1, -25, 0.5, -11) or UDim2.new(0, 3, 0.5, -11),
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            BorderSizePixel = 0,
            Parent = toggleButton
        })
        
        Utility:AddCorner(toggleCircle, 11)
        
        -- Add shadow to circle
        local circleShadow = Utility:Create("ImageLabel", {
            Size = UDim2.new(1, 8, 1, 8),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Image = "rbxassetid://5554236805",
            ImageColor3 = Color3.fromRGB(0, 0, 0),
            ImageTransparency = 0.8,
            ScaleType = Enum.ScaleType.Slice,
            SliceCenter = Rect.new(23, 23, 277, 277),
            ZIndex = -1,
            Parent = toggleCircle
        })
        
        local toggled = default
        
        -- Click handler
        toggleButton.MouseButton1Click:Connect(function()
            toggled = not toggled
            
            Utility:Tween(toggleButton, {
                BackgroundColor3 = toggled and theme.ToggleOn or theme.ToggleOff
            }, 0.25, Enum.EasingStyle.Quad)
            
            Utility:Tween(toggleCircle, {
                Position = toggled and UDim2.new(1, -25, 0.5, -11) or UDim2.new(0, 3, 0.5, -11)
            }, 0.25, Enum.EasingStyle.Back)
            
            -- Ripple effect
            Utility:CreateRipple(toggleButton, theme.Accent)
            
            pcall(callback, toggled)
        end)
        
        -- Hover effect
        toggleButton.MouseEnter:Connect(function()
            Utility:Tween(toggleCircle, {Size = UDim2.new(0, 24, 0, 24)}, 0.2)
        end)
        
        toggleButton.MouseLeave:Connect(function()
            Utility:Tween(toggleCircle, {Size = UDim2.new(0, 22, 0, 22)}, 0.2)
        end)
        
        table.insert(self.Elements, toggleFrame)
        
        return {
            SetValue = function(value)
                toggled = value
                Utility:Tween(toggleButton, {
                    BackgroundColor3 = toggled and theme.ToggleOn or theme.ToggleOff
                }, 0.25)
                Utility:Tween(toggleCircle, {
                    Position = toggled and UDim2.new(1, -25, 0.5, -11) or UDim2.new(0, 3, 0.5, -11)
                }, 0.25, Enum.EasingStyle.Back)
            end,
            GetValue = function()
                return toggled
            end
        }
    end
    
    -- Slider
    function tab:CreateSlider(config)
        config = config or {}
        local sliderName = config.Name or "Slider"
        local min = config.Min or 0
        local max = config.Max or 100
        local default = config.Default or min
        local increment = config.Increment or 1
        local callback = config.Callback or function() end
        local suffix = config.Suffix or ""
        local theme = self.Theme
        
        local sliderFrame = Utility:Create("Frame", {
            Name = "SliderFrame",
            Size = UDim2.new(1, 0, 0, IsMobile and 75 : 70),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            Parent = self.Content
        })
        
        Utility:AddCorner(sliderFrame, 10)
        Utility:AddStroke(sliderFrame, theme.Border, 1, 0.6)
        
        -- Title
        local sliderLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -80, 0, 25),
            Position = UDim2.new(0, 15, 0, 8),
            BackgroundTransparency = 1,
            Text = sliderName,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.TextPrimary,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = sliderFrame
        })
        
        -- Value Display
        local valueLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(0, 70, 0, 25),
            Position = UDim2.new(1, -80, 0, 8),
            BackgroundColor3 = theme.Quaternary,
            BackgroundTransparency = 0.3,
            BorderSizePixel = 0,
            Text = tostring(default) .. suffix,
            Font = Enum.Font.GothamBold,
            TextSize = IsMobile and 14 : 13,
            TextColor3 = theme.Accent,
            Parent = sliderFrame
        })
        
        Utility:AddCorner(valueLabel, 6)
        
        -- Slider Track
        local sliderTrack = Utility:Create("Frame", {
            Size = UDim2.new(1, -30, 0, 8),
            Position = UDim2.new(0, 15, 1, -25),
            BackgroundColor3 = theme.SliderBackground,
            BorderSizePixel = 0,
            Parent = sliderFrame
        })
        
        Utility:AddCorner(sliderTrack, 4)
        
        -- Slider Fill
        local sliderFill = Utility:Create("Frame", {
            Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
            BackgroundColor3 = theme.SliderFill,
            BorderSizePixel = 0,
            Parent = sliderTrack
        })
        
        Utility:AddCorner(sliderFill, 4)
        
        -- Add gradient to fill
        Utility:AddGradient(sliderFill, ColorSequence.new({
            ColorSequenceKeypoint.new(0, theme.GradientStart),
            ColorSequenceKeypoint.new(0.5, theme.GradientMiddle),
            ColorSequenceKeypoint.new(1, theme.GradientEnd)
        }), 90)
        
        -- Slider Dot
        local sliderDot = Utility:Create("Frame", {
            Size = UDim2.new(0, 18, 0, 18),
            Position = UDim2.new(1, -9, 0.5, -9),
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            BorderSizePixel = 0,
            Parent = sliderFill
        })
        
        Utility:AddCorner(sliderDot, 9)
        
        -- Dot shadow
        local dotShadow = Utility:Create("ImageLabel", {
            Size = UDim2.new(1, 12, 1, 12),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Image = "rbxassetid://5554236805",
            ImageColor3 = theme.Accent,
            ImageTransparency = 0.6,
            ScaleType = Enum.ScaleType.Slice,
            SliceCenter = Rect.new(23, 23, 277, 277),
            ZIndex = -1,
            Parent = sliderDot
        })
        
        local value = default
        local dragging = false
        
        local function updateSlider(input)
            local relativeX = math.clamp((input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X, 0, 1)
            value = math.floor((min + (max - min) * relativeX) / increment + 0.5) * increment
            value = math.clamp(value, min, max)
            
            valueLabel.Text = tostring(value) .. suffix
            
            Utility:Tween(sliderFill, {
                Size = UDim2.new(relativeX, 0, 1, 0)
            }, 0.1, Enum.EasingStyle.Quad)
            
            pcall(callback, value)
        end
        
        sliderTrack.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                updateSlider(input)
                
                Utility:Tween(sliderDot, {Size = UDim2.new(0, 22, 0, 22)}, 0.2, Enum.EasingStyle.Back)
            end
        end)
        
        sliderTrack.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = false
                Utility:Tween(sliderDot, {Size = UDim2.new(0, 18, 0, 18)}, 0.2)
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                updateSlider(input)
            end
        end)
        
        table.insert(self.Elements, sliderFrame)
        
        return {
            SetValue = function(newValue)
                value = math.clamp(newValue, min, max)
                valueLabel.Text = tostring(value) .. suffix
                local relativeX = (value - min) / (max - min)
                Utility:Tween(sliderFill, {Size = UDim2.new(relativeX, 0, 1, 0)}, 0.2)
            end,
            GetValue = function()
                return value
            end
        }
    end
    
    -- Dropdown
    function tab:CreateDropdown(config)
        config = config or {}
        local dropdownName = config.Name or "Dropdown"
        local options = config.Options or {"Option 1", "Option 2", "Option 3"}
        local default = config.Default or options[1]
        local callback = config.Callback or function() end
        local theme = self.Theme
        
        local dropdownFrame = Utility:Create("Frame", {
            Name = "DropdownFrame",
            Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            ClipsDescendants = true,
            Parent = self.Content
        })
        
        Utility:AddCorner(dropdownFrame, 10)
        Utility:AddStroke(dropdownFrame, theme.Border, 1, 0.6)
        
        -- Main Button
        local dropdownButton = Utility:Create("TextButton", {
            Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48),
            BackgroundTransparency = 1,
            Text = "",
            AutoButtonColor = false,
            Parent = dropdownFrame
        })
        
        local dropdownLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -130, 1, 0),
            Position = UDim2.new(0, 15, 0, 0),
            BackgroundTransparency = 1,
            Text = dropdownName,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.TextPrimary,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = dropdownButton
        })
        
        local selectedLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(0, 100, 1, 0),
            Position = UDim2.new(1, -120, 0, 0),
            BackgroundTransparency = 1,
            Text = default,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 14 : 13,
            TextColor3 = theme.Accent,
            TextXAlignment = Enum.TextXAlignment.Right,
            TextTruncate = Enum.TextTruncate.AtEnd,
            Parent = dropdownButton
        })
        
        local arrowIcon = Utility:Create("TextLabel", {
            Size = UDim2.new(0, 20, 1, 0),
            Position = UDim2.new(1, -25, 0, 0),
            BackgroundTransparency = 1,
            Text = "â–¼",
            Font = Enum.Font.GothamBold,
            TextSize = 12,
            TextColor3 = theme.TextSecondary,
            Rotation = 0,
            Parent = dropdownButton
        })
        
        -- Options Container
        local optionsContainer = Utility:Create("ScrollingFrame", {
            Size = UDim2.new(1, 0, 0, 0),
            Position = UDim2.new(0, 0, 0, IsMobile and 52 : 48),
            BackgroundColor3 = theme.Quaternary,
            BackgroundTransparency = 0.1,
            BorderSizePixel = 0,
            ScrollBarThickness = 4,
            ScrollBarImageColor3 = theme.Accent,
            ScrollBarImageTransparency = 0.5,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Visible = false,
            ClipsDescendants = true,
            Parent = dropdownFrame
        })
        
        local optionsLayout = Utility:Create("UIListLayout", {
            Padding = UDim.new(0, 2),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = optionsContainer
        })
        
        Utility:AddPadding(optionsContainer, 4)
        
        local isOpen = false
        local selected = default
        
        -- Create options
        for i, option in ipairs(options) do
            local optionButton = Utility:Create("TextButton", {
                Size = UDim2.new(1, -8, 0, 38),
                BackgroundColor3 = theme.Tertiary,
                BackgroundTransparency = option == selected and 0.2 or 0.4,
                BorderSizePixel = 0,
                Text = option,
                Font = Enum.Font.Gotham,
                TextSize = IsMobile and 14 : 13,
                TextColor3 = option == selected and theme.Accent or theme.TextSecondary,
                AutoButtonColor = false,
                LayoutOrder = i,
                Parent = optionsContainer
            })
            
            Utility:AddCorner(optionButton, 8)
            
            if option == selected then
                local checkmark = Utility:Create("TextLabel", {
                    Size = UDim2.new(0, 20, 1, 0),
                    Position = UDim2.new(1, -25, 0, 0),
                    BackgroundTransparency = 1,
                    Text = "âœ“",
                    Font = Enum.Font.GothamBold,
                    TextSize = 16,
                    TextColor3 = theme.Accent,
                    Parent = optionButton
                })
            end
            
            optionButton.MouseEnter:Connect(function()
                Utility:Tween(optionButton, {
                    BackgroundTransparency = 0.1,
                    TextColor3 = theme.TextPrimary
                }, 0.2)
            end)
            
            optionButton.MouseLeave:Connect(function()
                if option ~= selected then
                    Utility:Tween(optionButton, {
                        BackgroundTransparency = 0.4,
                        TextColor3 = theme.TextSecondary
                    }, 0.2)
                end
            end)
            
            optionButton.MouseButton1Click:Connect(function()
                selected = option
                selectedLabel.Text = option
                
                -- Update all options
                for _, btn in ipairs(optionsContainer:GetChildren()) do
                    if btn:IsA("TextButton") then
                        local isSelected = btn.Text == selected
                        Utility:Tween(btn, {
                            BackgroundTransparency = isSelected and 0.2 or 0.4,
                            TextColor3 = isSelected and theme.Accent or theme.TextSecondary
                        }, 0.2)
                        
                        -- Remove old checkmarks
                        for _, child in ipairs(btn:GetChildren()) do
                            if child.Name == "Checkmark" or child:IsA("TextLabel") and child.Text == "âœ“" then
                                child:Destroy()
                            end
                        end
                        
                        -- Add checkmark to selected
                        if isSelected then
                            Utility:Create("TextLabel", {
                                Name = "Checkmark",
                                Size = UDim2.new(0, 20, 1, 0),
                                Position = UDim2.new(1, -25, 0, 0),
                                BackgroundTransparency = 1,
                                Text = "âœ“",
                                Font = Enum.Font.GothamBold,
                                TextSize = 16,
                                TextColor3 = theme.Accent,
                                Parent = btn
                            })
                        end
                    end
                end
                
                -- Close dropdown
                isOpen = false
                Utility:Tween(dropdownFrame, {
                    Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48)
                }, 0.3, Enum.EasingStyle.Quad)
                Utility:Tween(arrowIcon, {Rotation = 0}, 0.3)
                task.wait(0.3)
                optionsContainer.Visible = false
                
                Utility:CreateRipple(optionButton, theme.Accent)
                pcall(callback, option)
            end)
        end
        
        -- Toggle dropdown
        dropdownButton.MouseButton1Click:Connect(function()
            isOpen = not isOpen
            
            if isOpen then
                local contentHeight = math.min(optionsLayout.AbsoluteContentSize.Y + 8, 180)
                optionsContainer.Size = UDim2.new(1, 0, 0, contentHeight)
                optionsContainer.Visible = true
                
                Utility:Tween(dropdownFrame, {
                    Size = UDim2.new(1, 0, 0, (IsMobile and 52 : 48) + contentHeight + 4)
                }, 0.3, Enum.EasingStyle.Quad)
                Utility:Tween(arrowIcon, {Rotation = 180}, 0.3)
            else
                Utility:Tween(dropdownFrame, {
                    Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48)
                }, 0.3, Enum.EasingStyle.Quad)
                Utility:Tween(arrowIcon, {Rotation = 0}, 0.3)
                task.wait(0.3)
                optionsContainer.Visible = false
            end
            
            Utility:CreateRipple(dropdownButton, theme.Accent)
        end)
        
        table.insert(self.Elements, dropdownFrame)
        
        return {
            SetValue = function(value)
                if table.find(options, value) then
                    selected = value
                    selectedLabel.Text = value
                end
            end,
            GetValue = function()
                return selected
            end,
            SetOptions = function(newOptions)
                options = newOptions
                -- Rebuild options (simplified)
                for _, child in ipairs(optionsContainer:GetChildren()) do
                    if child:IsA("TextButton") then
                        child:Destroy()
                    end
                end
                -- Recreate options (code would be similar to above)
            end
        }
    end
    
    -- TextBox
    function tab:CreateTextBox(config)
        config = config or {}
        local textBoxName = config.Name or "TextBox"
        local placeholder = config.Placeholder or "Enter text..."
        local default = config.Default or ""
        local callback = config.Callback or function() end
        local numbersOnly = config.NumbersOnly or false
        local theme = self.Theme
        
        local textBoxFrame = Utility:Create("Frame", {
            Name = "TextBoxFrame",
            Size = UDim2.new(1, 0, 0, IsMobile and 80 : 75),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            Parent = self.Content
        })
        
        Utility:AddCorner(textBoxFrame, 10)
        Utility:AddStroke(textBoxFrame, theme.Border, 1, 0.6)
        
        local textBoxLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -20, 0, 25),
            Position = UDim2.new(0, 15, 0, 8),
            BackgroundTransparency = 1,
            Text = textBoxName,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.TextPrimary,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = textBoxFrame
        })
        
        local textBox = Utility:Create("TextBox", {
            Size = UDim2.new(1, -30, 0, IsMobile and 38 : 36),
            Position = UDim2.new(0, 15, 1, -(IsMobile and 46 : 44)),
            BackgroundColor3 = theme.InputBackground,
            BackgroundTransparency = 0.2,
            BorderSizePixel = 0,
            Text = default,
            PlaceholderText = placeholder,
            Font = Enum.Font.Gotham,
            TextSize = IsMobile and 14 : 13,
            TextColor3 = theme.TextPrimary,
            PlaceholderColor3 = theme.TextTertiary,
            ClearTextOnFocus = false,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = textBoxFrame
        })
        
        Utility:AddCorner(textBox, 8)
        Utility:AddStroke(textBox, theme.InputBorder, 1, 0.6)
        Utility:AddPadding(textBox, {Left = 12, Right = 12})
        
        -- Focus effects
        textBox.Focused:Connect(function()
            Utility:Tween(textBox, {
                BackgroundTransparency = 0.05,
                BackgroundColor3 = theme.Quaternary
            }, 0.2)
            
            local stroke = textBox:FindFirstChildOfClass("UIStroke")
            if stroke then
                Utility:Tween(stroke, {
                    Color = theme.Accent,
                    Transparency = 0.2
                }, 0.2)
            end
        end)
        
        textBox.FocusLost:Connect(function()
            Utility:Tween(textBox, {
                BackgroundTransparency = 0.2,
                BackgroundColor3 = theme.InputBackground
            }, 0.2)
            
            local stroke = textBox:FindFirstChildOfClass("UIStroke")
            if stroke then
                Utility:Tween(stroke, {
                    Color = theme.InputBorder,
                    Transparency = 0.6
                }, 0.2)
            end
            
            if numbersOnly then
                local num = tonumber(textBox.Text)
                if num then
                    textBox.Text = tostring(num)
                else
                    textBox.Text = default
                end
            end
            
            pcall(callback, textBox.Text)
        end)
        
        if numbersOnly then
            textBox:GetPropertyChangedSignal("Text"):Connect(function()
                textBox.Text = textBox.Text:gsub("[^%d%.%-]", "")
            end)
        end
        
        table.insert(self.Elements, textBoxFrame)
        
        return {
            SetValue = function(value)
                if textBox and textBox.Parent then
                    textBox.Text = tostring(value)
                end
            end,
            GetValue = function()
                return textBox.Text
            end
        }
    end
    
    -- Keybind
    function tab:CreateKeybind(config)
        config = config or {}
        local keybindName = config.Name or "Keybind"
        local default = config.Default or Enum.KeyCode.E
        local callback = config.Callback or function() end
        local theme = self.Theme
        
        local keybindFrame = Utility:Create("Frame", {
            Name = "KeybindFrame",
            Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            Parent = self.Content
        })
        
        Utility:AddCorner(keybindFrame, 10)
        Utility:AddStroke(keybindFrame, theme.Border, 1, 0.6)
        
        local keybindLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -120, 1, 0),
            Position = UDim2.new(0, 15, 0, 0),
            BackgroundTransparency = 1,
            Text = keybindName,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.TextPrimary,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = keybindFrame
        })
        
        local keybindButton = Utility:Create("TextButton", {
            Size = UDim2.new(0, 90, 0, 32),
            Position = UDim2.new(1, -100, 0.5, -16),
            BackgroundColor3 = theme.Quaternary,
            BackgroundTransparency = 0.2,
            BorderSizePixel = 0,
            Text = default.Name,
            Font = Enum.Font.GothamBold,
            TextSize = IsMobile and 13 : 12,
            TextColor3 = theme.Accent,
            AutoButtonColor = false,
            Parent = keybindFrame
        })
        
        Utility:AddCorner(keybindButton, 8)
        Utility:AddStroke(keybindButton, theme.Accent, 1, 0.5)
        
        local currentKey = default
        local listening = false
        
        keybindButton.MouseButton1Click:Connect(function()
            if listening then return end
            
            listening = true
            keybindButton.Text = "..."
            
            Utility:Tween(keybindButton, {
                BackgroundColor3 = theme.Accent,
                BackgroundTransparency = 0.1
            }, 0.2)
            
            local connection
            connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
                if gameProcessed then return end
                
                if input.UserInputType == Enum.UserInputType.Keyboard then
                    currentKey = input.KeyCode
                    keybindButton.Text = currentKey.Name
                    listening = false
                    
                    Utility:Tween(keybindButton, {
                        BackgroundColor3 = theme.Quaternary,
                        BackgroundTransparency = 0.2
                    }, 0.2)
                    
                    connection:Disconnect()
                end
            end)
        end)
        
        -- Listen for key press
        UserInputService.InputBegan:Connect(function(input, gameProcessed)
            if gameProcessed or listening then return end
            
            if input.KeyCode == currentKey then
                Utility:CreateRipple(keybindButton, theme.Accent)
                pcall(callback)
            end
        end)
        
        table.insert(self.Elements, keybindFrame)
        
        return {
            SetValue = function(keyCode)
                currentKey = keyCode
                keybindButton.Text = keyCode.Name
            end,
            GetValue = function()
                return currentKey
            end
        }
    end
    
    -- Color Picker
    function tab:CreateColorPicker(config)
        config = config or {}
        local colorPickerName = config.Name or "Color Picker"
        local default = config.Default or Color3.fromRGB(255, 0, 0)
        local callback = config.Callback or function() end
        local theme = self.Theme
        
        local colorFrame = Utility:Create("Frame", {
            Name = "ColorPickerFrame",
            Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48),
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = theme.ElementTransparency,
            BorderSizePixel = 0,
            LayoutOrder = #self.Elements + 1,
            ClipsDescendants = true,
            Parent = self.Content
        })
        
        Utility:AddCorner(colorFrame, 10)
        Utility:AddStroke(colorFrame, theme.Border, 1, 0.6)
        
        local colorLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(1, -80, 1, 0),
            Position = UDim2.new(0, 15, 0, 0),
            BackgroundTransparency = 1,
            Text = colorPickerName,
            Font = Enum.Font.GothamSemibold,
            TextSize = IsMobile and 15 : 14,
            TextColor3 = theme.TextPrimary,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = colorFrame
        })
        
        local colorDisplay = Utility:Create("TextButton", {
            Size = UDim2.new(0, 50, 0, 32),
            Position = UDim2.new(1, -60, 0.5, -16),
            BackgroundColor3 = default,
            BorderSizePixel = 0,
            Text = "",
            AutoButtonColor = false,
            Parent = colorFrame
        })
        
        Utility:AddCorner(colorDisplay, 8)
        Utility:AddStroke(colorDisplay, Color3.fromRGB(255, 255, 255), 2, 0.3)
        
        local selectedColor = default
        local pickerOpen = false
        
        -- Color Picker Panel
        local pickerPanel = Utility:Create("Frame", {
            Size = UDim2.new(1, -20, 0, 0),
            Position = UDim2.new(0, 10, 0, IsMobile and 60 : 56),
            BackgroundColor3 = theme.Quaternary,
            BackgroundTransparency = 0.1,
            BorderSizePixel = 0,
            Visible = false,
            Parent = colorFrame
        })
        
        Utility:AddCorner(pickerPanel, 8)
        
        -- RGB Sliders
        local rgbFrame = Utility:Create("Frame", {
            Size = UDim2.new(1, -16, 0, 140),
            Position = UDim2.new(0, 8, 0, 8),
            BackgroundTransparency = 1,
            Parent = pickerPanel
        })
        
        local function createRGBSlider(name, color, yPos, value)
            local sliderLabel = Utility:Create("TextLabel", {
                Size = UDim2.new(0, 20, 0, 20),
                Position = UDim2.new(0, 0, 0, yPos),
                BackgroundTransparency = 1,
                Text = name,
                Font = Enum.Font.GothamBold,
                TextSize = 12,
                TextColor3 = color,
                Parent = rgbFrame
            })
            
            local sliderTrack = Utility:Create("Frame", {
                Size = UDim2.new(1, -80, 0, 6),
                Position = UDim2.new(0, 25, 0, yPos + 7),
                BackgroundColor3 = theme.SliderBackground,
                BorderSizePixel = 0,
                Parent = rgbFrame
            })
            
            Utility:AddCorner(sliderTrack, 3)
            
            local sliderFill = Utility:Create("Frame", {
                Size = UDim2.new(value / 255, 0, 1, 0),
                BackgroundColor3 = color,
                BorderSizePixel = 0,
                Parent = sliderTrack
            })
            
            Utility:AddCorner(sliderFill, 3)
            
            local valueLabel = Utility:Create("TextLabel", {
                Size = UDim2.new(0, 40, 0, 20),
                Position = UDim2.new(1, -45, 0, yPos),
                BackgroundTransparency = 1,
                Text = tostring(math.floor(value)),
                Font = Enum.Font.GothamBold,
                TextSize = 11,
                TextColor3 = theme.TextPrimary,
                Parent = rgbFrame
            })
            
            local dragging = false
            
            local function update(input)
                local relativeX = math.clamp((input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X, 0, 1)
                local newValue = math.floor(relativeX * 255)
                
                sliderFill.Size = UDim2.new(relativeX, 0, 1, 0)
                valueLabel.Text = tostring(newValue)
                
                return newValue
            end
            
            sliderTrack.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    local newValue = update(input)
                    
                    if name == "R" then
                        selectedColor = Color3.fromRGB(newValue, selectedColor.G * 255, selectedColor.B * 255)
                    elseif name == "G" then
                        selectedColor = Color3.fromRGB(selectedColor.R * 255, newValue, selectedColor.B * 255)
                    else
                        selectedColor = Color3.fromRGB(selectedColor.R * 255, selectedColor.G * 255, newValue)
                    end
                    
                    colorDisplay.BackgroundColor3 = selectedColor
                    pcall(callback, selectedColor)
                end
            end)
            
            sliderTrack.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local newValue = update(input)
                    
                    if name == "R" then
                        selectedColor = Color3.fromRGB(newValue, selectedColor.G * 255, selectedColor.B * 255)
                    elseif name == "G" then
                        selectedColor = Color3.fromRGB(selectedColor.R * 255, newValue, selectedColor.B * 255)
                    else
                        selectedColor = Color3.fromRGB(selectedColor.R * 255, selectedColor.G * 255, newValue)
                    end
                    
                    colorDisplay.BackgroundColor3 = selectedColor
                    pcall(callback, selectedColor)
                end
            end)
            
            return {sliderFill, valueLabel}
        end
        
        local rSlider = createRGBSlider("R", Color3.fromRGB(255, 100, 100), 0, default.R * 255)
        local gSlider = createRGBSlider("G", Color3.fromRGB(100, 255, 100), 35, default.G * 255)
        local bSlider = createRGBSlider("B", Color3.fromRGB(100, 100, 255), 70, default.B * 255)
        
        -- Hex Input
        local hexLabel = Utility:Create("TextLabel", {
            Size = UDim2.new(0, 35, 0, 20),
            Position = UDim2.new(0, 0, 0, 110),
            BackgroundTransparency = 1,
            Text = "HEX:",
            Font = Enum.Font.GothamBold,
            TextSize = 11,
            TextColor3 = theme.TextPrimary,
            Parent = rgbFrame
        })
        
        local hexBox = Utility:Create("TextBox", {
            Size = UDim2.new(1, -40, 0, 24),
            Position = UDim2.new(0, 38, 0, 108),
            BackgroundColor3 = theme.InputBackground,
            BackgroundTransparency = 0.3,
            BorderSizePixel = 0,
            Text = Utility:ColorToHex(default),
            Font = Enum.Font.Gotham,
            TextSize = 12,
            TextColor3 = theme.TextPrimary,
            PlaceholderText = "#FFFFFF",
            Parent = rgbFrame
        })
        
        Utility:AddCorner(hexBox, 6)
        Utility:AddPadding(hexBox, {Left = 8, Right = 8})
        
        hexBox.FocusLost:Connect(function()
            local success, color = pcall(function()
                return Utility:ColorFromHex(hexBox.Text)
            end)
            
            if success and color then
                selectedColor = color
                colorDisplay.BackgroundColor3 = color
                
                rSlider[1].Size = UDim2.new(color.R, 0, 1, 0)
                rSlider[2].Text = tostring(math.floor(color.R * 255))
                
                gSlider[1].Size = UDim2.new(color.G, 0, 1, 0)
                gSlider[2].Text = tostring(math.floor(color.G * 255))
                
                bSlider[1].Size = UDim2.new(color.B, 0, 1, 0)
                bSlider[2].Text = tostring(math.floor(color.B * 255))
                
                pcall(callback, color)
            else
                hexBox.Text = Utility:ColorToHex(selectedColor)
            end
        end)
        
        pickerPanel.Size = UDim2.new(1, -20, 0, 156)
        
        -- Toggle picker
        colorDisplay.MouseButton1Click:Connect(function()
            pickerOpen = not pickerOpen
            
            if pickerOpen then
                pickerPanel.Visible = true
                Utility:Tween(colorFrame, {
                    Size = UDim2.new(1, 0, 0, (IsMobile and 60 : 56) + 164)
                }, 0.3, Enum.EasingStyle.Quad)
            else
                Utility:Tween(colorFrame, {
                    Size = UDim2.new(1, 0, 0, IsMobile and 52 : 48)
                }, 0.3, Enum.EasingStyle.Quad)
                task.wait(0.3)
                pickerPanel.Visible = false
            end
            
            Utility:CreateRipple(colorDisplay, theme.Accent)
        end)
        
        table.insert(self.Elements, colorFrame)
        
        return {
            SetValue = function(color)
                selectedColor = color
                colorDisplay.BackgroundColor3 = color
                hexBox.Text = Utility:ColorToHex(color)
            end,
            GetValue = function()
                return selectedColor
            end
        }
    end
    
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     NOTIFICATION SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function QuantumFlex:Notify(config)
    config = config or {}
    local title = config.Title or "Notification"
    local content = config.Content or "This is a notification"
    local duration = config.Duration or 3
    local notifType = config.Type or "Info" -- Info, Success, Warning, Error
    local theme = self.CurrentTheme
    
    -- Notification GUI
    local notifGui = Utility:Create("ScreenGui", {
        Name = "QuantumNotification",
        Parent = GuiParent,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999
    })
    
    local notifContainer = Utility:Create("Frame", {
        Size = UDim2.new(0, 0, 0, 90),
        Position = UDim2.new(1, -20, 0, 20),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundColor3 = theme.Primary,
        BackgroundTransparency = theme.BackgroundTransparency,
        BorderSizePixel = 0,
        Parent = notifGui
    })
    
    Utility:AddCorner(notifContainer, 12)
    Utility:AddStroke(notifContainer, theme.Border, 2, 0.4)
    Utility:AddShadow(notifContainer, 40, 0.8)
    
    -- Type colors
    local typeColors = {
        Info = theme.Info,
        Success = theme.Success,
        Warning = theme.Warning,
        Error = theme.Error
    }
    
    local typeIcons = {
        Info = Icons.Info,
        Success = Icons.Success,
        Warning = Icons.Warning,
        Error = Icons.Error
    }
    
    local accentColor = typeColors[notifType] or theme.Accent
    
    -- Accent bar
    local accentBar = Utility:Create("Frame", {
        Size = UDim2.new(0, 5, 1, 0),
        BackgroundColor3 = accentColor,
        BorderSizePixel = 0,
        Parent = notifContainer
    })
    
    Utility:AddCorner(accentBar, 0)
    
    -- Icon
    local iconLabel = Utility:Create("TextLabel", {
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(0, 15, 0, 10),
        BackgroundColor3 = accentColor,
        BackgroundTransparency = 0.8,
        BorderSizePixel = 0,
        Text = typeIcons[notifType] or Icons.Info,
        Font = Enum.Font.GothamBold,
        TextSize = 22,
        TextColor3 = accentColor,
        Parent = notifContainer
    })
    
    Utility:AddCorner(iconLabel, 10)
    
    -- Title
    local titleLabel = Utility:Create("TextLabel", {
        Size = UDim2.new(1, -105, 0, 24),
        Position = UDim2.new(0, 65, 0, 12),
        BackgroundTransparency = 1,
        Text = title,
        Font = Enum.Font.GothamBold,
        TextSize = 14,
        TextColor3 = theme.TextPrimary,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
        Parent = notifContainer
    })
    
    -- Content
    local contentLabel = Utility:Create("TextLabel", {
        Size = UDim2.new(1, -105, 0, 42),
        Position = UDim2.new(0, 65, 0, 38),
        BackgroundTransparency = 1,
        Text = content,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextColor3 = theme.TextSecondary,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true,
        Parent = notifContainer
    })
    
    -- Close button
    local closeBtn = Utility:Create("TextButton", {
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -38, 0, 8),
        BackgroundColor3 = theme.Tertiary,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Text = "âœ•",
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextColor3 = theme.TextSecondary,
        AutoButtonColor = false,
        Parent = notifContainer
    })
    
    Utility:AddCorner(closeBtn, 8)
    
    closeBtn.MouseEnter:Connect(function()
        Utility:Tween(closeBtn, {
            BackgroundColor3 = theme.Error,
            BackgroundTransparency = 0.2,
            TextColor3 = Color3.fromRGB(255, 255, 255)
        }, 0.2)
    end)
    
    closeBtn.MouseLeave:Connect(function()
        Utility:Tween(closeBtn, {
            BackgroundColor3 = theme.Tertiary,
            BackgroundTransparency = 0.5,
            TextColor3 = theme.TextSecondary
        }, 0.2)
    end)
    
    local function closeNotification()
        Utility:Tween(notifContainer, {
            Size = UDim2.new(0, 0, 0, 90),
            Position = UDim2.new(1, 0, 0, 20)
        }, 0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In, function()
            pcall(function() notifGui:Destroy() end)
        end)
    end
    
    closeBtn.MouseButton1Click:Connect(closeNotification)
    
    -- Progress bar
    local progressBar = Utility:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 3),
        Position = UDim2.new(0, 0, 1, -3),
        BackgroundColor3 = accentColor,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0,
        Parent = notifContainer
    })
    
    -- Entrance animation
    Utility:Tween(notifContainer, {
        Size = UDim2.new(0, 350, 0, 90)
    }, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    -- Progress animation
    Utility:Tween(progressBar, {
        Size = UDim2.new(0, 0, 0, 3)
    }, duration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
    
    -- Auto close
    task.delay(duration, closeNotification)
    
    -- Reposition existing notifications
    for i, existingNotif in ipairs(QuantumFlex.Notifications) do
        if existingNotif and existingNotif.Parent then
            Utility:Tween(existingNotif, {
                Position = UDim2.new(1, -20, 0, 20 + (i * 100))
            }, 0.3)
        end
    end
    
    table.insert(QuantumFlex.Notifications, notifContainer)
    
    -- Cleanup after close
    task.delay(duration + 0.5, function()
        for i, notif in ipairs(QuantumFlex.Notifications) do
            if notif == notifContainer then
                table.remove(QuantumFlex.Notifications, i)
                break
            end
        end
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     TOOLTIP SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Window:ShowTooltip(element, text)
    if IsMobile or not text then return end
    
    -- Remove existing tooltip
    self:HideTooltip()
    
    local theme = self.Theme
    
    self.TooltipGui = Utility:Create("ScreenGui", {
        Name = "QuantumTooltip",
        Parent = GuiParent,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 1000
    })
    
    local tooltipFrame = Utility:Create("Frame", {
        Size = UDim2.new(0, 0, 0, 32),
        Position = UDim2.new(0, Mouse.X + 15, 0, Mouse.Y + 15),
        BackgroundColor3 = theme.Quaternary,
        BackgroundTransparency = 0.1,
        BorderSizePixel = 0,
        Parent = self.TooltipGui
    })
    
    Utility:AddCorner(tooltipFrame, 8)
    Utility:AddStroke(tooltipFrame, theme.Accent, 1, 0.5)
    
    local tooltipLabel = Utility:Create("TextLabel", {
        Size = UDim2.new(1, -16, 1, 0),
        Position = UDim2.new(0, 8, 0, 0),
        BackgroundTransparency = 1,
        Text = text,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextColor3 = theme.TextPrimary,
        TextXAlignment = Enum.TextXAlignment.Center,
        Parent = tooltipFrame
    })
    
    -- Auto-size
    local textSize = Utility:GetTextSize(text, 12, Enum.Font.Gotham)
    tooltipFrame.Size = UDim2.new(0, textSize.X + 20, 0, 32)
    
    -- Follow mouse
    local connection
    connection = RunService.RenderStepped:Connect(function()
        if tooltipFrame and tooltipFrame.Parent then
            tooltipFrame.Position = UDim2.new(0, Mouse.X + 15, 0, Mouse.Y + 15)
        else
            connection:Disconnect()
        end
    end)
    
    table.insert(self.Connections, connection)
end

function Window:HideTooltip()
    if self.TooltipGui and self.TooltipGui.Parent then
        pcall(function() self.TooltipGui:Destroy() end)
        self.TooltipGui = nil
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     THEME SWITCHER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Window:ToggleThemeMenu()
    -- Create theme selection menu (simplified version)
    QuantumFlex:Notify({
        Title = "Theme Menu",
        Content = "Theme switching system - Coming soon!",
        Type = "Info",
        Duration = 2
    })
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     MAIN LIBRARY FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function QuantumFlex:CreateWindow(config)
    return Window.new(config)
end

function QuantumFlex:SetTheme(themeName)
    if self.Themes[themeName] then
        self.CurrentTheme = self.Themes[themeName]
        
        -- Update existing windows
        for _, window in ipairs(self.Windows) do
            if window and window.Container and window.Container.Parent then
                window.Theme = self.CurrentTheme
                -- Apply theme updates (simplified)
            end
        end
        
        return true
    end
    return false
end

function QuantumFlex:GetThemes()
    local themeList = {}
    for name, _ in pairs(self.Themes) do
        table.insert(themeList, name)
    end
    return themeList
end

function QuantumFlex:DestroyAll()
    for _, window in ipairs(self.Windows) do
        if window and window.Destroy then
            pcall(function() window:Destroy() end)
        end
    end
    
    self.Windows = {}
    self._index = {}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     INITIALIZATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Protected initialization
local function Initialize()
    -- Check for executor compatibility
    local executorChecks = {
        game = game ~= nil,
        HttpService = pcall(function() return game:GetService("HttpService") end),
        TweenService = pcall(function() return game:GetService("TweenService") end),
        UserInputService = pcall(function() return game:GetService("UserInputService") end),
    }
    
    for check, result in pairs(executorChecks) do
        if not result then
            warn("[Quantum Flex] Executor compatibility issue:", check)
        end
    end
    
    -- Welcome notification
    task.delay(0.5, function()
        QuantumFlex:Notify({
            Title = "Quantum Flex UI Loaded",
            Content = "Version " .. QuantumFlex._VERSION .. " initialized successfully!",
            Type = "Success",
            Duration = 4
        })
    end)
end

-- Safe initialization
pcall(Initialize)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                     RETURN LIBRARY
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

return QuantumFlex
