--[[
    FlexUI - Professional Roblox UI Library
    Version: 2.0.0
    Author: Custom Built
    Features:
    - Full Mobile & PC Support
    - Dark Theme with Transparency
    - Smooth Animations
    - Executor Compatible (Synapse, Script-Ware, Krnl, Fluxus, etc.)
    - Draggable Windows
    - Notifications System
    - Keybind System
    - Config Save/Load System
]]

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")
local TextService = game:GetService("TextService")
local GuiService = game:GetService("GuiService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local ContentProvider = game:GetService("ContentProvider")
local MarketplaceService = game:GetService("MarketplaceService")
local SoundService = game:GetService("SoundService")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Stats = game:GetService("Stats")

--// Player
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = Workspace.CurrentCamera

--// Executor Detection & Compatibility
local ExecutorName = "Unknown"
local ExecutorFunctions = {}

local function DetectExecutor()
    if syn then
        ExecutorName = "Synapse X"
        ExecutorFunctions = {
            request = syn.request,
            crypt = syn.crypt,
            protect_gui = syn.protect_gui,
            queue_on_teleport = syn.queue_on_teleport
        }
    elseif KRNL_LOADED then
        ExecutorName = "Krnl"
        ExecutorFunctions = {
            request = request or http_request,
            queue_on_teleport = queue_on_teleport
        }
    elseif fluxus then
        ExecutorName = "Fluxus"
        ExecutorFunctions = {
            request = request or http_request,
            queue_on_teleport = queue_on_teleport
        }
    elseif getexecutorname then
        ExecutorName = getexecutorname()
        ExecutorFunctions = {
            request = request or http_request or http.request,
            queue_on_teleport = queue_on_teleport
        }
    elseif identifyexecutor then
        ExecutorName = identifyexecutor()
        ExecutorFunctions = {
            request = request or http_request,
            queue_on_teleport = queue_on_teleport
        }
    else
        ExecutorName = "Unknown/Studio"
        ExecutorFunctions = {
            request = function() warn("HTTP Request not supported") end,
            queue_on_teleport = function() warn("Queue on teleport not supported") end
        }
    end
    return ExecutorName
end

DetectExecutor()

--// Safe GUI Parent
local function GetSafeParent()
    local success, result = pcall(function()
        if syn and syn.protect_gui then
            return CoreGui
        elseif gethui then
            return gethui()
        elseif get_hidden_gui then
            return get_hidden_gui()
        else
            return CoreGui
        end
    end)
    
    if success and result then
        return result
    else
        return LocalPlayer:WaitForChild("PlayerGui")
    end
end

--// Device Detection
local function IsMobile()
    return UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
end

local function IsTablet()
    local screenSize = Camera.ViewportSize
    return UserInputService.TouchEnabled and (screenSize.X > 1000 or screenSize.Y > 700)
end

local function IsPC()
    return UserInputService.KeyboardEnabled and UserInputService.MouseEnabled
end

local DeviceType = IsMobile() and "Mobile" or (IsTablet() and "Tablet" or "PC")

--// Utility Functions
local Utility = {}

function Utility.Create(instanceType, properties, children)
    local instance = Instance.new(instanceType)
    
    for property, value in pairs(properties or {}) do
        if property ~= "Parent" then
            local success, err = pcall(function()
                instance[property] = value
            end)
            if not success then
                warn("FlexUI: Failed to set property " .. property .. ": " .. tostring(err))
            end
        end
    end
    
    for _, child in pairs(children or {}) do
        child.Parent = instance
    end
    
    if properties and properties.Parent then
        instance.Parent = properties.Parent
    end
    
    return instance
end

function Utility.Tween(instance, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(
        duration or 0.3,
        easingStyle or Enum.EasingStyle.Quart,
        easingDirection or Enum.EasingDirection.Out
    )
    
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

function Utility.TweenWait(instance, properties, duration, easingStyle, easingDirection)
    local tween = Utility.Tween(instance, properties, duration, easingStyle, easingDirection)
    tween.Completed:Wait()
    return tween
end

function Utility.Ripple(button, x, y)
    local ripple = Utility.Create("Frame", {
        Name = "Ripple",
        Parent = button,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(0, x - button.AbsolutePosition.X, 0, y - button.AbsolutePosition.Y),
        Size = UDim2.new(0, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = button.ZIndex + 1
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = ripple
    })
    
    local maxSize = math.max(button.AbsoluteSize.X, button.AbsoluteSize.Y) * 2
    
    Utility.Tween(ripple, {
        Size = UDim2.new(0, maxSize, 0, maxSize),
        BackgroundTransparency = 1
    }, 0.5)
    
    task.delay(0.5, function()
        ripple:Destroy()
    end)
end

function Utility.DeepCopy(original)
    local copy = {}
    for key, value in pairs(original) do
        if type(value) == "table" then
            copy[key] = Utility.DeepCopy(value)
        else
            copy[key] = value
        end
    end
    return copy
end

function Utility.Round(number, decimalPlaces)
    local mult = 10 ^ (decimalPlaces or 0)
    return math.floor(number * mult + 0.5) / mult
end

function Utility.Clamp(value, min, max)
    return math.max(min, math.min(max, value))
end

function Utility.Lerp(a, b, t)
    return a + (b - a) * t
end

function Utility.Map(value, inMin, inMax, outMin, outMax)
    return (value - inMin) * (outMax - outMin) / (inMax - inMin) + outMin
end

function Utility.RandomString(length)
    local chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
    local result = ""
    for i = 1, length do
        local index = math.random(1, #chars)
        result = result .. chars:sub(index, index)
    end
    return result
end

function Utility.FormatNumber(number)
    local suffixes = {"", "K", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc"}
    local index = 1
    while number >= 1000 and index < #suffixes do
        number = number / 1000
        index = index + 1
    end
    return string.format("%.1f%s", number, suffixes[index])
end

function Utility.HexToRGB(hex)
    hex = hex:gsub("#", "")
    return Color3.fromRGB(
        tonumber(hex:sub(1, 2), 16),
        tonumber(hex:sub(3, 4), 16),
        tonumber(hex:sub(5, 6), 16)
    )
end

function Utility.RGBToHex(color)
    return string.format("#%02X%02X%02X", 
        math.floor(color.R * 255), 
        math.floor(color.G * 255), 
        math.floor(color.B * 255)
    )
end

function Utility.GetTextSize(text, fontSize, font, frameSize)
    return TextService:GetTextSize(text, fontSize, font, frameSize or Vector2.new(math.huge, math.huge))
end

function Utility.Debounce(func, delay)
    local lastCall = 0
    return function(...)
        local now = tick()
        if now - lastCall >= delay then
            lastCall = now
            return func(...)
        end
    end
end

function Utility.Throttle(func, delay)
    local lastCall = 0
    local scheduled = false
    local lastArgs = nil
    
    return function(...)
        lastArgs = {...}
        local now = tick()
        
        if now - lastCall >= delay then
            lastCall = now
            return func(...)
        elseif not scheduled then
            scheduled = true
            task.delay(delay - (now - lastCall), function()
                scheduled = false
                lastCall = tick()
                func(unpack(lastArgs))
            end)
        end
    end
end

--// Color Utility
local ColorUtility = {}

function ColorUtility.Darken(color, percent)
    return Color3.new(
        color.R * (1 - percent),
        color.G * (1 - percent),
        color.B * (1 - percent)
    )
end

function ColorUtility.Lighten(color, percent)
    return Color3.new(
        color.R + (1 - color.R) * percent,
        color.G + (1 - color.G) * percent,
        color.B + (1 - color.B) * percent
    )
end

function ColorUtility.SetSaturation(color, saturation)
    local h, s, v = Color3.toHSV(color)
    return Color3.fromHSV(h, saturation, v)
end

function ColorUtility.SetValue(color, value)
    local h, s, v = Color3.toHSV(color)
    return Color3.fromHSV(h, s, value)
end

function ColorUtility.Invert(color)
    return Color3.new(1 - color.R, 1 - color.G, 1 - color.B)
end

function ColorUtility.Mix(color1, color2, t)
    return Color3.new(
        Utility.Lerp(color1.R, color2.R, t),
        Utility.Lerp(color1.G, color2.G, t),
        Utility.Lerp(color1.B, color2.B, t)
    )
end

--// Theme System
local Theme = {
    -- Main Colors
    Primary = Color3.fromRGB(88, 101, 242),
    Secondary = Color3.fromRGB(78, 91, 232),
    Accent = Color3.fromRGB(114, 137, 218),
    
    -- Background Colors
    Background = Color3.fromRGB(18, 18, 24),
    BackgroundSecondary = Color3.fromRGB(24, 24, 32),
    BackgroundTertiary = Color3.fromRGB(32, 32, 42),
    
    -- Surface Colors
    Surface = Color3.fromRGB(28, 28, 38),
    SurfaceHover = Color3.fromRGB(38, 38, 50),
    SurfaceActive = Color3.fromRGB(48, 48, 62),
    
    -- Border Colors
    Border = Color3.fromRGB(48, 48, 62),
    BorderHover = Color3.fromRGB(68, 68, 85),
    BorderActive = Color3.fromRGB(88, 101, 242),
    
    -- Text Colors
    TextPrimary = Color3.fromRGB(255, 255, 255),
    TextSecondary = Color3.fromRGB(185, 185, 195),
    TextTertiary = Color3.fromRGB(125, 125, 140),
    TextDisabled = Color3.fromRGB(85, 85, 100),
    
    -- Status Colors
    Success = Color3.fromRGB(67, 181, 129),
    Warning = Color3.fromRGB(250, 166, 26),
    Error = Color3.fromRGB(240, 71, 71),
    Info = Color3.fromRGB(59, 165, 222),
    
    -- Toggle Colors
    ToggleOn = Color3.fromRGB(88, 101, 242),
    ToggleOff = Color3.fromRGB(72, 72, 85),
    ToggleKnob = Color3.fromRGB(255, 255, 255),
    
    -- Slider Colors
    SliderFill = Color3.fromRGB(88, 101, 242),
    SliderTrack = Color3.fromRGB(48, 48, 62),
    SliderKnob = Color3.fromRGB(255, 255, 255),
    
    -- Dropdown Colors
    DropdownBackground = Color3.fromRGB(24, 24, 32),
    DropdownHover = Color3.fromRGB(38, 38, 50),
    DropdownSelected = Color3.fromRGB(88, 101, 242),
    
    -- Scrollbar Colors
    ScrollbarTrack = Color3.fromRGB(32, 32, 42),
    ScrollbarThumb = Color3.fromRGB(58, 58, 72),
    ScrollbarThumbHover = Color3.fromRGB(78, 78, 95),
    
    -- Shadow
    Shadow = Color3.fromRGB(0, 0, 0),
    ShadowTransparency = 0.5,
    
    -- Transparency
    BackgroundTransparency = 0.05,
    SurfaceTransparency = 0.02,
    
    -- Font
    Font = Enum.Font.GothamSemibold,
    FontLight = Enum.Font.Gotham,
    FontBold = Enum.Font.GothamBold,
    
    -- Sizes
    CornerRadius = UDim.new(0, 8),
    CornerRadiusSmall = UDim.new(0, 4),
    CornerRadiusLarge = UDim.new(0, 12),
    
    -- Animation
    TweenSpeed = 0.25,
    TweenSpeedFast = 0.15,
    TweenSpeedSlow = 0.4,
    EasingStyle = Enum.EasingStyle.Quart,
    EasingDirection = Enum.EasingDirection.Out,
}

local ThemePresets = {
    Dark = {
        Primary = Color3.fromRGB(88, 101, 242),
        Background = Color3.fromRGB(18, 18, 24),
        BackgroundSecondary = Color3.fromRGB(24, 24, 32),
        Surface = Color3.fromRGB(28, 28, 38),
        TextPrimary = Color3.fromRGB(255, 255, 255),
    },
    Midnight = {
        Primary = Color3.fromRGB(138, 43, 226),
        Background = Color3.fromRGB(12, 12, 18),
        BackgroundSecondary = Color3.fromRGB(18, 18, 26),
        Surface = Color3.fromRGB(24, 24, 34),
        TextPrimary = Color3.fromRGB(255, 255, 255),
    },
    Ocean = {
        Primary = Color3.fromRGB(0, 150, 199),
        Background = Color3.fromRGB(15, 22, 30),
        BackgroundSecondary = Color3.fromRGB(22, 32, 44),
        Surface = Color3.fromRGB(28, 40, 55),
        TextPrimary = Color3.fromRGB(255, 255, 255),
    },
    Forest = {
        Primary = Color3.fromRGB(46, 204, 113),
        Background = Color3.fromRGB(18, 24, 20),
        BackgroundSecondary = Color3.fromRGB(24, 32, 26),
        Surface = Color3.fromRGB(30, 40, 32),
        TextPrimary = Color3.fromRGB(255, 255, 255),
    },
    Blood = {
        Primary = Color3.fromRGB(220, 20, 60),
        Background = Color3.fromRGB(24, 16, 18),
        BackgroundSecondary = Color3.fromRGB(32, 22, 24),
        Surface = Color3.fromRGB(40, 28, 30),
        TextPrimary = Color3.fromRGB(255, 255, 255),
    },
    Sunset = {
        Primary = Color3.fromRGB(255, 107, 53),
        Background = Color3.fromRGB(26, 20, 18),
        BackgroundSecondary = Color3.fromRGB(34, 26, 22),
        Surface = Color3.fromRGB(42, 32, 28),
        TextPrimary = Color3.fromRGB(255, 255, 255),
    }
}

--// Signal Class (Custom Event System)
local Signal = {}
Signal.__index = Signal

function Signal.new()
    local self = setmetatable({}, Signal)
    self._connections = {}
    self._lastFire = nil
    return self
end

function Signal:Connect(callback)
    local connection = {
        Callback = callback,
        Connected = true
    }
    
    function connection:Disconnect()
        self.Connected = false
    end
    
    table.insert(self._connections, connection)
    return connection
end

function Signal:Once(callback)
    local connection
    connection = self:Connect(function(...)
        connection:Disconnect()
        callback(...)
    end)
    return connection
end

function Signal:Fire(...)
    self._lastFire = {...}
    for _, connection in ipairs(self._connections) do
        if connection.Connected then
            task.spawn(connection.Callback, ...)
        end
    end
end

function Signal:Wait()
    local thread = coroutine.running()
    local connection
    connection = self:Connect(function(...)
        connection:Disconnect()
        task.spawn(thread, ...)
    end)
    return coroutine.yield()
end

function Signal:Destroy()
    for _, connection in ipairs(self._connections) do
        connection.Connected = false
    end
    self._connections = {}
end

--// Spring Animation Class
local Spring = {}
Spring.__index = Spring

function Spring.new(mass, force, damping, speed)
    local self = setmetatable({}, Spring)
    
    self.Target = 0
    self.Position = 0
    self.Velocity = 0
    
    self.Mass = mass or 1
    self.Force = force or 50
    self.Damping = damping or 4
    self.Speed = speed or 4
    
    return self
end

function Spring:Update(deltaTime)
    local scaledDeltaTime = math.min(deltaTime, 1) * self.Speed
    
    local force = self.Force * (self.Target - self.Position)
    local damping = self.Damping * self.Velocity
    local acceleration = (force - damping) / self.Mass
    
    self.Velocity = self.Velocity + acceleration * scaledDeltaTime
    self.Position = self.Position + self.Velocity * scaledDeltaTime
    
    return self.Position
end

function Spring:Impulse(force)
    self.Velocity = self.Velocity + force
end

--// Icon Provider
local Icons = {
    Close = "rbxassetid://7072725342",
    Minimize = "rbxassetid://7072719587",
    Maximize = "rbxassetid://7072718687",
    Settings = "rbxassetid://7072706663",
    Home = "rbxassetid://7072717857",
    Search = "rbxassetid://7072706318",
    Menu = "rbxassetid://7072719338",
    ArrowRight = "rbxassetid://7072706230",
    ArrowLeft = "rbxassetid://7072706377",
    ArrowUp = "rbxassetid://7072706149",
    ArrowDown = "rbxassetid://7072706620",
    Check = "rbxassetid://7072706837",
    Plus = "rbxassetid://7072725812",
    Minus = "rbxassetid://7072719509",
    Refresh = "rbxassetid://7072706448",
    Copy = "rbxassetid://7072717190",
    Paste = "rbxassetid://7072724873",
    Delete = "rbxassetid://7072717474",
    Edit = "rbxassetid://7072717649",
    Save = "rbxassetid://7072706512",
    Load = "rbxassetid://7072718953",
    Info = "rbxassetid://7072718152",
    Warning = "rbxassetid://7072706020",
    Error = "rbxassetid://7072717649",
    Success = "rbxassetid://7072706837",
    User = "rbxassetid://7072705994",
    Lock = "rbxassetid://7072718840",
    Unlock = "rbxassetid://7072705901",
    Eye = "rbxassetid://7072717768",
    EyeOff = "rbxassetid://7072717649",
    Key = "rbxassetid://7072718505",
    Keyboard = "rbxassetid://7072718429",
    Mouse = "rbxassetid://7072719422",
    Gamepad = "rbxassetid://7072717940",
    Phone = "rbxassetid://7072724979",
    Desktop = "rbxassetid://7072717388",
    Folder = "rbxassetid://7072717857",
    File = "rbxassetid://7072717649",
    Image = "rbxassetid://7072718069",
    Video = "rbxassetid://7072705967",
    Audio = "rbxassetid://7072724288",
    Code = "rbxassetid://7072717107",
    Terminal = "rbxassetid://7072705852",
    Bug = "rbxassetid://7072724449",
    Star = "rbxassetid://7072706580",
    Heart = "rbxassetid://7072717994",
    Flag = "rbxassetid://7072717768",
    Bell = "rbxassetid://7072724364",
    Gift = "rbxassetid://7072717857",
    Trophy = "rbxassetid://7072705936",
    Crown = "rbxassetid://7072717290",
    Shield = "rbxassetid://7072706580",
    Sword = "rbxassetid://7072705823",
    Zap = "rbxassetid://7072705758",
    Fire = "rbxassetid://7072717768",
    Water = "rbxassetid://7072705967",
    Wind = "rbxassetid://7072705790",
    Earth = "rbxassetid://7072717561",
    Sun = "rbxassetid://7072705877",
    Moon = "rbxassetid://7072719338",
    Cloud = "rbxassetid://7072717024",
    Rainbow = "rbxassetid://7072725137",
    Palette = "rbxassetid://7072724820",
    Brush = "rbxassetid://7072724525",
    Wand = "rbxassetid://7072705967",
    Magic = "rbxassetid://7072718953",
}

--// Sound Provider
local Sounds = {
    Click = "rbxassetid://6895079853",
    Hover = "rbxassetid://6895079648",
    Toggle = "rbxassetid://6895079443",
    Success = "rbxassetid://6895079236",
    Error = "rbxassetid://6895079029",
    Notification = "rbxassetid://6895078822",
    Open = "rbxassetid://6895078615",
    Close = "rbxassetid://6895078408",
    Slider = "rbxassetid://6895078201",
    Dropdown = "rbxassetid://6895077994",
}

local function PlaySound(soundName, volume)
    if not Sounds[soundName] then return end
    
    local sound = Instance.new("Sound")
    sound.SoundId = Sounds[soundName]
    sound.Volume = volume or 0.5
    sound.Parent = SoundService
    sound:Play()
    sound.Ended:Connect(function()
        sound:Destroy()
    end)
end

--// Main Library
local FlexUI = {}
FlexUI.__index = FlexUI

FlexUI.Version = "2.0.0"
FlexUI.Theme = Theme
FlexUI.Utility = Utility
FlexUI.ColorUtility = ColorUtility
FlexUI.Signal = Signal
FlexUI.Spring = Spring
FlexUI.Icons = Icons
FlexUI.Sounds = Sounds
FlexUI.ThemePresets = ThemePresets
FlexUI.DeviceType = DeviceType
FlexUI.ExecutorName = ExecutorName
FlexUI.IsMobile = IsMobile()

FlexUI.Windows = {}
FlexUI.Notifications = {}
FlexUI.Flags = {}
FlexUI.Connections = {}
FlexUI.ToggleKey = Enum.KeyCode.RightControl

--// Configuration System
local ConfigSystem = {}
ConfigSystem.__index = ConfigSystem

function ConfigSystem.new(libraryName)
    local self = setmetatable({}, ConfigSystem)
    self.LibraryName = libraryName or "FlexUI"
    self.ConfigFolder = self.LibraryName .. "/Configs"
    return self
end

function ConfigSystem:EnsureFolder()
    if not isfolder then return false end
    
    if not isfolder(self.LibraryName) then
        makefolder(self.LibraryName)
    end
    
    if not isfolder(self.ConfigFolder) then
        makefolder(self.ConfigFolder)
    end
    
    return true
end

function ConfigSystem:Save(configName, data)
    if not writefile then 
        warn("FlexUI: Config save not supported in this executor")
        return false 
    end
    
    self:EnsureFolder()
    
    local success, encoded = pcall(function()
        return HttpService:JSONEncode(data)
    end)
    
    if success then
        local writeSuccess = pcall(function()
            writefile(self.ConfigFolder .. "/" .. configName .. ".json", encoded)
        end)
        return writeSuccess
    end
    
    return false
end

function ConfigSystem:Load(configName)
    if not readfile or not isfile then 
        warn("FlexUI: Config load not supported in this executor")
        return nil 
    end
    
    local filePath = self.ConfigFolder .. "/" .. configName .. ".json"
    
    if not isfile(filePath) then
        return nil
    end
    
    local success, data = pcall(function()
        local content = readfile(filePath)
        return HttpService:JSONDecode(content)
    end)
    
    if success then
        return data
    end
    
    return nil
end

function ConfigSystem:Delete(configName)
    if not delfile or not isfile then return false end
    
    local filePath = self.ConfigFolder .. "/" .. configName .. ".json"
    
    if isfile(filePath) then
        delfile(filePath)
        return true
    end
    
    return false
end

function ConfigSystem:GetConfigs()
    if not listfiles then return {} end
    
    self:EnsureFolder()
    
    local configs = {}
    local success, files = pcall(function()
        return listfiles(self.ConfigFolder)
    end)
    
    if success then
        for _, file in ipairs(files) do
            local name = file:match("([^/\\]+)%.json$")
            if name then
                table.insert(configs, name)
            end
        end
    end
    
    return configs
end

FlexUI.ConfigSystem = ConfigSystem

--[[
    FlexUI - Part 2
    Window & Container System
    Lucide-style Icons Integration
]]

--// Lucide Style Icons (Roblox Asset IDs - Clean & Modern)
local LucideIcons = {
    -- Navigation & UI
    Menu = "rbxassetid://13746754854",
    X = "rbxassetid://13746752651",
    ChevronDown = "rbxassetid://13746753023",
    ChevronUp = "rbxassetid://13746753150",
    ChevronLeft = "rbxassetid://13746753274",
    ChevronRight = "rbxassetid://13746752898",
    ArrowLeft = "rbxassetid://13746754122",
    ArrowRight = "rbxassetid://13746754006",
    ArrowUp = "rbxassetid://13746753891",
    ArrowDown = "rbxassetid://13746754241",
    Home = "rbxassetid://13746751794",
    Settings = "rbxassetid://13746750714",
    Search = "rbxassetid://13746750843",
    Filter = "rbxassetid://13746752148",
    MoreHorizontal = "rbxassetid://13746751432",
    MoreVertical = "rbxassetid://13746751308",
    Maximize = "rbxassetid://13746751556",
    Minimize = "rbxassetid://13746751432",
    
    -- Actions
    Check = "rbxassetid://13746752773",
    Plus = "rbxassetid://13746750971",
    Minus = "rbxassetid://13746751556",
    Edit = "rbxassetid://13746752275",
    Trash = "rbxassetid://13746750456",
    Copy = "rbxassetid://13746752527",
    Clipboard = "rbxassetid://13746752651",
    Save = "rbxassetid://13746750843",
    Download = "rbxassetid://13746752275",
    Upload = "rbxassetid://13746750585",
    Refresh = "rbxassetid://13746750971",
    RotateCcw = "rbxassetid://13746750843",
    RotateCw = "rbxassetid://13746750843",
    
    -- Status & Alerts
    AlertCircle = "rbxassetid://13746754361",
    AlertTriangle = "rbxassetid://13746754241",
    Info = "rbxassetid://13746751927",
    HelpCircle = "rbxassetid://13746751927",
    CheckCircle = "rbxassetid://13746752773",
    XCircle = "rbxassetid://13746752651",
    Bell = "rbxassetid://13746753639",
    BellOff = "rbxassetid://13746753518",
    
    -- User & Account
    User = "rbxassetid://13746750585",
    Users = "rbxassetid://13746750456",
    UserPlus = "rbxassetid://13746750456",
    UserMinus = "rbxassetid://13746750456",
    UserCheck = "rbxassetid://13746750456",
    UserX = "rbxassetid://13746750456",
    
    -- Security
    Lock = "rbxassetid://13746751679",
    Unlock = "rbxassetid://13746750585",
    Shield = "rbxassetid://13746750714",
    ShieldCheck = "rbxassetid://13746750714",
    ShieldAlert = "rbxassetid://13746750714",
    Key = "rbxassetid://13746751794",
    
    -- Media
    Play = "rbxassetid://13746751056",
    Pause = "rbxassetid://13746751179",
    Stop = "rbxassetid://13746750585",
    SkipBack = "rbxassetid://13746750714",
    SkipForward = "rbxassetid://13746750714",
    Volume = "rbxassetid://13746750456",
    Volume1 = "rbxassetid://13746750456",
    Volume2 = "rbxassetid://13746750456",
    VolumeX = "rbxassetid://13746750456",
    
    -- Files & Folders
    File = "rbxassetid://13746752148",
    FileText = "rbxassetid://13746752024",
    Folder = "rbxassetid://13746752024",
    FolderOpen = "rbxassetid://13746752024",
    Archive = "rbxassetid://13746754476",
    
    -- Communication
    Mail = "rbxassetid://13746751679",
    Send = "rbxassetid://13746750843",
    MessageSquare = "rbxassetid://13746751556",
    MessageCircle = "rbxassetid://13746751556",
    
    -- Device & Hardware
    Monitor = "rbxassetid://13746751432",
    Smartphone = "rbxassetid://13746750714",
    Tablet = "rbxassetid://13746750585",
    Keyboard = "rbxassetid://13746751794",
    Mouse = "rbxassetid://13746751432",
    Gamepad = "rbxassetid://13746752024",
    Cpu = "rbxassetid://13746752401",
    HardDrive = "rbxassetid://13746751927",
    
    -- Weather & Nature
    Sun = "rbxassetid://13746750585",
    Moon = "rbxassetid://13746751432",
    Cloud = "rbxassetid://13746752651",
    CloudRain = "rbxassetid://13746752527",
    Zap = "rbxassetid://13746750329",
    Wind = "rbxassetid://13746750329",
    Flame = "rbxassetid://13746752148",
    Droplet = "rbxassetid://13746752275",
    Snowflake = "rbxassetid://13746750714",
    
    -- Objects
    Heart = "rbxassetid://13746751927",
    Star = "rbxassetid://13746750714",
    Flag = "rbxassetid://13746752148",
    Bookmark = "rbxassetid://13746753397",
    Gift = "rbxassetid://13746752024",
    Trophy = "rbxassetid://13746750456",
    Crown = "rbxassetid://13746752401",
    Target = "rbxassetid://13746750585",
    Crosshair = "rbxassetid://13746752401",
    
    -- Shapes
    Circle = "rbxassetid://13746752651",
    Square = "rbxassetid://13746750714",
    Triangle = "rbxassetid://13746750456",
    Hexagon = "rbxassetid://13746751927",
    Octagon = "rbxassetid://13746751179",
    
    -- Arrows & Pointers
    MoveHorizontal = "rbxassetid://13746751432",
    MoveVertical = "rbxassetid://13746751308",
    Move = "rbxassetid://13746751432",
    Maximize2 = "rbxassetid://13746751556",
    Minimize2 = "rbxassetid://13746751556",
    
    -- Development
    Code = "rbxassetid://13746752651",
    Terminal = "rbxassetid://13746750585",
    Bug = "rbxassetid://13746753397",
    Wrench = "rbxassetid://13746750329",
    Tool = "rbxassetid://13746750456",
    Puzzle = "rbxassetid://13746751056",
    
    -- Social & Misc
    Share = "rbxassetid://13746750714",
    ExternalLink = "rbxassetid://13746752148",
    Link = "rbxassetid://13746751679",
    Unlink = "rbxassetid://13746750585",
    Globe = "rbxassetid://13746752024",
    Map = "rbxassetid://13746751679",
    MapPin = "rbxassetid://13746751679",
    Navigation = "rbxassetid://13746751308",
    Compass = "rbxassetid://13746752527",
    
    -- Toggle & Switch
    ToggleLeft = "rbxassetid://13746750456",
    ToggleRight = "rbxassetid://13746750456",
    
    -- Eye
    Eye = "rbxassetid://13746752148",
    EyeOff = "rbxassetid://13746752024",
    
    -- Color & Design
    Palette = "rbxassetid://13746751179",
    Paintbrush = "rbxassetid://13746751179",
    Pipette = "rbxassetid://13746751056",
    Layers = "rbxassetid://13746751794",
    Layout = "rbxassetid://13746751679",
    Grid = "rbxassetid://13746752024",
    
    -- Sliders & Controls
    Sliders = "rbxassetid://13746750714",
    SlidersHorizontal = "rbxassetid://13746750714",
    
    -- Power
    Power = "rbxassetid://13746751056",
    PowerOff = "rbxassetid://13746751056",
    
    -- Loading
    Loader = "rbxassetid://13746751679",
    RefreshCw = "rbxassetid://13746750971",
    
    -- Arrows Special
    ChevronsDown = "rbxassetid://13746752898",
    ChevronsUp = "rbxassetid://13746753150",
    ChevronsLeft = "rbxassetid://13746753274",
    ChevronsRight = "rbxassetid://13746752898",
}

--// Update FlexUI Icons
for name, id in pairs(LucideIcons) do
    FlexUI.Icons[name] = id
end

--// Window Class
local Window = {}
Window.__index = Window

function FlexUI.new(config)
    local self = setmetatable({}, FlexUI)
    
    -- Configuration
    self.Config = {
        Title = config.Title or "FlexUI",
        SubTitle = config.SubTitle or "v" .. FlexUI.Version,
        Size = config.Size or UDim2.new(0, 580, 0, 460),
        Position = config.Position or UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = config.AnchorPoint or Vector2.new(0.5, 0.5),
        MinSize = config.MinSize or Vector2.new(400, 300),
        MaxSize = config.MaxSize or Vector2.new(800, 600),
        Theme = config.Theme or "Dark",
        Transparency = config.Transparency or 0.05,
        Draggable = config.Draggable ~= false,
        Resizable = config.Resizable ~= false,
        CloseCallback = config.CloseCallback,
        MinimizeCallback = config.MinimizeCallback,
        ToggleKey = config.ToggleKey or Enum.KeyCode.RightControl,
        SaveConfig = config.SaveConfig or false,
        ConfigName = config.ConfigName or "DefaultConfig",
        MobileOptimized = config.MobileOptimized ~= false,
        SoundEnabled = config.SoundEnabled ~= false,
    }
    
    -- Apply Theme Preset
    if type(self.Config.Theme) == "string" and ThemePresets[self.Config.Theme] then
        for key, value in pairs(ThemePresets[self.Config.Theme]) do
            Theme[key] = value
        end
    elseif type(self.Config.Theme) == "table" then
        for key, value in pairs(self.Config.Theme) do
            Theme[key] = value
        end
    end
    
    -- State
    self.Visible = true
    self.Minimized = false
    self.Tabs = {}
    self.ActiveTab = nil
    self.Flags = {}
    self.Connections = {}
    
    -- Mobile Adjustments
    if FlexUI.IsMobile and self.Config.MobileOptimized then
        self.Config.Size = UDim2.new(0.95, 0, 0.85, 0)
        self.Config.Position = UDim2.new(0.5, 0, 0.5, 0)
    end
    
    -- Create UI
    self:_CreateMainFrame()
    self:_SetupDragging()
    self:_SetupResizing()
    self:_SetupKeybinds()
    self:_SetupMobileSupport()
    
    -- Add to windows list
    table.insert(FlexUI.Windows, self)
    
    -- Animation
    self:_PlayOpenAnimation()
    
    return self
end

function FlexUI:_CreateMainFrame()
    local safeParent = GetSafeParent()
    
    -- Main ScreenGui
    self.ScreenGui = Utility.Create("ScreenGui", {
        Name = "FlexUI_" .. Utility.RandomString(8),
        Parent = safeParent,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false,
        IgnoreGuiInset = true,
        DisplayOrder = 999
    })
    
    -- Protect GUI if possible
    if syn and syn.protect_gui then
        syn.protect_gui(self.ScreenGui)
    end
    
    -- Background Blur (Optional)
    self.BlurEffect = Utility.Create("BlurEffect", {
        Name = "FlexUI_Blur",
        Size = 0,
        Parent = Lighting
    })
    
    -- Main Container
    self.MainFrame = Utility.Create("Frame", {
        Name = "MainFrame",
        Parent = self.ScreenGui,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = self.Config.Transparency,
        BorderSizePixel = 0,
        Position = self.Config.Position,
        Size = self.Config.Size,
        AnchorPoint = self.Config.AnchorPoint,
        ClipsDescendants = true
    })
    
    -- Main Corner
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusLarge,
        Parent = self.MainFrame
    })
    
    -- Main Stroke
    self.MainStroke = Utility.Create("UIStroke", {
        Parent = self.MainFrame,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Shadow Frame
    self.ShadowFrame = Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = self.MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 4),
        Size = UDim2.new(1, 24, 1, 24),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = -1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Theme.Shadow,
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    -- Create Header
    self:_CreateHeader()
    
    -- Create Sidebar
    self:_CreateSidebar()
    
    -- Create Content Area
    self:_CreateContentArea()
    
    -- Create Mobile Menu Button (if mobile)
    if FlexUI.IsMobile then
        self:_CreateMobileMenuButton()
    end
end

function FlexUI:_CreateHeader()
    -- Header Frame
    self.Header = Utility.Create("Frame", {
        Name = "Header",
        Parent = self.MainFrame,
        BackgroundColor3 = Theme.BackgroundSecondary,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 50)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusLarge,
        Parent = self.Header
    })
    
    -- Header Bottom Cover (to make bottom flat)
    Utility.Create("Frame", {
        Name = "BottomCover",
        Parent = self.Header,
        BackgroundColor3 = Theme.BackgroundSecondary,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -12),
        Size = UDim2.new(1, 0, 0, 12)
    })
    
    -- Header Border
    Utility.Create("Frame", {
        Name = "Border",
        Parent = self.Header,
        BackgroundColor3 = Theme.Border,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -1),
        Size = UDim2.new(1, 0, 0, 1)
    })
    
    -- Logo/Icon Container
    self.LogoContainer = Utility.Create("Frame", {
        Name = "LogoContainer",
        Parent = self.Header,
        BackgroundColor3 = Theme.Primary,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 12, 0.5, 0),
        Size = UDim2.new(0, 32, 0, 32),
        AnchorPoint = Vector2.new(0, 0.5)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.LogoContainer
    })
    
    -- Logo Icon
    self.LogoIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.LogoContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 18, 0, 18),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Zap,
        ImageColor3 = Color3.fromRGB(255, 255, 255)
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 54, 0, 8),
        Size = UDim2.new(0, 200, 0, 18),
        Font = Theme.FontBold,
        Text = self.Config.Title,
        TextColor3 = Theme.TextPrimary,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Subtitle
    self.SubtitleLabel = Utility.Create("TextLabel", {
        Name = "Subtitle",
        Parent = self.Header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 54, 0, 26),
        Size = UDim2.new(0, 200, 0, 14),
        Font = Theme.FontLight,
        Text = self.Config.SubTitle,
        TextColor3 = Theme.TextTertiary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Control Buttons Container
    self.ControlButtons = Utility.Create("Frame", {
        Name = "ControlButtons",
        Parent = self.Header,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -12, 0.5, 0),
        Size = UDim2.new(0, 90, 0, 28),
        AnchorPoint = Vector2.new(1, 0.5)
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.ControlButtons,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 8)
    })
    
    -- Minimize Button
    self.MinimizeButton = self:_CreateControlButton("Minimize", LucideIcons.Minus, function()
        self:Minimize()
    end)
    
    -- Maximize Button (Placeholder for now)
    self.MaximizeButton = self:_CreateControlButton("Maximize", LucideIcons.Maximize2, function()
        -- Toggle maximize
    end)
    
    -- Close Button
    self.CloseButton = self:_CreateControlButton("Close", LucideIcons.X, function()
        self:Close()
    end, Theme.Error)
    
    -- User Info (Right side)
    self:_CreateUserInfo()
end

function FlexUI:_CreateControlButton(name, icon, callback, hoverColor)
    local button = Utility.Create("TextButton", {
        Name = name .. "Button",
        Parent = self.ControlButtons,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(0, 28, 0, 28),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = button
    })
    
    local buttonIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = button,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = icon,
        ImageColor3 = Theme.TextSecondary
    })
    
    -- Hover Effects
    button.MouseEnter:Connect(function()
        Utility.Tween(button, {BackgroundTransparency = 0.3}, 0.2)
        Utility.Tween(buttonIcon, {ImageColor3 = hoverColor or Theme.TextPrimary}, 0.2)
        if self.Config.SoundEnabled then
            PlaySound("Hover", 0.3)
        end
    end)
    
    button.MouseLeave:Connect(function()
        Utility.Tween(button, {BackgroundTransparency = 0.5}, 0.2)
        Utility.Tween(buttonIcon, {ImageColor3 = Theme.TextSecondary}, 0.2)
    end)
    
    button.MouseButton1Click:Connect(function()
        if self.Config.SoundEnabled then
            PlaySound("Click", 0.5)
        end
        Utility.Ripple(button, Mouse.X, Mouse.Y)
        callback()
    end)
    
    return button
end

function FlexUI:_CreateUserInfo()
    -- User Info Container (positioned before control buttons)
    self.UserInfoContainer = Utility.Create("Frame", {
        Name = "UserInfo",
        Parent = self.Header,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -120, 0.5, 0),
        Size = UDim2.new(0, 140, 0, 36),
        AnchorPoint = Vector2.new(1, 0.5)
    })
    
    -- User Avatar
    self.UserAvatar = Utility.Create("ImageLabel", {
        Name = "Avatar",
        Parent = self.UserInfoContainer,
        BackgroundColor3 = Theme.Surface,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(0, 28, 0, 28),
        AnchorPoint = Vector2.new(0, 0.5),
        Image = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48),
        ImageColor3 = Color3.fromRGB(255, 255, 255)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.UserAvatar
    })
    
    -- User Name
    self.UserNameLabel = Utility.Create("TextLabel", {
        Name = "UserName",
        Parent = self.UserInfoContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 36, 0.5, 0),
        Size = UDim2.new(1, -40, 0, 16),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Theme.Font,
        Text = LocalPlayer.DisplayName,
        TextColor3 = Theme.TextSecondary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
end

function FlexUI:_CreateSidebar()
    -- Sidebar Frame
    self.Sidebar = Utility.Create("Frame", {
        Name = "Sidebar",
        Parent = self.MainFrame,
        BackgroundColor3 = Theme.BackgroundSecondary,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 50),
        Size = UDim2.new(0, 180, 1, -50)
    })
    
    -- Sidebar Border
    Utility.Create("Frame", {
        Name = "Border",
        Parent = self.Sidebar,
        BackgroundColor3 = Theme.Border,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -1, 0, 0),
        Size = UDim2.new(0, 1, 1, 0)
    })
    
    -- Tab Container with Scroll
    self.TabScrollFrame = Utility.Create("ScrollingFrame", {
        Name = "TabScroll",
        Parent = self.Sidebar,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 12),
        Size = UDim2.new(1, 0, 1, -70),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Theme.ScrollbarThumb,
        ScrollBarImageTransparency = 0.5,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.TabScrollFrame,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        Padding = UDim.new(0, 4)
    })
    
    Utility.Create("UIPadding", {
        Parent = self.TabScrollFrame,
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 4),
        PaddingBottom = UDim.new(0, 4)
    })
    
    -- Sidebar Footer (Settings, etc.)
    self:_CreateSidebarFooter()
end

function FlexUI:_CreateSidebarFooter()
    -- Footer Container
    self.SidebarFooter = Utility.Create("Frame", {
        Name = "Footer",
        Parent = self.Sidebar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 1, -58),
        Size = UDim2.new(1, 0, 0, 58)
    })
    
    -- Separator
    Utility.Create("Frame", {
        Name = "Separator",
        Parent = self.SidebarFooter,
        BackgroundColor3 = Theme.Border,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(0.1, 0, 0, 0),
        Size = UDim2.new(0.8, 0, 0, 1)
    })
    
    -- Footer Buttons Container
    local footerButtons = Utility.Create("Frame", {
        Name = "Buttons",
        Parent = self.SidebarFooter,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 8),
        Size = UDim2.new(1, -20, 0, 42)
    })
    
    Utility.Create("UIListLayout", {
        Parent = footerButtons,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 8)
    })
    
    -- Settings Button
    self:_CreateFooterButton(footerButtons, "Settings", LucideIcons.Settings, function()
        self:_OpenSettingsModal()
    end)
    
    -- Save Config Button
    self:_CreateFooterButton(footerButtons, "Save", LucideIcons.Save, function()
        self:SaveConfig()
    end)
    
    -- Info Button
    self:_CreateFooterButton(footerButtons, "Info", LucideIcons.Info, function()
        self:_ShowInfo()
    end)
end

function FlexUI:_CreateFooterButton(parent, name, icon, callback)
    local button = Utility.Create("TextButton", {
        Name = name .. "Button",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(0, 42, 0, 36),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = button
    })
    
    local buttonIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = button,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 18, 0, 18),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = icon,
        ImageColor3 = Theme.TextSecondary
    })
    
    -- Tooltip
    local tooltip = Utility.Create("TextLabel", {
        Name = "Tooltip",
        Parent = button,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0,
        Position = UDim2.new(0.5, 0, 0, -30),
        Size = UDim2.new(0, 0, 0, 24),
        AnchorPoint = Vector2.new(0.5, 0),
        Font = Theme.Font,
        Text = name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 11,
        AutomaticSize = Enum.AutomaticSize.X,
        Visible = false,
        ZIndex = 100
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = tooltip
    })
    
    Utility.Create("UIPadding", {
        Parent = tooltip,
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8)
    })
    
    -- Hover Effects
    button.MouseEnter:Connect(function()
        Utility.Tween(button, {BackgroundTransparency = 0.3}, 0.2)
        Utility.Tween(buttonIcon, {ImageColor3 = Theme.Primary}, 0.2)
        tooltip.Visible = true
        if self.Config.SoundEnabled then
            PlaySound("Hover", 0.2)
        end
    end)
    
    button.MouseLeave:Connect(function()
        Utility.Tween(button, {BackgroundTransparency = 0.5}, 0.2)
        Utility.Tween(buttonIcon, {ImageColor3 = Theme.TextSecondary}, 0.2)
        tooltip.Visible = false
    end)
    
    button.MouseButton1Click:Connect(function()
        if self.Config.SoundEnabled then
            PlaySound("Click", 0.5)
        end
        Utility.Ripple(button, Mouse.X, Mouse.Y)
        callback()
    end)
    
    return button
end

function FlexUI:_CreateContentArea()
    -- Content Container
    self.ContentContainer = Utility.Create("Frame", {
        Name = "ContentContainer",
        Parent = self.MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 180, 0, 50),
        Size = UDim2.new(1, -180, 1, -50),
        ClipsDescendants = true
    })
    
    -- Content Padding
    Utility.Create("UIPadding", {
        Parent = self.ContentContainer,
        PaddingLeft = UDim.new(0, 16),
        PaddingRight = UDim.new(0, 16),
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12)
    })
end

function FlexUI:_CreateMobileMenuButton()
    -- Mobile menu toggle button
    self.MobileMenuButton = Utility.Create("TextButton", {
        Name = "MobileMenuButton",
        Parent = self.Header,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        Position = UDim2.new(1, -50, 0.5, 0),
        Size = UDim2.new(0, 36, 0, 36),
        AnchorPoint = Vector2.new(1, 0.5),
        Text = "",
        Visible = FlexUI.IsMobile,
        AutoButtonColor = false,
        ZIndex = 10
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.MobileMenuButton
    })
    
    local menuIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.MobileMenuButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 20),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Menu,
        ImageColor3 = Theme.TextPrimary
    })
    
    self.MobileMenuOpen = false
    
    self.MobileMenuButton.MouseButton1Click:Connect(function()
        self.MobileMenuOpen = not self.MobileMenuOpen
        
        if self.MobileMenuOpen then
            -- Show sidebar
            Utility.Tween(self.Sidebar, {Position = UDim2.new(0, 0, 0, 50)}, 0.3)
            menuIcon.Image = LucideIcons.X
        else
            -- Hide sidebar
            Utility.Tween(self.Sidebar, {Position = UDim2.new(0, -180, 0, 50)}, 0.3)
            menuIcon.Image = LucideIcons.Menu
        end
    end)
    
    -- Initially hide sidebar on mobile
    if FlexUI.IsMobile then
        self.Sidebar.Position = UDim2.new(0, -180, 0, 50)
        self.ContentContainer.Position = UDim2.new(0, 0, 0, 50)
        self.ContentContainer.Size = UDim2.new(1, 0, 1, -50)
    end
end

function FlexUI:_SetupDragging()
    if not self.Config.Draggable then return end
    
    local dragging = false
    local dragInput
    local dragStart
    local startPos
    
    local function updateDrag(input)
        local delta = input.Position - dragStart
        local newPosition = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
        
        -- Smooth dragging with tween
        Utility.Tween(self.MainFrame, {Position = newPosition}, 0.05)
    end
    
    self.Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = self.MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    self.Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or
           input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    table.insert(self.Connections, UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            updateDrag(input)
        end
    end))
end

function FlexUI:_SetupResizing()
    if not self.Config.Resizable then return end
    
    -- Resize Handle
    self.ResizeHandle = Utility.Create("TextButton", {
        Name = "ResizeHandle",
        Parent = self.MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 1, -20),
        Size = UDim2.new(0, 20, 0, 20),
        Text = "",
        ZIndex = 100
    })
    
    -- Resize Icon
    local resizeIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.ResizeHandle,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Maximize2,
        ImageColor3 = Theme.TextTertiary,
        ImageTransparency = 0.5,
        Rotation = 90
    })
    
    local resizing = false
    local resizeStart
    local startSize
    
    self.ResizeHandle.MouseEnter:Connect(function()
        Utility.Tween(resizeIcon, {ImageTransparency = 0, ImageColor3 = Theme.Primary}, 0.2)
    end)
    
    self.ResizeHandle.MouseLeave:Connect(function()
        if not resizing then
            Utility.Tween(resizeIcon, {ImageTransparency = 0.5, ImageColor3 = Theme.TextTertiary}, 0.2)
        end
    end)
    
    self.ResizeHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.Touch then
            resizing = true
            resizeStart = input.Position
            startSize = self.MainFrame.AbsoluteSize
        end
    end)
    
    table.insert(self.Connections, UserInputService.InputChanged:Connect(function(input)
        if resizing and (input.UserInputType == Enum.UserInputType.MouseMovement or
                        input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - resizeStart
            local newWidth = math.clamp(startSize.X + delta.X, self.Config.MinSize.X, self.Config.MaxSize.X)
            local newHeight = math.clamp(startSize.Y + delta.Y, self.Config.MinSize.Y, self.Config.MaxSize.Y)
            
            self.MainFrame.Size = UDim2.new(0, newWidth, 0, newHeight)
        end
    end))
    
    table.insert(self.Connections, UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.Touch then
            resizing = false
        end
    end))
end

function FlexUI:_SetupKeybinds()
    table.insert(self.Connections, UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == self.Config.ToggleKey then
            self:Toggle()
        end
    end))
end

function FlexUI:_SetupMobileSupport()
    if not FlexUI.IsMobile then return end
    
    -- Adjust sizes for mobile
    self.TitleLabel.TextSize = 14
    self.SubtitleLabel.TextSize = 10
    
    -- Make touch targets larger
    for _, button in ipairs(self.ControlButtons:GetChildren()) do
        if button:IsA("TextButton") then
            button.Size = UDim2.new(0, 36, 0, 36)
        end
    end
end

function FlexUI:_PlayOpenAnimation()
    -- Initial state
    self.MainFrame.Size = UDim2.new(0, 0, 0, 0)
    self.MainFrame.BackgroundTransparency = 1
    
    -- Animate
    Utility.Tween(self.MainFrame, {
        Size = self.Config.Size,
        BackgroundTransparency = self.Config.Transparency
    }, 0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    
    -- Blur effect
    Utility.Tween(self.BlurEffect, {Size = 6}, 0.4)
end

function FlexUI:_PlayCloseAnimation()
    Utility.Tween(self.BlurEffect, {Size = 0}, 0.3)
    
    return Utility.TweenWait(self.MainFrame, {
        Size = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1
    }, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In)
end

--// Window Methods
function FlexUI:Toggle()
    self.Visible = not self.Visible
    
    if self.Visible then
        self.ScreenGui.Enabled = true
        self:_PlayOpenAnimation()
    else
        task.spawn(function()
            self:_PlayCloseAnimation()
            self.ScreenGui.Enabled = false
        end)
    end
    
    return self.Visible
end

function FlexUI:Show()
    if not self.Visible then
        self:Toggle()
    end
end

function FlexUI:Hide()
    if self.Visible then
        self:Toggle()
    end
end

function FlexUI:Minimize()
    self.Minimized = not self.Minimized
    
    if self.Minimized then
        -- Save current size
        self._savedSize = self.MainFrame.Size
        
        -- Minimize to header only
        Utility.Tween(self.MainFrame, {
            Size = UDim2.new(0, self.MainFrame.AbsoluteSize.X, 0, 50)
        }, 0.3)
        
        self.Sidebar.Visible = false
        self.ContentContainer.Visible = false
        
        if self.Config.MinimizeCallback then
            self.Config.MinimizeCallback(true)
        end
    else
        -- Restore
        Utility.Tween(self.MainFrame, {
            Size = self._savedSize or self.Config.Size
        }, 0.3)
        
        task.delay(0.1, function()
            self.Sidebar.Visible = true
            self.ContentContainer.Visible = true
        end)
        
        if self.Config.MinimizeCallback then
            self.Config.MinimizeCallback(false)
        end
    end
end

function FlexUI:Close()
    if self.Config.CloseCallback then
        local shouldClose = self.Config.CloseCallback()
        if shouldClose == false then
            return
        end
    end
    
    self:Destroy()
end

function FlexUI:Destroy()
    -- Disconnect all connections
    for _, connection in ipairs(self.Connections) do
        if connection.Disconnect then
            connection:Disconnect()
        end
    end
    
    -- Remove blur effect
    if self.BlurEffect then
        self.BlurEffect:Destroy()
    end
    
    -- Play close animation then destroy
    task.spawn(function()
        self:_PlayCloseAnimation()
        task.wait(0.35)
        
        if self.ScreenGui then
            self.ScreenGui:Destroy()
        end
    end)
    
    -- Remove from windows list
    for i, window in ipairs(FlexUI.Windows) do
        if window == self then
            table.remove(FlexUI.Windows, i)
            break
        end
    end
end

function FlexUI:SetTitle(title)
    self.Config.Title = title
    self.TitleLabel.Text = title
end

function FlexUI:SetSubtitle(subtitle)
    self.Config.SubTitle = subtitle
    self.SubtitleLabel.Text = subtitle
end

function FlexUI:_OpenSettingsModal()
    -- Will be implemented in Part 6 with full modal system
    self:Notify({
        Title = "Settings",
        Description = "Settings panel coming soon!",
        Type = "Info",
        Duration = 3
    })
end

function FlexUI:_ShowInfo()
    self:Notify({
        Title = "FlexUI Information",
        Description = string.format(
            "Version: %s\nExecutor: %s\nDevice: %s",
            FlexUI.Version,
            ExecutorName,
            DeviceType
        ),
        Type = "Info",
        Duration = 5
    })
end

function FlexUI:SaveConfig(name)
    name = name or self.Config.ConfigName
    
    local configData = {}
    
    for flag, value in pairs(self.Flags) do
        if type(value) ~= "function" and type(value) ~= "table" then
            configData[flag] = value
        elseif type(value) == "table" then
            -- Handle Color3, etc.
            if typeof(value) == "Color3" then
                configData[flag] = {
                    Type = "Color3",
                    R = value.R,
                    G = value.G,
                    B = value.B
                }
            else
                configData[flag] = value
            end
        end
    end
    
    local configSystem = ConfigSystem.new(self.Config.Title)
    local success = configSystem:Save(name, configData)
    
    if success then
        self:Notify({
            Title = "Config Saved",
            Description = "Configuration saved as '" .. name .. "'",
            Type = "Success",
            Duration = 3
        })
    else
        self:Notify({
            Title = "Save Failed",
            Description = "Failed to save configuration",
            Type = "Error",
            Duration = 3
        })
    end
    
    return success
end

function FlexUI:LoadConfig(name)
    name = name or self.Config.ConfigName
    
    local configSystem = ConfigSystem.new(self.Config.Title)
    local configData = configSystem:Load(name)
    
    if configData then
        for flag, value in pairs(configData) do
            if type(value) == "table" and value.Type == "Color3" then
                self.Flags[flag] = Color3.new(value.R, value.G, value.B)
            else
                self.Flags[flag] = value
            end
        end
        
        self:Notify({
            Title = "Config Loaded",
            Description = "Configuration '" .. name .. "' loaded",
            Type = "Success",
            Duration = 3
        })
        
        return true
    else
        self:Notify({
            Title = "Load Failed",
            Description = "Configuration not found",
            Type = "Error",
            Duration = 3
        })
        
        return false
    end
end

--// Placeholder Notify (Full implementation in Part 7)
function FlexUI:Notify(config)
    -- Temporary implementation - will be replaced
    local message = string.format("[%s] %s: %s", config.Type or "Info", config.Title or "Notification", config.Description or "")
    print(message)
end

--[[
    FlexUI - Part 3
    Tab System & Navigation
    Sections, Groups, and Content Management
]]

--// Tab Class
local Tab = {}
Tab.__index = Tab

function FlexUI:AddTab(config)
    local tab = setmetatable({}, Tab)
    
    -- Configuration
    tab.Config = {
        Name = config.Name or config.Title or "Tab",
        Icon = config.Icon or LucideIcons.File,
        Parent = self,
        Order = config.Order or #self.Tabs + 1,
        Visible = config.Visible ~= false,
    }
    
    tab.Name = tab.Config.Name
    tab.Sections = {}
    tab.Elements = {}
    tab.Visible = true
    tab.Active = false
    
    -- Create Tab Button
    tab:_CreateTabButton()
    
    -- Create Tab Content
    tab:_CreateTabContent()
    
    -- Add to tabs list
    table.insert(self.Tabs, tab)
    
    -- Set as active if first tab
    if #self.Tabs == 1 then
        tab:Select()
    end
    
    return tab
end

function Tab:_CreateTabButton()
    local parent = self.Config.Parent
    
    -- Tab Button
    self.TabButton = Utility.Create("TextButton", {
        Name = self.Config.Name .. "Tab",
        Parent = parent.TabScrollFrame,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 42),
        Text = "",
        AutoButtonColor = false,
        LayoutOrder = self.Config.Order
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.TabButton
    })
    
    -- Selection Indicator (Left bar)
    self.SelectionIndicator = Utility.Create("Frame", {
        Name = "SelectionIndicator",
        Parent = self.TabButton,
        BackgroundColor3 = Theme.Primary,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0.15, 0),
        Size = UDim2.new(0, 3, 0.7, 0),
        Visible = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = self.SelectionIndicator
    })
    
    -- Tab Icon
    self.TabIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.TabButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0.5, 0),
        Size = UDim2.new(0, 18, 0, 18),
        AnchorPoint = Vector2.new(0, 0.5),
        Image = self.Config.Icon,
        ImageColor3 = Theme.TextTertiary
    })
    
    -- Tab Label
    self.TabLabel = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = self.TabButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 40, 0.5, 0),
        Size = UDim2.new(1, -54, 0, 18),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextTertiary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Notification Badge (for updates/alerts)
    self.NotificationBadge = Utility.Create("Frame", {
        Name = "Badge",
        Parent = self.TabButton,
        BackgroundColor3 = Theme.Error,
        Position = UDim2.new(1, -12, 0.5, 0),
        Size = UDim2.new(0, 8, 0, 8),
        AnchorPoint = Vector2.new(1, 0.5),
        Visible = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.NotificationBadge
    })
    
    -- Hover Effects
    self.TabButton.MouseEnter:Connect(function()
        if not self.Active then
            Utility.Tween(self.TabButton, {BackgroundTransparency = 0.7}, 0.2)
            Utility.Tween(self.TabIcon, {ImageColor3 = Theme.TextSecondary}, 0.2)
            Utility.Tween(self.TabLabel, {TextColor3 = Theme.TextSecondary}, 0.2)
        end
        
        if self.Config.Parent.Config.SoundEnabled then
            PlaySound("Hover", 0.2)
        end
    end)
    
    self.TabButton.MouseLeave:Connect(function()
        if not self.Active then
            Utility.Tween(self.TabButton, {BackgroundTransparency = 1}, 0.2)
            Utility.Tween(self.TabIcon, {ImageColor3 = Theme.TextTertiary}, 0.2)
            Utility.Tween(self.TabLabel, {TextColor3 = Theme.TextTertiary}, 0.2)
        end
    end)
    
    -- Click Handler
    self.TabButton.MouseButton1Click:Connect(function()
        self:Select()
        
        if self.Config.Parent.Config.SoundEnabled then
            PlaySound("Click", 0.5)
        end
        
        -- Ripple effect
        Utility.Ripple(self.TabButton, Mouse.X, Mouse.Y)
    end)
    
    -- Touch Support
    self.TabButton.TouchTap:Connect(function()
        self:Select()
    end)
end

function Tab:_CreateTabContent()
    local parent = self.Config.Parent
    
    -- Tab Content Frame
    self.ContentFrame = Utility.Create("ScrollingFrame", {
        Name = self.Config.Name .. "Content",
        Parent = parent.ContentContainer,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = Theme.ScrollbarThumb,
        ScrollBarImageTransparency = 0.3,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        Visible = false,
        ClipsDescendants = true
    })
    
    -- Content Layout
    self.ContentLayout = Utility.Create("UIListLayout", {
        Parent = self.ContentFrame,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        Padding = UDim.new(0, 12),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    -- Content Padding
    Utility.Create("UIPadding", {
        Parent = self.ContentFrame,
        PaddingTop = UDim.new(0, 4),
        PaddingBottom = UDim.new(0, 16),
        PaddingLeft = UDim.new(0, 4),
        PaddingRight = UDim.new(0, 8)
    })
    
    -- Smooth scrolling
    self:_SetupSmoothScrolling()
end

function Tab:_SetupSmoothScrolling()
    local scrollFrame = self.ContentFrame
    local targetScroll = 0
    local currentScroll = 0
    local scrollSpeed = 0.15
    
    -- Mouse wheel scrolling
    scrollFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseWheel then
            targetScroll = scrollFrame.CanvasPosition.Y - (input.Position.Z * 50)
            targetScroll = math.clamp(targetScroll, 0, scrollFrame.AbsoluteCanvasSize.Y - scrollFrame.AbsoluteSize.Y)
        end
    end)
    
    -- Smooth scroll update
    local connection
    connection = RunService.RenderStepped:Connect(function()
        if not scrollFrame or not scrollFrame.Parent then
            connection:Disconnect()
            return
        end
        
        currentScroll = Utility.Lerp(currentScroll, targetScroll, scrollSpeed)
        scrollFrame.CanvasPosition = Vector2.new(0, currentScroll)
    end)
    
    table.insert(self.Config.Parent.Connections, connection)
end

function Tab:Select()
    local parent = self.Config.Parent
    
    -- Deselect all other tabs
    for _, tab in ipairs(parent.Tabs) do
        if tab ~= self then
            tab:Deselect()
        end
    end
    
    -- Select this tab
    self.Active = true
    parent.ActiveTab = self
    
    -- Animate tab button
    Utility.Tween(self.TabButton, {BackgroundTransparency = 0.5}, 0.25)
    Utility.Tween(self.TabIcon, {ImageColor3 = Theme.Primary}, 0.25)
    Utility.Tween(self.TabLabel, {TextColor3 = Theme.TextPrimary}, 0.25)
    
    -- Show selection indicator
    self.SelectionIndicator.Visible = true
    self.SelectionIndicator.Size = UDim2.new(0, 3, 0, 0)
    Utility.Tween(self.SelectionIndicator, {Size = UDim2.new(0, 3, 0.7, 0)}, 0.3, Enum.EasingStyle.Back)
    
    -- Show content with animation
    self.ContentFrame.Visible = true
    self.ContentFrame.GroupTransparency = 1
    
    Utility.Tween(self.ContentFrame, {GroupTransparency = 0}, 0.3)
    
    -- Close mobile menu if open
    if FlexUI.IsMobile and parent.MobileMenuOpen then
        parent.MobileMenuOpen = false
        Utility.Tween(parent.Sidebar, {Position = UDim2.new(0, -180, 0, 50)}, 0.3)
        if parent.MobileMenuButton then
            parent.MobileMenuButton:FindFirstChild("Icon").Image = LucideIcons.Menu
        end
    end
end

function Tab:Deselect()
    self.Active = false
    
    -- Animate tab button
    Utility.Tween(self.TabButton, {BackgroundTransparency = 1}, 0.25)
    Utility.Tween(self.TabIcon, {ImageColor3 = Theme.TextTertiary}, 0.25)
    Utility.Tween(self.TabLabel, {TextColor3 = Theme.TextTertiary}, 0.25)
    
    -- Hide selection indicator
    Utility.Tween(self.SelectionIndicator, {Size = UDim2.new(0, 3, 0, 0)}, 0.2)
    task.delay(0.2, function()
        if not self.Active then
            self.SelectionIndicator.Visible = false
        end
    end)
    
    -- Hide content
    self.ContentFrame.Visible = false
end

function Tab:SetName(name)
    self.Config.Name = name
    self.Name = name
    self.TabLabel.Text = name
end

function Tab:SetIcon(icon)
    self.Config.Icon = icon
    self.TabIcon.Image = icon
end

function Tab:ShowBadge(show)
    self.NotificationBadge.Visible = show ~= false
end

function Tab:SetBadgeColor(color)
    self.NotificationBadge.BackgroundColor3 = color
end

function Tab:SetVisible(visible)
    self.TabButton.Visible = visible
    self.Visible = visible
    
    if not visible and self.Active then
        -- Select next available tab
        for _, tab in ipairs(self.Config.Parent.Tabs) do
            if tab.Visible and tab ~= self then
                tab:Select()
                break
            end
        end
    end
end

function Tab:Destroy()
    local parent = self.Config.Parent
    
    -- Remove from tabs list
    for i, tab in ipairs(parent.Tabs) do
        if tab == self then
            table.remove(parent.Tabs, i)
            break
        end
    end
    
    -- Select another tab if this was active
    if self.Active and #parent.Tabs > 0 then
        parent.Tabs[1]:Select()
    end
    
    -- Destroy UI elements
    if self.TabButton then
        self.TabButton:Destroy()
    end
    
    if self.ContentFrame then
        self.ContentFrame:Destroy()
    end
end

--// Section Class
local Section = {}
Section.__index = Section

function Tab:AddSection(config)
    local section = setmetatable({}, Section)
    
    -- Configuration
    section.Config = {
        Name = config.Name or config.Title or "Section",
        Description = config.Description,
        Icon = config.Icon,
        Collapsible = config.Collapsible ~= false,
        DefaultState = config.DefaultState ~= false, -- true = expanded
        Parent = self,
        Order = config.Order or #self.Sections + 1
    }
    
    section.Name = section.Config.Name
    section.Elements = {}
    section.Expanded = section.Config.DefaultState
    
    -- Create Section
    section:_Create()
    
    -- Add to sections list
    table.insert(self.Sections, section)
    
    return section
end

function Section:_Create()
    local parent = self.Config.Parent
    
    -- Section Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Section",
        Parent = parent.ContentFrame,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.4,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = self.Config.Order,
        ClipsDescendants = true
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    Utility.Create("UIStroke", {
        Parent = self.Container,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.7
    })
    
    -- Section Header
    self.Header = Utility.Create("TextButton", {
        Name = "Header",
        Parent = self.Container,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 44),
        Text = "",
        AutoButtonColor = false
    })
    
    -- Header Content Container
    local headerContent = Utility.Create("Frame", {
        Name = "Content",
        Parent = self.Header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 0),
        Size = UDim2.new(1, -28, 1, 0)
    })
    
    -- Section Icon (Optional)
    local iconOffset = 0
    if self.Config.Icon then
        self.HeaderIcon = Utility.Create("ImageLabel", {
            Name = "Icon",
            Parent = headerContent,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0.5, 0),
            Size = UDim2.new(0, 16, 0, 16),
            AnchorPoint = Vector2.new(0, 0.5),
            Image = self.Config.Icon,
            ImageColor3 = Theme.Primary
        })
        iconOffset = 24
    end
    
    -- Section Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = headerContent,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, iconOffset, 0, 6),
        Size = UDim2.new(1, -iconOffset - 30, 0, 16),
        Font = Theme.FontBold,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Section Description (Optional)
    if self.Config.Description then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = headerContent,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, iconOffset, 0, 24),
            Size = UDim2.new(1, -iconOffset - 30, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd
        })
        self.Header.Size = UDim2.new(1, 0, 0, 52)
    end
    
    -- Collapse Arrow
    if self.Config.Collapsible then
        self.CollapseArrow = Utility.Create("ImageLabel", {
            Name = "Arrow",
            Parent = headerContent,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, 0, 0.5, 0),
            Size = UDim2.new(0, 16, 0, 16),
            AnchorPoint = Vector2.new(1, 0.5),
            Image = LucideIcons.ChevronDown,
            ImageColor3 = Theme.TextSecondary,
            Rotation = self.Expanded and 0 or -90
        })
    end
    
    -- Section Content
    self.ContentContainer = Utility.Create("Frame", {
        Name = "ContentContainer",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, self.Header.Size.Y.Offset),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ClipsDescendants = true
    })
    
    -- Content Layout
    self.ContentLayout = Utility.Create("UIListLayout", {
        Parent = self.ContentContainer,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        Padding = UDim.new(0, 8),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    -- Content Padding
    Utility.Create("UIPadding", {
        Parent = self.ContentContainer,
        PaddingTop = UDim.new(0, 8),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    -- Set initial state
    if not self.Expanded then
        self.ContentContainer.Visible = false
    end
    
    -- Header Click Handler
    if self.Config.Collapsible then
        self.Header.MouseEnter:Connect(function()
            Utility.Tween(self.Header, {BackgroundTransparency = 0.8}, 0.2)
        end)
        
        self.Header.MouseLeave:Connect(function()
            Utility.Tween(self.Header, {BackgroundTransparency = 1}, 0.2)
        end)
        
        self.Header.MouseButton1Click:Connect(function()
            self:Toggle()
            
            local mainParent = self.Config.Parent.Config.Parent
            if mainParent.Config.SoundEnabled then
                PlaySound("Click", 0.3)
            end
        end)
    end
end

function Section:Toggle()
    self.Expanded = not self.Expanded
    
    if self.Expanded then
        self:Expand()
    else
        self:Collapse()
    end
end

function Section:Expand()
    self.Expanded = true
    self.ContentContainer.Visible = true
    
    if self.CollapseArrow then
        Utility.Tween(self.CollapseArrow, {Rotation = 0}, 0.3, Enum.EasingStyle.Back)
    end
    
    -- Animate expansion
    self.ContentContainer.AutomaticSize = Enum.AutomaticSize.Y
end

function Section:Collapse()
    self.Expanded = false
    
    if self.CollapseArrow then
        Utility.Tween(self.CollapseArrow, {Rotation = -90}, 0.3, Enum.EasingStyle.Back)
    end
    
    -- Animate collapse
    task.delay(0.05, function()
        if not self.Expanded then
            self.ContentContainer.Visible = false
        end
    end)
end

function Section:SetName(name)
    self.Config.Name = name
    self.Name = name
    self.TitleLabel.Text = name
end

function Section:SetDescription(description)
    if self.DescriptionLabel then
        self.DescriptionLabel.Text = description
    end
end

function Section:SetVisible(visible)
    self.Container.Visible = visible
end

function Section:Destroy()
    local parent = self.Config.Parent
    
    -- Remove from sections list
    for i, section in ipairs(parent.Sections) do
        if section == self then
            table.remove(parent.Sections, i)
            break
        end
    end
    
    -- Destroy container
    if self.Container then
        self.Container:Destroy()
    end
end

--// Divider Element
function Tab:AddDivider(config)
    config = config or {}
    
    local divider = Utility.Create("Frame", {
        Name = "Divider",
        Parent = self.ContentFrame,
        BackgroundColor3 = Theme.Border,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Size = UDim2.new(1, -24, 0, 1),
        LayoutOrder = config.Order or 999
    })
    
    if config.Text then
        local textLabel = Utility.Create("TextLabel", {
            Name = "Text",
            Parent = divider,
            BackgroundColor3 = Theme.Background,
            BackgroundTransparency = 0,
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 0, 0, 16),
            AnchorPoint = Vector2.new(0.5, 0.5),
            AutomaticSize = Enum.AutomaticSize.X,
            Font = Theme.Font,
            Text = "  " .. config.Text .. "  ",
            TextColor3 = Theme.TextTertiary,
            TextSize = 11
        })
    end
    
    return divider
end

--// Paragraph Element
function Tab:AddParagraph(config)
    local container = Utility.Create("Frame", {
        Name = "Paragraph",
        Parent = self.ContentFrame,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = config.Order or #self.Elements + 1
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = container
    })
    
    Utility.Create("UIPadding", {
        Parent = container,
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 14),
        PaddingRight = UDim.new(0, 14)
    })
    
    -- Title
    if config.Title then
        local title = Utility.Create("TextLabel", {
            Name = "Title",
            Parent = container,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 18),
            Font = Theme.FontBold,
            Text = config.Title,
            TextColor3 = Theme.TextPrimary,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Content
    local content = Utility.Create("TextLabel", {
        Name = "Content",
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, config.Title and 24 or 0),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = Theme.FontLight,
        Text = config.Content or config.Description or "",
        TextColor3 = Theme.TextSecondary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true
    })
    
    -- Methods
    local paragraph = {
        Container = container,
        TitleLabel = container:FindFirstChild("Title"),
        ContentLabel = content
    }
    
    function paragraph:SetTitle(title)
        if self.TitleLabel then
            self.TitleLabel.Text = title
        end
    end
    
    function paragraph:SetContent(text)
        self.ContentLabel.Text = text
    end
    
    function paragraph:Destroy()
        self.Container:Destroy()
    end
    
    table.insert(self.Elements, paragraph)
    return paragraph
end

--// Section versions of AddDivider and AddParagraph
function Section:AddDivider(config)
    config = config or {}
    
    local divider = Utility.Create("Frame", {
        Name = "Divider",
        Parent = self.ContentContainer,
        BackgroundColor3 = Theme.Border,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 1),
        LayoutOrder = config.Order or 999
    })
    
    return divider
end

function Section:AddParagraph(config)
    local container = Utility.Create("Frame", {
        Name = "Paragraph",
        Parent = self.ContentContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = config.Order or #self.Elements + 1
    })
    
    -- Title
    if config.Title then
        Utility.Create("TextLabel", {
            Name = "Title",
            Parent = container,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 16),
            Font = Theme.FontBold,
            Text = config.Title,
            TextColor3 = Theme.TextPrimary,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Content
    local content = Utility.Create("TextLabel", {
        Name = "Content",
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, config.Title and 20 or 0),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = Theme.FontLight,
        Text = config.Content or "",
        TextColor3 = Theme.TextSecondary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true
    })
    
    local paragraph = {Container = container, ContentLabel = content}
    
    function paragraph:SetContent(text)
        self.ContentLabel.Text = text
    end
    
    table.insert(self.Elements, paragraph)
    return paragraph
end

--// Tab Group (Multiple related tabs in sidebar)
local TabGroup = {}
TabGroup.__index = TabGroup

function FlexUI:AddTabGroup(config)
    local group = setmetatable({}, TabGroup)
    
    group.Config = {
        Name = config.Name or "Group",
        Collapsible = config.Collapsible ~= false,
        DefaultState = config.DefaultState ~= false,
        Parent = self
    }
    
    group.Tabs = {}
    group.Expanded = group.Config.DefaultState
    
    -- Create Group Header
    group:_CreateHeader()
    
    return group
end

function TabGroup:_CreateHeader()
    local parent = self.Config.Parent
    
    -- Group Header
    self.Header = Utility.Create("TextButton", {
        Name = self.Config.Name .. "GroupHeader",
        Parent = parent.TabScrollFrame,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 28),
        Text = "",
        AutoButtonColor = false
    })
    
    -- Group Label
    self.Label = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = self.Header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0.5, 0),
        Size = UDim2.new(1, -40, 0, 14),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Theme.Font,
        Text = self.Config.Name:upper(),
        TextColor3 = Theme.TextTertiary,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Collapse Arrow
    if self.Config.Collapsible then
        self.Arrow = Utility.Create("ImageLabel", {
            Name = "Arrow",
            Parent = self.Header,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, -8, 0.5, 0),
            Size = UDim2.new(0, 12, 0, 12),
            AnchorPoint = Vector2.new(1, 0.5),
            Image = LucideIcons.ChevronDown,
            ImageColor3 = Theme.TextTertiary,
            Rotation = self.Expanded and 0 or -90
        })
        
        self.Header.MouseButton1Click:Connect(function()
            self:Toggle()
        end)
    end
end

function TabGroup:Toggle()
    self.Expanded = not self.Expanded
    
    if self.Arrow then
        Utility.Tween(self.Arrow, {Rotation = self.Expanded and 0 or -90}, 0.2)
    end
    
    -- Show/Hide tabs in this group
    for _, tab in ipairs(self.Tabs) do
        tab.TabButton.Visible = self.Expanded
    end
end

function TabGroup:AddTab(config)
    config.Parent = self.Config.Parent
    local tab = self.Config.Parent:AddTab(config)
    table.insert(self.Tabs, tab)
    
    if not self.Expanded then
        tab.TabButton.Visible = false
    end
    
    return tab
end

--// Search/Filter Functionality
function FlexUI:AddSearchBar()
    -- Search Container
    self.SearchContainer = Utility.Create("Frame", {
        Name = "SearchContainer",
        Parent = self.Sidebar,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 10, 0, 8),
        Size = UDim2.new(1, -20, 0, 32)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.SearchContainer
    })
    
    -- Search Icon
    local searchIcon = Utility.Create("ImageLabel", {
        Name = "SearchIcon",
        Parent = self.SearchContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        AnchorPoint = Vector2.new(0, 0.5),
        Image = LucideIcons.Search,
        ImageColor3 = Theme.TextTertiary
    })
    
    -- Search Input
    self.SearchInput = Utility.Create("TextBox", {
        Name = "SearchInput",
        Parent = self.SearchContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 32, 0, 0),
        Size = UDim2.new(1, -42, 1, 0),
        Font = Theme.Font,
        PlaceholderText = "Search...",
        PlaceholderColor3 = Theme.TextTertiary,
        Text = "",
        TextColor3 = Theme.TextPrimary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false
    })
    
    -- Clear Button
    local clearButton = Utility.Create("TextButton", {
        Name = "ClearButton",
        Parent = self.SearchContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -24, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "",
        Visible = false
    })
    
    local clearIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = clearButton,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Image = LucideIcons.X,
        ImageColor3 = Theme.TextTertiary
    })
    
    -- Search Functionality
    self.SearchInput:GetPropertyChangedSignal("Text"):Connect(function()
        local query = self.SearchInput.Text:lower()
        clearButton.Visible = #query > 0
        
        -- Filter tabs
        for _, tab in ipairs(self.Tabs) do
            local matches = query == "" or tab.Name:lower():find(query)
            tab.TabButton.Visible = matches
        end
    end)
    
    clearButton.MouseButton1Click:Connect(function()
        self.SearchInput.Text = ""
    end)
    
    -- Adjust tab scroll position
    self.TabScrollFrame.Position = UDim2.new(0, 0, 0, 52)
    self.TabScrollFrame.Size = UDim2.new(1, 0, 1, -110)
end

--// Breadcrumb Navigation
function FlexUI:AddBreadcrumb()
    -- Breadcrumb Container
    self.BreadcrumbContainer = Utility.Create("Frame", {
        Name = "Breadcrumb",
        Parent = self.ContentContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 24),
        LayoutOrder = -100
    })
    
    self.BreadcrumbLayout = Utility.Create("UIListLayout", {
        Parent = self.BreadcrumbContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 4)
    })
    
    -- Home Icon
    local homeIcon = Utility.Create("ImageLabel", {
        Name = "HomeIcon",
        Parent = self.BreadcrumbContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 14, 0, 14),
        Image = LucideIcons.Home,
        ImageColor3 = Theme.TextTertiary
    })
    
    -- Update breadcrumb when tab changes
    local function updateBreadcrumb()
        -- Clear existing breadcrumb items
        for _, child in ipairs(self.BreadcrumbContainer:GetChildren()) do
            if child:IsA("TextLabel") or child:IsA("ImageLabel") then
                if child.Name ~= "HomeIcon" then
                    child:Destroy()
                end
            end
        end
        
        if self.ActiveTab then
            -- Separator
            Utility.Create("ImageLabel", {
                Name = "Separator",
                Parent = self.BreadcrumbContainer,
                BackgroundTransparency = 1,
                Size = UDim2.new(0, 12, 0, 12),
                Image = LucideIcons.ChevronRight,
                ImageColor3 = Theme.TextTertiary,
                LayoutOrder = 1
            })
            
            -- Tab Name
            Utility.Create("TextLabel", {
                Name = "TabName",
                Parent = self.BreadcrumbContainer,
                BackgroundTransparency = 1,
                Size = UDim2.new(0, 0, 0, 14),
                AutomaticSize = Enum.AutomaticSize.X,
                Font = Theme.Font,
                Text = self.ActiveTab.Name,
                TextColor3 = Theme.TextSecondary,
                TextSize = 12,
                LayoutOrder = 2
            })
        end
    end
    
    -- Connect to tab changes
    -- This would be called whenever ActiveTab changes
    self._updateBreadcrumb = updateBreadcrumb
end

--// Quick Actions Bar
function FlexUI:AddQuickActions(actions)
    -- Quick Actions Container
    self.QuickActionsContainer = Utility.Create("Frame", {
        Name = "QuickActions",
        Parent = self.Header,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 0, 0, 28),
        AnchorPoint = Vector2.new(0.5, 0.5),
        AutomaticSize = Enum.AutomaticSize.X
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.QuickActionsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 6)
    })
    
    for _, action in ipairs(actions) do
        local actionButton = Utility.Create("TextButton", {
            Name = action.Name .. "Action",
            Parent = self.QuickActionsContainer,
            BackgroundColor3 = Theme.Surface,
            BackgroundTransparency = 0.5,
            BorderSizePixel = 0,
            Size = UDim2.new(0, 28, 0, 28),
            Text = "",
            AutoButtonColor = false
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = actionButton
        })
        
        local actionIcon = Utility.Create("ImageLabel", {
            Name = "Icon",
            Parent = actionButton,
            BackgroundTransparency = 1,
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 14, 0, 14),
            AnchorPoint = Vector2.new(0.5, 0.5),
            Image = action.Icon or LucideIcons.Zap,
            ImageColor3 = Theme.TextSecondary
        })
        
        -- Tooltip
        local tooltip = Utility.Create("TextLabel", {
            Name = "Tooltip",
            Parent = actionButton,
            BackgroundColor3 = Theme.Surface,
            Position = UDim2.new(0.5, 0, 1, 8),
            Size = UDim2.new(0, 0, 0, 22),
            AnchorPoint = Vector2.new(0.5, 0),
            AutomaticSize = Enum.AutomaticSize.X,
            Font = Theme.Font,
            Text = action.Name,
            TextColor3 = Theme.TextPrimary,
            TextSize = 10,
            Visible = false,
            ZIndex = 100
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = tooltip
        })
        
        Utility.Create("UIPadding", {
            Parent = tooltip,
            PaddingLeft = UDim.new(0, 6),
            PaddingRight = UDim.new(0, 6)
        })
        
        actionButton.MouseEnter:Connect(function()
            Utility.Tween(actionButton, {BackgroundTransparency = 0.3}, 0.2)
            Utility.Tween(actionIcon, {ImageColor3 = Theme.Primary}, 0.2)
            tooltip.Visible = true
        end)
        
        actionButton.MouseLeave:Connect(function()
            Utility.Tween(actionButton, {BackgroundTransparency = 0.5}, 0.2)
            Utility.Tween(actionIcon, {ImageColor3 = Theme.TextSecondary}, 0.2)
            tooltip.Visible = false
        end)
        
        actionButton.MouseButton1Click:Connect(function()
            if action.Callback then
                action.Callback()
            end
            
            if self.Config.SoundEnabled then
                PlaySound("Click", 0.5)
            end
        end)
    end
end

--[[
    FlexUI - Part 4
    Basic Elements: Button, Toggle, Label, Checkbox
    Full Interactive Components with Animations
]]

--// Element Base Class
local Element = {}
Element.__index = Element

function Element.new(elementType, config, parent)
    local self = setmetatable({}, Element)
    
    self.Type = elementType
    self.Config = config
    self.Parent = parent
    self.Visible = true
    self.Enabled = true
    self.Value = nil
    
    -- Signals
    self.Changed = Signal.new()
    self.Clicked = Signal.new()
    self.Hovered = Signal.new()
    
    return self
end

function Element:SetVisible(visible)
    self.Visible = visible
    if self.Container then
        self.Container.Visible = visible
    end
end

function Element:SetEnabled(enabled)
    self.Enabled = enabled
    -- Override in subclasses
end

function Element:Destroy()
    if self.Container then
        self.Container:Destroy()
    end
    
    if self.Changed then
        self.Changed:Destroy()
    end
    
    if self.Clicked then
        self.Clicked:Destroy()
    end
end

--// Button Element
local Button = setmetatable({}, {__index = Element})
Button.__index = Button

function Tab:AddButton(config)
    return Button.new(config, self.ContentFrame, self)
end

function Section:AddButton(config)
    return Button.new(config, self.ContentContainer, self)
end

function Button.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Button", config, parentObject), Button)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Button",
        Description = config.Description or config.Desc,
        Icon = config.Icon,
        Callback = config.Callback or function() end,
        Style = config.Style or "Default", -- Default, Primary, Secondary, Success, Warning, Danger, Ghost
        Size = config.Size or "Normal", -- Small, Normal, Large
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
        DoubleClick = config.DoubleClick or false,
        HoldToConfirm = config.HoldToConfirm or false,
        HoldDuration = config.HoldDuration or 1,
    }
    
    self.Enabled = self.Config.Enabled
    self.LastClick = 0
    self.Holding = false
    
    self:_Create(parent)
    
    return self
end

function Button:_Create(parent)
    -- Get style colors
    local styleColors = self:_GetStyleColors()
    
    -- Get size
    local height = self.Config.Size == "Small" and 32 or (self.Config.Size == "Large" and 44 or 38)
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Button",
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, self.Config.Description and height + 20 or height),
        LayoutOrder = self.Config.Order
    })
    
    -- Main Button
    self.ButtonFrame = Utility.Create("TextButton", {
        Name = "Button",
        Parent = self.Container,
        BackgroundColor3 = styleColors.Background,
        BackgroundTransparency = styleColors.Transparency,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, height),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.ButtonFrame
    })
    
    -- Button Stroke
    self.ButtonStroke = Utility.Create("UIStroke", {
        Parent = self.ButtonFrame,
        Color = styleColors.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Content Container
    local contentContainer = Utility.Create("Frame", {
        Name = "Content",
        Parent = self.ButtonFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(1, -24, 1, 0),
        AnchorPoint = Vector2.new(0.5, 0.5)
    })
    
    -- Icon (Optional)
    local textOffset = 0
    if self.Config.Icon then
        self.IconLabel = Utility.Create("ImageLabel", {
            Name = "Icon",
            Parent = contentContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0.5, 0),
            Size = UDim2.new(0, 16, 0, 16),
            AnchorPoint = Vector2.new(0, 0.5),
            Image = self.Config.Icon,
            ImageColor3 = styleColors.Text
        })
        textOffset = 24
    end
    
    -- Button Text
    self.TextLabel = Utility.Create("TextLabel", {
        Name = "Text",
        Parent = contentContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, textOffset, 0.5, 0),
        Size = UDim2.new(1, -textOffset, 1, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = styleColors.Text,
        TextSize = self.Config.Size == "Small" and 12 or (self.Config.Size == "Large" and 15 or 13),
        TextXAlignment = self.Config.Icon and Enum.TextXAlignment.Left or Enum.TextXAlignment.Center
    })
    
    -- Description (Optional)
    if self.Config.Description then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 4, 0, height + 4),
            Size = UDim2.new(1, -8, 0, 16),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd
        })
    end
    
    -- Hold Progress Bar (for HoldToConfirm)
    if self.Config.HoldToConfirm then
        self.HoldProgress = Utility.Create("Frame", {
            Name = "HoldProgress",
            Parent = self.ButtonFrame,
            BackgroundColor3 = styleColors.Accent,
            BackgroundTransparency = 0.5,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 0, 1, -3),
            Size = UDim2.new(0, 0, 0, 3),
            ZIndex = 2
        })
        
        Utility.Create("UICorner", {
            CornerRadius = UDim.new(0, 2),
            Parent = self.HoldProgress
        })
    end
    
    -- Setup Interactions
    self:_SetupInteractions(styleColors)
    
    -- Disabled State
    if not self.Enabled then
        self:SetEnabled(false)
    end
end

function Button:_GetStyleColors()
    local styles = {
        Default = {
            Background = Theme.Surface,
            Transparency = 0.3,
            Border = Theme.Border,
            Text = Theme.TextPrimary,
            Hover = Theme.SurfaceHover,
            Active = Theme.SurfaceActive,
            Accent = Theme.Primary
        },
        Primary = {
            Background = Theme.Primary,
            Transparency = 0,
            Border = Theme.Primary,
            Text = Color3.fromRGB(255, 255, 255),
            Hover = ColorUtility.Lighten(Theme.Primary, 0.1),
            Active = ColorUtility.Darken(Theme.Primary, 0.1),
            Accent = Color3.fromRGB(255, 255, 255)
        },
        Secondary = {
            Background = Theme.Secondary,
            Transparency = 0,
            Border = Theme.Secondary,
            Text = Color3.fromRGB(255, 255, 255),
            Hover = ColorUtility.Lighten(Theme.Secondary, 0.1),
            Active = ColorUtility.Darken(Theme.Secondary, 0.1),
            Accent = Color3.fromRGB(255, 255, 255)
        },
        Success = {
            Background = Theme.Success,
            Transparency = 0,
            Border = Theme.Success,
            Text = Color3.fromRGB(255, 255, 255),
            Hover = ColorUtility.Lighten(Theme.Success, 0.1),
            Active = ColorUtility.Darken(Theme.Success, 0.1),
            Accent = Color3.fromRGB(255, 255, 255)
        },
        Warning = {
            Background = Theme.Warning,
            Transparency = 0,
            Border = Theme.Warning,
            Text = Color3.fromRGB(30, 30, 30),
            Hover = ColorUtility.Lighten(Theme.Warning, 0.1),
            Active = ColorUtility.Darken(Theme.Warning, 0.1),
            Accent = Color3.fromRGB(30, 30, 30)
        },
        Danger = {
            Background = Theme.Error,
            Transparency = 0,
            Border = Theme.Error,
            Text = Color3.fromRGB(255, 255, 255),
            Hover = ColorUtility.Lighten(Theme.Error, 0.1),
            Active = ColorUtility.Darken(Theme.Error, 0.1),
            Accent = Color3.fromRGB(255, 255, 255)
        },
        Ghost = {
            Background = Theme.Surface,
            Transparency = 1,
            Border = Theme.Border,
            Text = Theme.TextSecondary,
            Hover = Theme.Surface,
            Active = Theme.SurfaceHover,
            Accent = Theme.Primary
        }
    }
    
    return styles[self.Config.Style] or styles.Default
end

function Button:_SetupInteractions(styleColors)
    local isHovering = false
    local isPressed = false
    
    -- Hover Enter
    self.ButtonFrame.MouseEnter:Connect(function()
        if not self.Enabled then return end
        isHovering = true
        
        Utility.Tween(self.ButtonFrame, {
            BackgroundColor3 = styleColors.Hover,
            BackgroundTransparency = math.max(0, styleColors.Transparency - 0.1)
        }, 0.15)
        
        Utility.Tween(self.ButtonStroke, {Transparency = 0.3}, 0.15)
        
        self.Hovered:Fire(true)
        
        -- Play hover sound
        local mainParent = self:_GetMainParent()
        if mainParent and mainParent.Config.SoundEnabled then
            PlaySound("Hover", 0.2)
        end
    end)
    
    -- Hover Leave
    self.ButtonFrame.MouseLeave:Connect(function()
        if not self.Enabled then return end
        isHovering = false
        
        if not isPressed then
            Utility.Tween(self.ButtonFrame, {
                BackgroundColor3 = styleColors.Background,
                BackgroundTransparency = styleColors.Transparency
            }, 0.15)
            
            Utility.Tween(self.ButtonStroke, {Transparency = 0.5}, 0.15)
        end
        
        self.Hovered:Fire(false)
    end)
    
    -- Mouse Down
    self.ButtonFrame.MouseButton1Down:Connect(function()
        if not self.Enabled then return end
        isPressed = true
        
        Utility.Tween(self.ButtonFrame, {
            BackgroundColor3 = styleColors.Active,
            BackgroundTransparency = 0
        }, 0.1)
        
        -- Scale effect
        Utility.Tween(self.ButtonFrame, {Size = UDim2.new(1, -4, 0, self.ButtonFrame.Size.Y.Offset - 2)}, 0.1)
        Utility.Tween(self.ButtonFrame, {Position = UDim2.new(0, 2, 0, 1)}, 0.1)
        
        -- Hold to confirm
        if self.Config.HoldToConfirm then
            self.Holding = true
            self:_StartHoldProgress()
        end
    end)
    
    -- Mouse Up
    self.ButtonFrame.MouseButton1Up:Connect(function()
        if not self.Enabled then return end
        isPressed = false
        
        -- Reset scale
        Utility.Tween(self.ButtonFrame, {Size = UDim2.new(1, 0, 0, self.ButtonFrame.Size.Y.Offset + 2)}, 0.15)
        Utility.Tween(self.ButtonFrame, {Position = UDim2.new(0, 0, 0, 0)}, 0.15)
        
        if isHovering then
            Utility.Tween(self.ButtonFrame, {
                BackgroundColor3 = styleColors.Hover,
                BackgroundTransparency = math.max(0, styleColors.Transparency - 0.1)
            }, 0.15)
        else
            Utility.Tween(self.ButtonFrame, {
                BackgroundColor3 = styleColors.Background,
                BackgroundTransparency = styleColors.Transparency
            }, 0.15)
        end
        
        -- Cancel hold
        if self.Config.HoldToConfirm then
            self.Holding = false
            self:_ResetHoldProgress()
        end
    end)
    
    -- Click
    self.ButtonFrame.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        
        -- Double click check
        if self.Config.DoubleClick then
            local now = tick()
            if now - self.LastClick < 0.3 then
                self:_OnClick()
            end
            self.LastClick = now
        elseif not self.Config.HoldToConfirm then
            self:_OnClick()
        end
    end)
    
    -- Touch Support
    self.ButtonFrame.TouchTap:Connect(function()
        if not self.Enabled then return end
        
        if not self.Config.DoubleClick and not self.Config.HoldToConfirm then
            self:_OnClick()
        end
    end)
    
    self.ButtonFrame.TouchLongPress:Connect(function()
        if not self.Enabled then return end
        
        if self.Config.HoldToConfirm then
            self:_OnClick()
        end
    end)
end

function Button:_OnClick()
    -- Ripple effect
    Utility.Ripple(self.ButtonFrame, Mouse.X, Mouse.Y)
    
    -- Play click sound
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Config.SoundEnabled then
        PlaySound("Click", 0.5)
    end
    
    -- Fire signals
    self.Clicked:Fire()
    
    -- Execute callback
    task.spawn(function()
        self.Config.Callback()
    end)
end

function Button:_StartHoldProgress()
    local startTime = tick()
    local duration = self.Config.HoldDuration
    
    task.spawn(function()
        while self.Holding do
            local elapsed = tick() - startTime
            local progress = math.min(elapsed / duration, 1)
            
            self.HoldProgress.Size = UDim2.new(progress, 0, 0, 3)
            
            if progress >= 1 then
                self.Holding = false
                self:_OnClick()
                self:_ResetHoldProgress()
                break
            end
            
            task.wait()
        end
    end)
end

function Button:_ResetHoldProgress()
    if self.HoldProgress then
        Utility.Tween(self.HoldProgress, {Size = UDim2.new(0, 0, 0, 3)}, 0.2)
    end
end

function Button:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Config.SoundEnabled ~= nil then
            return parent
        end
        parent = parent.Config and parent.Config.Parent
    end
    return nil
end

function Button:SetText(text)
    self.Config.Name = text
    self.TextLabel.Text = text
end

function Button:SetDescription(desc)
    if self.DescriptionLabel then
        self.DescriptionLabel.Text = desc
    end
end

function Button:SetIcon(icon)
    if self.IconLabel then
        self.IconLabel.Image = icon
    end
end

function Button:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        Utility.Tween(self.ButtonFrame, {BackgroundTransparency = self:_GetStyleColors().Transparency}, 0.2)
        Utility.Tween(self.TextLabel, {TextTransparency = 0}, 0.2)
        if self.IconLabel then
            Utility.Tween(self.IconLabel, {ImageTransparency = 0}, 0.2)
        end
    else
        Utility.Tween(self.ButtonFrame, {BackgroundTransparency = 0.7}, 0.2)
        Utility.Tween(self.TextLabel, {TextTransparency = 0.5}, 0.2)
        if self.IconLabel then
            Utility.Tween(self.IconLabel, {ImageTransparency = 0.5}, 0.2)
        end
    end
end

function Button:SetCallback(callback)
    self.Config.Callback = callback
end

--// Toggle Element
local Toggle = setmetatable({}, {__index = Element})
Toggle.__index = Toggle

function Tab:AddToggle(config)
    return Toggle.new(config, self.ContentFrame, self)
end

function Section:AddToggle(config)
    return Toggle.new(config, self.ContentContainer, self)
end

function Toggle.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Toggle", config, parentObject), Toggle)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Toggle",
        Description = config.Description or config.Desc,
        Icon = config.Icon,
        Default = config.Default or false,
        Callback = config.Callback or function() end,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
    }
    
    self.Value = self.Config.Default
    self.Enabled = self.Config.Enabled
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    return self
end

function Toggle:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local height = hasDescription and 52 or 38
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Toggle",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, height),
        LayoutOrder = self.Config.Order
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    -- Hover Frame
    self.HoverFrame = Utility.Create("TextButton", {
        Name = "HoverFrame",
        Parent = self.Container,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        AutoButtonColor = false
    })
    
    -- Icon (Optional)
    local textOffset = 14
    if self.Config.Icon then
        self.IconLabel = Utility.Create("ImageLabel", {
            Name = "Icon",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 14, 0, hasDescription and 12 or 0),
            Size = UDim2.new(0, 18, 0, 18),
            AnchorPoint = Vector2.new(0, hasDescription and 0 or 0.5),
            Position = hasDescription and UDim2.new(0, 14, 0, 12) or UDim2.new(0, 14, 0.5, 0),
            Image = self.Config.Icon,
            ImageColor3 = Theme.TextSecondary
        })
        textOffset = 40
    end
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, textOffset, 0, hasDescription and 10 or 0),
        Size = UDim2.new(1, -textOffset - 70, 0, 18),
        AnchorPoint = hasDescription and Vector2.new(0, 0) or Vector2.new(0, 0.5),
        Position = hasDescription and UDim2.new(0, textOffset, 0, 10) or UDim2.new(0, textOffset, 0.5, 0),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, textOffset, 0, 28),
            Size = UDim2.new(1, -textOffset - 70, 0, 16),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd
        })
    end
    
    -- Toggle Switch
    self.ToggleContainer = Utility.Create("Frame", {
        Name = "ToggleSwitch",
        Parent = self.Container,
        BackgroundColor3 = self.Value and Theme.ToggleOn or Theme.ToggleOff,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -58, 0.5, 0),
        Size = UDim2.new(0, 44, 0, 24),
        AnchorPoint = Vector2.new(0, 0.5)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.ToggleContainer
    })
    
    -- Toggle Knob
    self.ToggleKnob = Utility.Create("Frame", {
        Name = "Knob",
        Parent = self.ToggleContainer,
        BackgroundColor3 = Theme.ToggleKnob,
        BorderSizePixel = 0,
        Position = self.Value and UDim2.new(1, -22, 0.5, 0) or UDim2.new(0, 2, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 20),
        AnchorPoint = Vector2.new(0, 0.5)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.ToggleKnob
    })
    
    -- Knob Shadow
    Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = self.ToggleKnob,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 2),
        Size = UDim2.new(1, 8, 1, 8),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = -1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.7,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    -- Check Icon on Knob
    self.CheckIcon = Utility.Create("ImageLabel", {
        Name = "Check",
        Parent = self.ToggleKnob,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 12, 0, 12),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Check,
        ImageColor3 = Theme.ToggleOn,
        ImageTransparency = self.Value and 0 or 1
    })
    
    -- Setup Interactions
    self:_SetupInteractions()
    
    -- Disabled State
    if not self.Enabled then
        self:SetEnabled(false)
    end
end

function Toggle:_SetupInteractions()
    -- Hover Effects
    self.HoverFrame.MouseEnter:Connect(function()
        if not self.Enabled then return end
        
        Utility.Tween(self.Container, {BackgroundTransparency = 0.3}, 0.15)
        
        -- Knob hover effect
        Utility.Tween(self.ToggleKnob, {Size = UDim2.new(0, 22, 0, 22)}, 0.15)
        
        local mainParent = self:_GetMainParent()
        if mainParent and mainParent.Config.SoundEnabled then
            PlaySound("Hover", 0.2)
        end
    end)
    
    self.HoverFrame.MouseLeave:Connect(function()
        if not self.Enabled then return end
        
        Utility.Tween(self.Container, {BackgroundTransparency = 0.5}, 0.15)
        Utility.Tween(self.ToggleKnob, {Size = UDim2.new(0, 20, 0, 20)}, 0.15)
    end)
    
    -- Click
    self.HoverFrame.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        self:Toggle()
    end)
    
    -- Touch Support
    self.HoverFrame.TouchTap:Connect(function()
        if not self.Enabled then return end
        self:Toggle()
    end)
end

function Toggle:Toggle()
    self:SetValue(not self.Value)
end

function Toggle:SetValue(value, skipCallback)
    local oldValue = self.Value
    self.Value = value
    
    -- Animate toggle
    if value then
        Utility.Tween(self.ToggleContainer, {BackgroundColor3 = Theme.ToggleOn}, 0.2)
        Utility.Tween(self.ToggleKnob, {Position = UDim2.new(1, -22, 0.5, 0)}, 0.2, Enum.EasingStyle.Back)
        Utility.Tween(self.CheckIcon, {ImageTransparency = 0}, 0.2)
    else
        Utility.Tween(self.ToggleContainer, {BackgroundColor3 = Theme.ToggleOff}, 0.2)
        Utility.Tween(self.ToggleKnob, {Position = UDim2.new(0, 2, 0.5, 0)}, 0.2, Enum.EasingStyle.Back)
        Utility.Tween(self.CheckIcon, {ImageTransparency = 1}, 0.2)
    end
    
    -- Play sound
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Config.SoundEnabled then
        PlaySound("Toggle", 0.5)
    end
    
    -- Fire changed signal
    if oldValue ~= value then
        self.Changed:Fire(value)
        
        -- Update flag
        if self.Config.Flag then
            self:_SetFlag()
        end
        
        -- Execute callback
        if not skipCallback then
            task.spawn(function()
                self.Config.Callback(value)
            end)
        end
    end
end

function Toggle:GetValue()
    return self.Value
end

function Toggle:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function Toggle:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function Toggle:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        Utility.Tween(self.Container, {BackgroundTransparency = 0.5}, 0.2)
        Utility.Tween(self.TitleLabel, {TextTransparency = 0}, 0.2)
        Utility.Tween(self.ToggleContainer, {BackgroundTransparency = 0}, 0.2)
    else
        Utility.Tween(self.Container, {BackgroundTransparency = 0.7}, 0.2)
        Utility.Tween(self.TitleLabel, {TextTransparency = 0.5}, 0.2)
        Utility.Tween(self.ToggleContainer, {BackgroundTransparency = 0.5}, 0.2)
    end
end

function Toggle:SetText(text)
    self.Config.Name = text
    self.TitleLabel.Text = text
end

function Toggle:SetCallback(callback)
    self.Config.Callback = callback
end

--// Label Element
local Label = setmetatable({}, {__index = Element})
Label.__index = Label

function Tab:AddLabel(config)
    return Label.new(config, self.ContentFrame, self)
end

function Section:AddLabel(config)
    return Label.new(config, self.ContentContainer, self)
end

function Label.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Label", config, parentObject), Label)
    
    -- Configuration
    self.Config = {
        Text = config.Text or config.Name or "Label",
        Icon = config.Icon,
        Color = config.Color or Theme.TextPrimary,
        Style = config.Style or "Normal", -- Normal, Header, SubHeader, Caption
        Alignment = config.Alignment or "Left", -- Left, Center, Right
        Order = config.Order or 0,
    }
    
    self:_Create(parent)
    
    return self
end

function Label:_Create(parent)
    local styles = {
        Normal = {Font = Theme.Font, Size = 13, Color = Theme.TextPrimary},
        Header = {Font = Theme.FontBold, Size = 18, Color = Theme.TextPrimary},
        SubHeader = {Font = Theme.FontBold, Size = 15, Color = Theme.TextSecondary},
        Caption = {Font = Theme.FontLight, Size = 11, Color = Theme.TextTertiary},
    }
    
    local style = styles[self.Config.Style] or styles.Normal
    
    local alignments = {
        Left = Enum.TextXAlignment.Left,
        Center = Enum.TextXAlignment.Center,
        Right = Enum.TextXAlignment.Right
    }
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = "Label",
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = self.Config.Order
    })
    
    -- Icon (Optional)
    local textOffset = 0
    if self.Config.Icon then
        self.IconLabel = Utility.Create("ImageLabel", {
            Name = "Icon",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, 2),
            Size = UDim2.new(0, style.Size, 0, style.Size),
            Image = self.Config.Icon,
            ImageColor3 = self.Config.Color or style.Color
        })
        textOffset = style.Size + 8
    end
    
    -- Text Label
    self.TextLabel = Utility.Create("TextLabel", {
        Name = "Text",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, textOffset, 0, 0),
        Size = UDim2.new(1, -textOffset, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = style.Font,
        Text = self.Config.Text,
        TextColor3 = self.Config.Color or style.Color,
        TextSize = style.Size,
        TextXAlignment = alignments[self.Config.Alignment],
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true
    })
end

function Label:SetText(text)
    self.Config.Text = text
    self.TextLabel.Text = text
end

function Label:SetColor(color)
    self.Config.Color = color
    self.TextLabel.TextColor3 = color
    if self.IconLabel then
        self.IconLabel.ImageColor3 = color
    end
end

function Label:SetIcon(icon)
    if self.IconLabel then
        self.IconLabel.Image = icon
    end
end

--// Checkbox Element (Alternative to Toggle)
local Checkbox = setmetatable({}, {__index = Element})
Checkbox.__index = Checkbox

function Tab:AddCheckbox(config)
    return Checkbox.new(config, self.ContentFrame, self)
end

function Section:AddCheckbox(config)
    return Checkbox.new(config, self.ContentContainer, self)
end

function Checkbox.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Checkbox", config, parentObject), Checkbox)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Checkbox",
        Description = config.Description,
        Default = config.Default or false,
        Callback = config.Callback or function() end,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
    }
    
    self.Value = self.Config.Default
    self.Enabled = self.Config.Enabled
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    return self
end

function Checkbox:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local height = hasDescription and 48 or 32
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Checkbox",
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, height),
        LayoutOrder = self.Config.Order
    })
    
    -- Hover Button
    self.HoverFrame = Utility.Create("TextButton", {
        Name = "HoverFrame",
        Parent = self.Container,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
        AutoButtonColor = false
    })
    
    -- Checkbox Box
    self.CheckboxFrame = Utility.Create("Frame", {
        Name = "Checkbox",
        Parent = self.Container,
        BackgroundColor3 = self.Value and Theme.Primary or Theme.Surface,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, hasDescription and 8 or 4),
        Size = UDim2.new(0, 22, 0, 22)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.CheckboxFrame
    })
    
    self.CheckboxStroke = Utility.Create("UIStroke", {
        Parent = self.CheckboxFrame,
        Color = self.Value and Theme.Primary or Theme.Border,
        Thickness = 2,
        Transparency = 0
    })
    
    -- Check Icon
    self.CheckIcon = Utility.Create("ImageLabel", {
        Name = "Check",
        Parent = self.CheckboxFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Check,
        ImageColor3 = Color3.fromRGB(255, 255, 255),
        ImageTransparency = self.Value and 0 or 1
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 32, 0, hasDescription and 8 or 4),
        Size = UDim2.new(1, -40, 0, 16),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 32, 0, 26),
            Size = UDim2.new(1, -40, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Setup Interactions
    self:_SetupInteractions()
end

function Checkbox:_SetupInteractions()
    -- Hover Effects
    self.HoverFrame.MouseEnter:Connect(function()
        if not self.Enabled then return end
        
        Utility.Tween(self.CheckboxFrame, {BackgroundTransparency = 0.1}, 0.15)
        
        local mainParent = self:_GetMainParent()
        if mainParent and mainParent.Config.SoundEnabled then
            PlaySound("Hover", 0.2)
        end
    end)
    
    self.HoverFrame.MouseLeave:Connect(function()
        if not self.Enabled then return end
        Utility.Tween(self.CheckboxFrame, {BackgroundTransparency = 0}, 0.15)
    end)
    
    -- Click
    self.HoverFrame.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        self:Toggle()
    end)
    
    -- Touch Support
    self.HoverFrame.TouchTap:Connect(function()
        if not self.Enabled then return end
        self:Toggle()
    end)
end

function Checkbox:Toggle()
    self:SetValue(not self.Value)
end

function Checkbox:SetValue(value, skipCallback)
    local oldValue = self.Value
    self.Value = value
    
    -- Animate checkbox
    if value then
        Utility.Tween(self.CheckboxFrame, {BackgroundColor3 = Theme.Primary}, 0.2)
        Utility.Tween(self.CheckboxStroke, {Color = Theme.Primary}, 0.2)
        Utility.Tween(self.CheckIcon, {ImageTransparency = 0}, 0.15)
        
        -- Scale animation
        Utility.Tween(self.CheckboxFrame, {Size = UDim2.new(0, 24, 0, 24)}, 0.1)
        task.delay(0.1, function()
            Utility.Tween(self.CheckboxFrame, {Size = UDim2.new(0, 22, 0, 22)}, 0.1)
        end)
    else
        Utility.Tween(self.CheckboxFrame, {BackgroundColor3 = Theme.Surface}, 0.2)
        Utility.Tween(self.CheckboxStroke, {Color = Theme.Border}, 0.2)
        Utility.Tween(self.CheckIcon, {ImageTransparency = 1}, 0.15)
    end
    
    -- Play sound
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Config.SoundEnabled then
        PlaySound("Click", 0.5)
    end
    
    -- Fire changed signal
    if oldValue ~= value then
        self.Changed:Fire(value)
        
        -- Update flag
        if self.Config.Flag then
            self:_SetFlag()
        end
        
        -- Execute callback
        if not skipCallback then
            task.spawn(function()
                self.Config.Callback(value)
            end)
        end
    end
end

function Checkbox:GetValue()
    return self.Value
end

function Checkbox:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function Checkbox:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function Checkbox:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        self.TitleLabel.TextTransparency = 0
        self.CheckboxFrame.BackgroundTransparency = 0
    else
        self.TitleLabel.TextTransparency = 0.5
        self.CheckboxFrame.BackgroundTransparency = 0.5
    end
end

--// Button Group (Multiple buttons in a row)
local ButtonGroup = setmetatable({}, {__index = Element})
ButtonGroup.__index = ButtonGroup

function Tab:AddButtonGroup(config)
    return ButtonGroup.new(config, self.ContentFrame, self)
end

function Section:AddButtonGroup(config)
    return ButtonGroup.new(config, self.ContentContainer, self)
end

function ButtonGroup.new(config, parent, parentObject)
    local self = setmetatable(Element.new("ButtonGroup", config, parentObject), ButtonGroup)
    
    -- Configuration
    self.Config = {
        Buttons = config.Buttons or {},
        Order = config.Order or 0,
    }
    
    self.Buttons = {}
    
    self:_Create(parent)
    
    return self
end

function ButtonGroup:_Create(parent)
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = "ButtonGroup",
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 36),
        LayoutOrder = self.Config.Order
    })
    
    -- Layout
    Utility.Create("UIListLayout", {
        Parent = self.Container,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Left,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 8)
    })
    
    -- Create Buttons
    local buttonCount = #self.Config.Buttons
    local buttonWidth = (1 / buttonCount) - 0.02
    
    for i, buttonConfig in ipairs(self.Config.Buttons) do
        local button = Utility.Create("TextButton", {
            Name = buttonConfig.Name or ("Button" .. i),
            Parent = self.Container,
            BackgroundColor3 = Theme.Surface,
            BackgroundTransparency = 0.3,
            BorderSizePixel = 0,
            Size = UDim2.new(buttonWidth, -4, 1, 0),
            Text = "",
            AutoButtonColor = false
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadius,
            Parent = button
        })
        
        -- Icon
        local textOffset = 0
        if buttonConfig.Icon then
            local icon = Utility.Create("ImageLabel", {
                Name = "Icon",
                Parent = button,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0.5, 0),
                Size = UDim2.new(0, 14, 0, 14),
                AnchorPoint = Vector2.new(0, 0.5),
                Image = buttonConfig.Icon,
                ImageColor3 = Theme.TextSecondary
            })
            textOffset = 28
        end
        
        -- Text
        local textLabel = Utility.Create("TextLabel", {
            Name = "Text",
            Parent = button,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, textOffset, 0, 0),
            Size = UDim2.new(1, -textOffset - 8, 1, 0),
            Font = Theme.Font,
            Text = buttonConfig.Name or "Button",
            TextColor3 = Theme.TextPrimary,
            TextSize = 12,
            TextXAlignment = buttonConfig.Icon and Enum.TextXAlignment.Left or Enum.TextXAlignment.Center
        })
        
        -- Interactions
        button.MouseEnter:Connect(function()
            Utility.Tween(button, {BackgroundTransparency = 0.1}, 0.15)
        end)
        
        button.MouseLeave:Connect(function()
            Utility.Tween(button, {BackgroundTransparency = 0.3}, 0.15)
        end)
        
        button.MouseButton1Click:Connect(function()
            Utility.Ripple(button, Mouse.X, Mouse.Y)
            
            if buttonConfig.Callback then
                task.spawn(buttonConfig.Callback)
            end
        end)
        
        table.insert(self.Buttons, {
            Frame = button,
            Config = buttonConfig
        })
    end
end

--// Info Box Element
local InfoBox = setmetatable({}, {__index = Element})
InfoBox.__index = InfoBox

function Tab:AddInfoBox(config)
    return InfoBox.new(config, self.ContentFrame, self)
end

function Section:AddInfoBox(config)
    return InfoBox.new(config, self.ContentContainer, self)
end

function InfoBox.new(config, parent, parentObject)
    local self = setmetatable(Element.new("InfoBox", config, parentObject), InfoBox)
    
    -- Configuration
    self.Config = {
        Title = config.Title,
        Text = config.Text or config.Content or "",
        Type = config.Type or "Info", -- Info, Success, Warning, Error
        Dismissible = config.Dismissible or false,
        Order = config.Order or 0,
    }
    
    self:_Create(parent)
    
    return self
end

function InfoBox:_Create(parent)
    local typeColors = {
        Info = {Background = Theme.Info, Icon = LucideIcons.Info},
        Success = {Background = Theme.Success, Icon = LucideIcons.CheckCircle},
        Warning = {Background = Theme.Warning, Icon = LucideIcons.AlertTriangle},
        Error = {Background = Theme.Error, Icon = LucideIcons.AlertCircle}
    }
    
    local typeConfig = typeColors[self.Config.Type] or typeColors.Info
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = "InfoBox",
        Parent = parent,
        BackgroundColor3 = typeConfig.Background,
        BackgroundTransparency = 0.85,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = self.Config.Order
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    Utility.Create("UIStroke", {
        Parent = self.Container,
        Color = typeConfig.Background,
        Thickness = 1,
        Transparency = 0.5
    })
    
    Utility.Create("UIPadding", {
        Parent = self.Container,
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    -- Icon
    self.IconLabel = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0, 20, 0, 20),
        Image = typeConfig.Icon,
        ImageColor3 = typeConfig.Background
    })
    
    -- Content Container
    local contentContainer = Utility.Create("Frame", {
        Name = "Content",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 28, 0, 0),
        Size = UDim2.new(1, -28 - (self.Config.Dismissible and 24 or 0), 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y
    })
    
    -- Title (Optional)
    local textOffset = 0
    if self.Config.Title then
        self.TitleLabel = Utility.Create("TextLabel", {
            Name = "Title",
            Parent = contentContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 16),
            Font = Theme.FontBold,
            Text = self.Config.Title,
            TextColor3 = typeConfig.Background,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        textOffset = 20
    end
    
    -- Text
    self.TextLabel = Utility.Create("TextLabel", {
        Name = "Text",
        Parent = contentContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, textOffset),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = Theme.Font,
        Text = self.Config.Text,
        TextColor3 = Theme.TextPrimary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true
    })
    
    -- Dismiss Button
    if self.Config.Dismissible then
        local dismissButton = Utility.Create("TextButton", {
            Name = "Dismiss",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, -20, 0, 0),
            Size = UDim2.new(0, 16, 0, 16),
            Text = ""
        })
        
        local dismissIcon = Utility.Create("ImageLabel", {
            Name = "Icon",
            Parent = dismissButton,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Image = LucideIcons.X,
            ImageColor3 = Theme.TextSecondary
        })
        
        dismissButton.MouseButton1Click:Connect(function()
            self:Dismiss()
        end)
    end
end

function InfoBox:SetText(text)
    self.Config.Text = text
    self.TextLabel.Text = text
end

function InfoBox:SetTitle(title)
    if self.TitleLabel then
        self.Config.Title = title
        self.TitleLabel.Text = title
    end
end

function InfoBox:Dismiss()
    Utility.Tween(self.Container, {
        Size = UDim2.new(1, 0, 0, 0),
        BackgroundTransparency = 1
    }, 0.3)
    
    task.delay(0.3, function()
        self.Container:Destroy()
    end)
end

--[[
    FlexUI - Part 5
    Advanced Elements: Slider, Dropdown, Textbox, Input
    Full Interactive Components with Smooth Animations
]]

--// Slider Element
local Slider = setmetatable({}, {__index = Element})
Slider.__index = Slider

function Tab:AddSlider(config)
    return Slider.new(config, self.ContentFrame, self)
end

function Section:AddSlider(config)
    return Slider.new(config, self.ContentContainer, self)
end

function Slider.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Slider", config, parentObject), Slider)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Slider",
        Description = config.Description or config.Desc,
        Min = config.Min or config.Minimum or 0,
        Max = config.Max or config.Maximum or 100,
        Default = config.Default or config.Min or 0,
        Increment = config.Increment or config.Step or 1,
        Suffix = config.Suffix or "",
        Prefix = config.Prefix or "",
        Callback = config.Callback or function() end,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
        ShowValue = config.ShowValue ~= false,
        ShowMinMax = config.ShowMinMax or false,
        Decimals = config.Decimals or 0,
    }
    
    self.Value = self.Config.Default
    self.Enabled = self.Config.Enabled
    self.Dragging = false
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    return self
end

function Slider:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local height = hasDescription and 70 or 54
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Slider",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, height),
        LayoutOrder = self.Config.Order
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    -- Title Row
    local titleRow = Utility.Create("Frame", {
        Name = "TitleRow",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 10),
        Size = UDim2.new(1, -28, 0, 18)
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = titleRow,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 1, 0),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Value Display
    if self.Config.ShowValue then
        self.ValueContainer = Utility.Create("Frame", {
            Name = "ValueContainer",
            Parent = titleRow,
            BackgroundColor3 = Theme.BackgroundTertiary,
            BackgroundTransparency = 0.5,
            Position = UDim2.new(1, 0, 0.5, 0),
            Size = UDim2.new(0, 60, 0, 22),
            AnchorPoint = Vector2.new(1, 0.5)
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = self.ValueContainer
        })
        
        self.ValueLabel = Utility.Create("TextLabel", {
            Name = "Value",
            Parent = self.ValueContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Font = Theme.Font,
            Text = self:_FormatValue(self.Value),
            TextColor3 = Theme.Primary,
            TextSize = 12
        })
        
        -- Editable Value Input
        self.ValueInput = Utility.Create("TextBox", {
            Name = "ValueInput",
            Parent = self.ValueContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Font = Theme.Font,
            Text = "",
            TextColor3 = Theme.Primary,
            TextSize = 12,
            ClearTextOnFocus = true,
            Visible = false
        })
        
        -- Double click to edit
        self.ValueContainer.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                self.ValueLabel.Visible = false
                self.ValueInput.Visible = true
                self.ValueInput.Text = tostring(self.Value)
                self.ValueInput:CaptureFocus()
            end
        end)
        
        self.ValueInput.FocusLost:Connect(function(enterPressed)
            self.ValueLabel.Visible = true
            self.ValueInput.Visible = false
            
            if enterPressed then
                local newValue = tonumber(self.ValueInput.Text)
                if newValue then
                    self:SetValue(newValue)
                end
            end
        end)
    end
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 14, 0, 28),
            Size = UDim2.new(1, -28, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Slider Track Container
    local trackYPos = hasDescription and 48 or 34
    
    self.TrackContainer = Utility.Create("Frame", {
        Name = "TrackContainer",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, trackYPos),
        Size = UDim2.new(1, -28, 0, 16)
    })
    
    -- Min/Max Labels
    if self.Config.ShowMinMax then
        Utility.Create("TextLabel", {
            Name = "MinLabel",
            Parent = self.TrackContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 1, 2),
            Size = UDim2.new(0, 30, 0, 12),
            Font = Theme.FontLight,
            Text = tostring(self.Config.Min),
            TextColor3 = Theme.TextTertiary,
            TextSize = 10,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        Utility.Create("TextLabel", {
            Name = "MaxLabel",
            Parent = self.TrackContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, -30, 1, 2),
            Size = UDim2.new(0, 30, 0, 12),
            Font = Theme.FontLight,
            Text = tostring(self.Config.Max),
            TextColor3 = Theme.TextTertiary,
            TextSize = 10,
            TextXAlignment = Enum.TextXAlignment.Right
        })
    end
    
    -- Slider Track (Background)
    self.Track = Utility.Create("Frame", {
        Name = "Track",
        Parent = self.TrackContainer,
        BackgroundColor3 = Theme.SliderTrack,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(1, 0, 0, 6),
        AnchorPoint = Vector2.new(0, 0.5)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.Track
    })
    
    -- Slider Fill
    local initialFill = (self.Value - self.Config.Min) / (self.Config.Max - self.Config.Min)
    
    self.Fill = Utility.Create("Frame", {
        Name = "Fill",
        Parent = self.Track,
        BackgroundColor3 = Theme.SliderFill,
        BorderSizePixel = 0,
        Size = UDim2.new(initialFill, 0, 1, 0)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.Fill
    })
    
    -- Gradient on Fill
    Utility.Create("UIGradient", {
        Parent = self.Fill,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
        }),
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0.9),
            NumberSequenceKeypoint.new(1, 0.95)
        }),
        Rotation = 90
    })
    
    -- Slider Knob
    self.Knob = Utility.Create("Frame", {
        Name = "Knob",
        Parent = self.Track,
        BackgroundColor3 = Theme.SliderKnob,
        BorderSizePixel = 0,
        Position = UDim2.new(initialFill, 0, 0.5, 0),
        Size = UDim2.new(0, 18, 0, 18),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 2
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.Knob
    })
    
    -- Knob Shadow
    Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = self.Knob,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 2),
        Size = UDim2.new(1, 10, 1, 10),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    -- Knob Inner Circle (accent)
    self.KnobInner = Utility.Create("Frame", {
        Name = "Inner",
        Parent = self.Knob,
        BackgroundColor3 = Theme.SliderFill,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 8, 0, 8),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 3
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.KnobInner
    })
    
    -- Interaction Area
    self.InteractionFrame = Utility.Create("TextButton", {
        Name = "Interaction",
        Parent = self.TrackContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -10, 0, -5),
        Size = UDim2.new(1, 20, 1, 10),
        Text = "",
        ZIndex = 5
    })
    
    -- Setup Interactions
    self:_SetupInteractions()
    
    -- Disabled State
    if not self.Enabled then
        self:SetEnabled(false)
    end
end

function Slider:_SetupInteractions()
    local dragging = false
    
    -- Calculate value from position
    local function calculateValue(inputX)
        local trackStart = self.Track.AbsolutePosition.X
        local trackWidth = self.Track.AbsoluteSize.X
        
        local relativeX = math.clamp((inputX - trackStart) / trackWidth, 0, 1)
        local rawValue = self.Config.Min + (self.Config.Max - self.Config.Min) * relativeX
        
        -- Apply increment
        local increment = self.Config.Increment
        local snappedValue = math.floor(rawValue / increment + 0.5) * increment
        
        return math.clamp(snappedValue, self.Config.Min, self.Config.Max)
    end
    
    -- Update visual
    local function updateVisual(value)
        local fill = (value - self.Config.Min) / (self.Config.Max - self.Config.Min)
        
        Utility.Tween(self.Fill, {Size = UDim2.new(fill, 0, 1, 0)}, 0.05)
        Utility.Tween(self.Knob, {Position = UDim2.new(fill, 0, 0.5, 0)}, 0.05)
        
        if self.ValueLabel then
            self.ValueLabel.Text = self:_FormatValue(value)
        end
    end
    
    -- Hover Effects
    self.InteractionFrame.MouseEnter:Connect(function()
        if not self.Enabled then return end
        
        Utility.Tween(self.Container, {BackgroundTransparency = 0.3}, 0.15)
        Utility.Tween(self.Knob, {Size = UDim2.new(0, 22, 0, 22)}, 0.15)
        Utility.Tween(self.KnobInner, {Size = UDim2.new(0, 10, 0, 10)}, 0.15)
        
        local mainParent = self:_GetMainParent()
        if mainParent and mainParent.Config.SoundEnabled then
            PlaySound("Hover", 0.2)
        end
    end)
    
    self.InteractionFrame.MouseLeave:Connect(function()
        if not self.Enabled then return end
        
        if not dragging then
            Utility.Tween(self.Container, {BackgroundTransparency = 0.5}, 0.15)
            Utility.Tween(self.Knob, {Size = UDim2.new(0, 18, 0, 18)}, 0.15)
            Utility.Tween(self.KnobInner, {Size = UDim2.new(0, 8, 0, 8)}, 0.15)
        end
    end)
    
    -- Mouse Down
    self.InteractionFrame.InputBegan:Connect(function(input)
        if not self.Enabled then return end
        
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            self.Dragging = true
            
            -- Scale knob
            Utility.Tween(self.Knob, {Size = UDim2.new(0, 24, 0, 24)}, 0.1)
            
            -- Initial update
            local inputX = input.Position.X
            local newValue = calculateValue(inputX)
            
            if newValue ~= self.Value then
                self.Value = newValue
                updateVisual(newValue)
                self:_TriggerCallback()
            end
        end
    end)
    
    -- Global Mouse Move & Up
    local mainParent = self:_GetMainParent()
    if mainParent then
        table.insert(mainParent.Connections, UserInputService.InputChanged:Connect(function(input)
            if not dragging then return end
            
            if input.UserInputType == Enum.UserInputType.MouseMovement or
               input.UserInputType == Enum.UserInputType.Touch then
                local inputX = input.Position.X
                local newValue = calculateValue(inputX)
                
                if newValue ~= self.Value then
                    self.Value = newValue
                    updateVisual(newValue)
                    
                    -- Update flag
                    if self.Config.Flag then
                        self:_SetFlag()
                    end
                end
            end
        end))
        
        table.insert(mainParent.Connections, UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                if dragging then
                    dragging = false
                    self.Dragging = false
                    
                    -- Reset knob size
                    Utility.Tween(self.Knob, {Size = UDim2.new(0, 18, 0, 18)}, 0.15)
                    Utility.Tween(self.Container, {BackgroundTransparency = 0.5}, 0.15)
                    
                    -- Final callback
                    self:_TriggerCallback()
                    
                    -- Play sound
                    if mainParent.Config.SoundEnabled then
                        PlaySound("Slider", 0.3)
                    end
                end
            end
        end))
    end
    
    -- Click on track to jump
    self.InteractionFrame.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        
        local inputX = Mouse.X
        local newValue = calculateValue(inputX)
        self:SetValue(newValue)
    end)
end

function Slider:_FormatValue(value)
    local formatted
    if self.Config.Decimals > 0 then
        formatted = string.format("%." .. self.Config.Decimals .. "f", value)
    else
        formatted = tostring(math.floor(value))
    end
    
    return self.Config.Prefix .. formatted .. self.Config.Suffix
end

function Slider:_TriggerCallback()
    self.Changed:Fire(self.Value)
    
    task.spawn(function()
        self.Config.Callback(self.Value)
    end)
end

function Slider:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function Slider:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function Slider:SetValue(value, skipCallback)
    value = math.clamp(value, self.Config.Min, self.Config.Max)
    
    -- Apply increment
    local increment = self.Config.Increment
    value = math.floor(value / increment + 0.5) * increment
    
    local oldValue = self.Value
    self.Value = value
    
    -- Update visual
    local fill = (value - self.Config.Min) / (self.Config.Max - self.Config.Min)
    Utility.Tween(self.Fill, {Size = UDim2.new(fill, 0, 1, 0)}, 0.2)
    Utility.Tween(self.Knob, {Position = UDim2.new(fill, 0, 0.5, 0)}, 0.2)
    
    if self.ValueLabel then
        self.ValueLabel.Text = self:_FormatValue(value)
    end
    
    -- Update flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    -- Callback
    if oldValue ~= value and not skipCallback then
        self:_TriggerCallback()
    end
end

function Slider:GetValue()
    return self.Value
end

function Slider:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        Utility.Tween(self.Container, {BackgroundTransparency = 0.5}, 0.2)
        Utility.Tween(self.Fill, {BackgroundTransparency = 0}, 0.2)
        Utility.Tween(self.Knob, {BackgroundTransparency = 0}, 0.2)
    else
        Utility.Tween(self.Container, {BackgroundTransparency = 0.7}, 0.2)
        Utility.Tween(self.Fill, {BackgroundTransparency = 0.5}, 0.2)
        Utility.Tween(self.Knob, {BackgroundTransparency = 0.5}, 0.2)
    end
end

function Slider:SetMin(min)
    self.Config.Min = min
    if self.Value < min then
        self:SetValue(min)
    end
end

function Slider:SetMax(max)
    self.Config.Max = max
    if self.Value > max then
        self:SetValue(max)
    end
end

--// Dropdown Element
local Dropdown = setmetatable({}, {__index = Element})
Dropdown.__index = Dropdown

function Tab:AddDropdown(config)
    return Dropdown.new(config, self.ContentFrame, self)
end

function Section:AddDropdown(config)
    return Dropdown.new(config, self.ContentContainer, self)
end

function Dropdown.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Dropdown", config, parentObject), Dropdown)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Dropdown",
        Description = config.Description or config.Desc,
        Options = config.Options or config.Items or {},
        Default = config.Default,
        Placeholder = config.Placeholder or "Select an option...",
        Callback = config.Callback or function() end,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
        Searchable = config.Searchable or false,
        MaxVisibleItems = config.MaxVisibleItems or 6,
        ClearOnSelect = config.ClearOnSelect or false,
    }
    
    self.Value = self.Config.Default
    self.Enabled = self.Config.Enabled
    self.Open = false
    self.Options = {}
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    return self
end

function Dropdown:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local height = hasDescription and 70 or 54
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Dropdown",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, height),
        ClipsDescendants = false,
        LayoutOrder = self.Config.Order,
        ZIndex = 10
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 10),
        Size = UDim2.new(1, -28, 0, 16),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 14, 0, 26),
            Size = UDim2.new(1, -28, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Dropdown Button
    local buttonYPos = hasDescription and 44 or 30
    
    self.DropdownButton = Utility.Create("TextButton", {
        Name = "DropdownButton",
        Parent = self.Container,
        BackgroundColor3 = Theme.BackgroundTertiary,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 14, 0, buttonYPos),
        Size = UDim2.new(1, -28, 0, 32),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.DropdownButton
    })
    
    self.DropdownStroke = Utility.Create("UIStroke", {
        Parent = self.DropdownButton,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Selected Text
    self.SelectedLabel = Utility.Create("TextLabel", {
        Name = "Selected",
        Parent = self.DropdownButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -44, 1, 0),
        Font = Theme.Font,
        Text = self.Value or self.Config.Placeholder,
        TextColor3 = self.Value and Theme.TextPrimary or Theme.TextTertiary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Arrow Icon
    self.ArrowIcon = Utility.Create("ImageLabel", {
        Name = "Arrow",
        Parent = self.DropdownButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -28, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(0, 0.5),
        Image = LucideIcons.ChevronDown,
        ImageColor3 = Theme.TextSecondary
    })
    
    -- Dropdown Menu
    self:_CreateDropdownMenu()
    
    -- Setup Interactions
    self:_SetupInteractions()
end

function Dropdown:_CreateDropdownMenu()
    local itemHeight = 32
    local maxItems = self.Config.MaxVisibleItems
    local menuHeight = math.min(#self.Config.Options, maxItems) * itemHeight + (self.Config.Searchable and 40 or 8)
    
    -- Menu Container
    self.MenuContainer = Utility.Create("Frame", {
        Name = "Menu",
        Parent = self.Container,
        BackgroundColor3 = Theme.DropdownBackground,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 14, 1, 4),
        Size = UDim2.new(1, -28, 0, 0),
        ClipsDescendants = true,
        Visible = false,
        ZIndex = 100
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.MenuContainer
    })
    
    Utility.Create("UIStroke", {
        Parent = self.MenuContainer,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Shadow
    Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = self.MenuContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 4),
        Size = UDim2.new(1, 16, 1, 16),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 99,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    -- Search Box (if searchable)
    if self.Config.Searchable then
        self.SearchContainer = Utility.Create("Frame", {
            Name = "SearchContainer",
            Parent = self.MenuContainer,
            BackgroundColor3 = Theme.Surface,
            BackgroundTransparency = 0.5,
            Position = UDim2.new(0, 8, 0, 8),
            Size = UDim2.new(1, -16, 0, 28),
            ZIndex = 101
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = self.SearchContainer
        })
        
        local searchIcon = Utility.Create("ImageLabel", {
            Name = "SearchIcon",
            Parent = self.SearchContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 8, 0.5, 0),
            Size = UDim2.new(0, 12, 0, 12),
            AnchorPoint = Vector2.new(0, 0.5),
            Image = LucideIcons.Search,
            ImageColor3 = Theme.TextTertiary,
            ZIndex = 102
        })
        
        self.SearchInput = Utility.Create("TextBox", {
            Name = "SearchInput",
            Parent = self.SearchContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 28, 0, 0),
            Size = UDim2.new(1, -36, 1, 0),
            Font = Theme.Font,
            PlaceholderText = "Search...",
            PlaceholderColor3 = Theme.TextTertiary,
            Text = "",
            TextColor3 = Theme.TextPrimary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
            ClearTextOnFocus = false,
            ZIndex = 102
        })
        
        self.SearchInput:GetPropertyChangedSignal("Text"):Connect(function()
            self:_FilterOptions(self.SearchInput.Text)
        end)
    end
    
    -- Options Scroll Frame
    self.OptionsScroll = Utility.Create("ScrollingFrame", {
        Name = "Options",
        Parent = self.MenuContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 4, 0, self.Config.Searchable and 40 or 4),
        Size = UDim2.new(1, -8, 1, self.Config.Searchable and -44 or -8),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Theme.ScrollbarThumb,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        ZIndex = 101
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.OptionsScroll,
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 2)
    })
    
    -- Create Options
    self:_PopulateOptions()
end

function Dropdown:_PopulateOptions()
    -- Clear existing
    for _, child in ipairs(self.OptionsScroll:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    self.Options = {}
    
    -- Create options
    for i, option in ipairs(self.Config.Options) do
        local optionButton = Utility.Create("TextButton", {
            Name = "Option_" .. tostring(option),
            Parent = self.OptionsScroll,
            BackgroundColor3 = Theme.DropdownHover,
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 30),
            Text = "",
            AutoButtonColor = false,
            ZIndex = 102
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = optionButton
        })
        
        -- Option Text
        local optionText = Utility.Create("TextLabel", {
            Name = "Text",
            Parent = optionButton,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 12, 0, 0),
            Size = UDim2.new(1, -40, 1, 0),
            Font = Theme.Font,
            Text = tostring(option),
            TextColor3 = Theme.TextPrimary,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            ZIndex = 103
        })
        
        -- Check Icon (for selected)
        local checkIcon = Utility.Create("ImageLabel", {
            Name = "Check",
            Parent = optionButton,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, -28, 0.5, 0),
            Size = UDim2.new(0, 14, 0, 14),
            AnchorPoint = Vector2.new(0, 0.5),
            Image = LucideIcons.Check,
            ImageColor3 = Theme.Primary,
            ImageTransparency = self.Value == option and 0 or 1,
            ZIndex = 103
        })
        
        -- Hover Effects
        optionButton.MouseEnter:Connect(function()
            Utility.Tween(optionButton, {BackgroundTransparency = 0.5}, 0.1)
        end)
        
        optionButton.MouseLeave:Connect(function()
            Utility.Tween(optionButton, {BackgroundTransparency = 1}, 0.1)
        end)
        
        -- Click
        optionButton.MouseButton1Click:Connect(function()
            self:Select(option)
        end)
        
        self.Options[option] = {
            Button = optionButton,
            Text = optionText,
            Check = checkIcon
        }
    end
end

function Dropdown:_SetupInteractions()
    -- Hover
    self.DropdownButton.MouseEnter:Connect(function()
        if not self.Enabled then return end
        
        Utility.Tween(self.DropdownButton, {BackgroundTransparency = 0.1}, 0.15)
        Utility.Tween(self.DropdownStroke, {Transparency = 0.3}, 0.15)
        
        local mainParent = self:_GetMainParent()
        if mainParent and mainParent.Config.SoundEnabled then
            PlaySound("Hover", 0.2)
        end
    end)
    
    self.DropdownButton.MouseLeave:Connect(function()
        if not self.Enabled then return end
        
        if not self.Open then
            Utility.Tween(self.DropdownButton, {BackgroundTransparency = 0.3}, 0.15)
            Utility.Tween(self.DropdownStroke, {Transparency = 0.5}, 0.15)
        end
    end)
    
    -- Click
    self.DropdownButton.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        self:Toggle()
    end)
    
    -- Close on click outside
    local mainParent = self:_GetMainParent()
    if mainParent then
        table.insert(mainParent.Connections, UserInputService.InputBegan:Connect(function(input)
            if not self.Open then return end
            
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                
                local mousePos = input.Position
                local menuPos = self.MenuContainer.AbsolutePosition
                local menuSize = self.MenuContainer.AbsoluteSize
                local buttonPos = self.DropdownButton.AbsolutePosition
                local buttonSize = self.DropdownButton.AbsoluteSize
                
                -- Check if click is outside menu and button
                local inMenu = mousePos.X >= menuPos.X and mousePos.X <= menuPos.X + menuSize.X and
                              mousePos.Y >= menuPos.Y and mousePos.Y <= menuPos.Y + menuSize.Y
                              
                local inButton = mousePos.X >= buttonPos.X and mousePos.X <= buttonPos.X + buttonSize.X and
                                mousePos.Y >= buttonPos.Y and mousePos.Y <= buttonPos.Y + buttonSize.Y
                
                if not inMenu and not inButton then
                    self:Close()
                end
            end
        end))
    end
end

function Dropdown:Toggle()
    if self.Open then
        self:Close()
    else
        self:OpenMenu()
    end
end

function Dropdown:OpenMenu()
    self.Open = true
    
    local itemHeight = 30
    local maxItems = self.Config.MaxVisibleItems
    local menuHeight = math.min(#self.Config.Options, maxItems) * itemHeight + (self.Config.Searchable and 48 or 12)
    
    -- Show menu
    self.MenuContainer.Visible = true
    
    -- Animate
    Utility.Tween(self.MenuContainer, {Size = UDim2.new(1, -28, 0, menuHeight)}, 0.2, Enum.EasingStyle.Back)
    Utility.Tween(self.ArrowIcon, {Rotation = 180}, 0.2)
    Utility.Tween(self.DropdownStroke, {Color = Theme.Primary}, 0.2)
    
    -- Focus search if searchable
    if self.Config.Searchable and self.SearchInput then
        task.delay(0.1, function()
            self.SearchInput:CaptureFocus()
        end)
    end
    
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Config.SoundEnabled then
        PlaySound("Dropdown", 0.3)
    end
end

function Dropdown:Close()
    self.Open = false
    
    -- Animate
    Utility.Tween(self.MenuContainer, {Size = UDim2.new(1, -28, 0, 0)}, 0.15)
    Utility.Tween(self.ArrowIcon, {Rotation = 0}, 0.2)
    Utility.Tween(self.DropdownStroke, {Color = Theme.Border}, 0.2)
    Utility.Tween(self.DropdownButton, {BackgroundTransparency = 0.3}, 0.15)
    
    task.delay(0.15, function()
        if not self.Open then
            self.MenuContainer.Visible = false
        end
    end)
    
    -- Clear search
    if self.SearchInput then
        self.SearchInput.Text = ""
    end
end

function Dropdown:Select(option)
    local oldValue = self.Value
    self.Value = option
    
    -- Update selected label
    self.SelectedLabel.Text = tostring(option)
    self.SelectedLabel.TextColor3 = Theme.TextPrimary
    
    -- Update check icons
    for opt, elements in pairs(self.Options) do
        if opt == option then
            Utility.Tween(elements.Check, {ImageTransparency = 0}, 0.15)
        else
            Utility.Tween(elements.Check, {ImageTransparency = 1}, 0.15)
        end
    end
    
    -- Close dropdown
    self:Close()
    
    -- Update flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    -- Fire callback
    if oldValue ~= option then
        self.Changed:Fire(option)
        
        task.spawn(function()
            self.Config.Callback(option)
        end)
    end
    
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Config.SoundEnabled then
        PlaySound("Click", 0.5)
    end
end

function Dropdown:_FilterOptions(query)
    query = query:lower()
    
    for option, elements in pairs(self.Options) do
        local matches = query == "" or tostring(option):lower():find(query)
        elements.Button.Visible = matches
    end
end

function Dropdown:SetValue(value)
    if table.find(self.Config.Options, value) then
        self:Select(value)
    end
end

function Dropdown:GetValue()
    return self.Value
end

function Dropdown:SetOptions(options)
    self.Config.Options = options
    self:_PopulateOptions()
end

function Dropdown:AddOption(option)
    table.insert(self.Config.Options, option)
    self:_PopulateOptions()
end

function Dropdown:RemoveOption(option)
    local index = table.find(self.Config.Options, option)
    if index then
        table.remove(self.Config.Options, index)
        self:_PopulateOptions()
        
        if self.Value == option then
            self.Value = nil
            self.SelectedLabel.Text = self.Config.Placeholder
            self.SelectedLabel.TextColor3 = Theme.TextTertiary
        end
    end
end

function Dropdown:Clear()
    self.Value = nil
    self.SelectedLabel.Text = self.Config.Placeholder
    self.SelectedLabel.TextColor3 = Theme.TextTertiary
    
    for _, elements in pairs(self.Options) do
        elements.Check.ImageTransparency = 1
    end
end

function Dropdown:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function Dropdown:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function Dropdown:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        self.Container.BackgroundTransparency = 0.5
        self.TitleLabel.TextTransparency = 0
        self.DropdownButton.BackgroundTransparency = 0.3
    else
        self.Container.BackgroundTransparency = 0.7
        self.TitleLabel.TextTransparency = 0.5
        self.DropdownButton.BackgroundTransparency = 0.6
        
        if self.Open then
            self:Close()
        end
    end
end

--// Textbox/Input Element
local Textbox = setmetatable({}, {__index = Element})
Textbox.__index = Textbox

function Tab:AddTextbox(config)
    return Textbox.new(config, self.ContentFrame, self)
end

function Section:AddTextbox(config)
    return Textbox.new(config, self.ContentContainer, self)
end

function Tab:AddInput(config)
    return Textbox.new(config, self.ContentFrame, self)
end

function Section:AddInput(config)
    return Textbox.new(config, self.ContentContainer, self)
end

function Textbox.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Textbox", config, parentObject), Textbox)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Input",
        Description = config.Description or config.Desc,
        Placeholder = config.Placeholder or config.PlaceholderText or "Enter text...",
        Default = config.Default or "",
        Callback = config.Callback or function() end,
        OnChanged = config.OnChanged,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
        ClearOnFocus = config.ClearOnFocus or false,
        NumbersOnly = config.NumbersOnly or false,
        MaxLength = config.MaxLength,
        Multiline = config.Multiline or false,
        Password = config.Password or false,
        Icon = config.Icon,
        Prefix = config.Prefix,
        Suffix = config.Suffix,
    }
    
    self.Value = self.Config.Default
    self.Enabled = self.Config.Enabled
    self.Focused = false
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    return self
end

function Textbox:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local isMultiline = self.Config.Multiline
    local height = isMultiline and (hasDescription and 100 or 84) or (hasDescription and 70 or 54)
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Textbox",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, height),
        LayoutOrder = self.Config.Order
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 10),
        Size = UDim2.new(1, -28, 0, 16),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 14, 0, 26),
            Size = UDim2.new(1, -28, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Input Container
    local inputYPos = hasDescription and 44 or 30
    local inputHeight = isMultiline and (height - inputYPos - 10) or 32
    
    self.InputContainer = Utility.Create("Frame", {
        Name = "InputContainer",
        Parent = self.Container,
        BackgroundColor3 = Theme.BackgroundTertiary,
        BackgroundTransparency = 0.3,
        Position = UDim2.new(0, 14, 0, inputYPos),
        Size = UDim2.new(1, -28, 0, inputHeight)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.InputContainer
    })
    
    self.InputStroke = Utility.Create("UIStroke", {
        Parent = self.InputContainer,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Prefix (Optional)
    local inputOffset = 12
    if self.Config.Icon then
        self.IconLabel = Utility.Create("ImageLabel", {
            Name = "Icon",
            Parent = self.InputContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 10, 0.5, 0),
            Size = UDim2.new(0, 14, 0, 14),
            AnchorPoint = Vector2.new(0, 0.5),
            Image = self.Config.Icon,
            ImageColor3 = Theme.TextTertiary
        })
        inputOffset = 32
    elseif self.Config.Prefix then
        self.PrefixLabel = Utility.Create("TextLabel", {
            Name = "Prefix",
            Parent = self.InputContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 10, 0.5, 0),
            Size = UDim2.new(0, 0, 0, 16),
            AutomaticSize = Enum.AutomaticSize.X,
            AnchorPoint = Vector2.new(0, 0.5),
            Font = Theme.Font,
            Text = self.Config.Prefix,
            TextColor3 = Theme.TextTertiary,
            TextSize = 12
        })
        inputOffset = 10 + Utility.GetTextSize(self.Config.Prefix, 12, Theme.Font).X + 8
    end
    
    -- Suffix (Optional)
    local inputEndOffset = 12
    if self.Config.Suffix then
        self.SuffixLabel = Utility.Create("TextLabel", {
            Name = "Suffix",
            Parent = self.InputContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, -10, 0.5, 0),
            Size = UDim2.new(0, 0, 0, 16),
            AutomaticSize = Enum.AutomaticSize.X,
            AnchorPoint = Vector2.new(1, 0.5),
            Font = Theme.Font,
            Text = self.Config.Suffix,
            TextColor3 = Theme.TextTertiary,
            TextSize = 12
        })
        inputEndOffset = 10 + Utility.GetTextSize(self.Config.Suffix, 12, Theme.Font).X + 8
    end
    
    -- Clear Button
    self.ClearButton = Utility.Create("TextButton", {
        Name = "Clear",
        Parent = self.InputContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -(self.Config.Suffix and inputEndOffset + 20 or 28), 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "",
        Visible = false
    })
    
    local clearIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.ClearButton,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Image = LucideIcons.X,
        ImageColor3 = Theme.TextTertiary
    })
    
    self.ClearButton.MouseButton1Click:Connect(function()
        self:Clear()
    end)
    
    -- Text Input
    if isMultiline then
        self.Input = Utility.Create("TextBox", {
            Name = "Input",
            Parent = self.InputContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, inputOffset, 0, 8),
            Size = UDim2.new(1, -inputOffset - inputEndOffset, 1, -16),
            Font = Theme.Font,
            PlaceholderText = self.Config.Placeholder,
            PlaceholderColor3 = Theme.TextTertiary,
            Text = self.Config.Password and string.rep("", #self.Value) or self.Value,
            TextColor3 = Theme.TextPrimary,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top,
            ClearTextOnFocus = self.Config.ClearOnFocus,
            MultiLine = true,
            TextWrapped = true
        })
    else
        self.Input = Utility.Create("TextBox", {
            Name = "Input",
            Parent = self.InputContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, inputOffset, 0, 0),
            Size = UDim2.new(1, -inputOffset - inputEndOffset - 24, 1, 0),
            Font = Theme.Font,
            PlaceholderText = self.Config.Placeholder,
            PlaceholderColor3 = Theme.TextTertiary,
            Text = self.Config.Password and string.rep("", #self.Value) or self.Value,
            TextColor3 = Theme.TextPrimary,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            ClearTextOnFocus = self.Config.ClearOnFocus
        })
    end
    
    -- Setup Interactions
    self:_SetupInteractions()
end

function Textbox:_SetupInteractions()
    -- Focus
    self.Input.Focused:Connect(function()
        if not self.Enabled then
            self.Input:ReleaseFocus()
            return
        end
        
        self.Focused = true
        
        Utility.Tween(self.InputStroke, {Color = Theme.Primary, Transparency = 0}, 0.2)
        Utility.Tween(self.InputContainer, {BackgroundTransparency = 0.1}, 0.2)
        
        if self.IconLabel then
            Utility.Tween(self.IconLabel, {ImageColor3 = Theme.Primary}, 0.2)
        end
        
        local mainParent = self:_GetMainParent()
        if mainParent and mainParent.Config.SoundEnabled then
            PlaySound("Click", 0.3)
        end
    end)
    
    -- Focus Lost
    self.Input.FocusLost:Connect(function(enterPressed)
        self.Focused = false
        
        Utility.Tween(self.InputStroke, {Color = Theme.Border, Transparency = 0.5}, 0.2)
        Utility.Tween(self.InputContainer, {BackgroundTransparency = 0.3}, 0.2)
        
        if self.IconLabel then
            Utility.Tween(self.IconLabel, {ImageColor3 = Theme.TextTertiary}, 0.2)
        end
        
        -- Get actual value (handle password)
        local text = self.Input.Text
        if self.Config.Password then
            -- Count the number of new characters
            local oldLen = #self.Value
            local newLen = #text
            
            if newLen > oldLen then
                -- Characters added
                local addedChars = text:sub(oldLen + 1)
                self.Value = self.Value .. addedChars:gsub("", "")
            elseif newLen < oldLen then
                -- Characters removed
                self.Value = self.Value:sub(1, newLen)
            end
        else
            self.Value = text
        end
        
        -- Apply max length
        if self.Config.MaxLength and #self.Value > self.Config.MaxLength then
            self.Value = self.Value:sub(1, self.Config.MaxLength)
            self.Input.Text = self.Config.Password and string.rep("", #self.Value) or self.Value
        end
        
        -- Apply numbers only
        if self.Config.NumbersOnly then
            self.Value = self.Value:gsub("[^%d%.%-]", "")
            self.Input.Text = self.Value
        end
        
        -- Update flag
        if self.Config.Flag then
            self:_SetFlag()
        end
        
        -- Callback
        self.Changed:Fire(self.Value)
        
        if enterPressed then
            task.spawn(function()
                self.Config.Callback(self.Value)
            end)
        end
    end)
    
    -- Text Changed
    self.Input:GetPropertyChangedSignal("Text"):Connect(function()
        local text = self.Input.Text
        
        -- Show/hide clear button
        self.ClearButton.Visible = #text > 0
        
        -- Password masking
        if self.Config.Password and self.Focused then
            task.defer(function()
                local actualText = self.Input.Text
                if actualText:match("[^]") then
                    self.Input.Text = string.rep("", #actualText)
                end
            end)
        end
        
        -- OnChanged callback
        if self.Config.OnChanged then
            task.spawn(function()
                self.Config.OnChanged(text)
            end)
        end
    end)
    
    -- Hover
    self.InputContainer.MouseEnter:Connect(function()
        if not self.Enabled or self.Focused then return end
        
        Utility.Tween(self.InputContainer, {BackgroundTransparency = 0.2}, 0.15)
        Utility.Tween(self.InputStroke, {Transparency = 0.3}, 0.15)
    end)
    
    self.InputContainer.MouseLeave:Connect(function()
        if not self.Enabled or self.Focused then return end
        
        Utility.Tween(self.InputContainer, {BackgroundTransparency = 0.3}, 0.15)
        Utility.Tween(self.InputStroke, {Transparency = 0.5}, 0.15)
    end)
end

function Textbox:SetValue(value)
    self.Value = tostring(value)
    self.Input.Text = self.Config.Password and string.rep("", #self.Value) or self.Value
    
    if self.Config.Flag then
        self:_SetFlag()
    end
end

function Textbox:GetValue()
    return self.Value
end

function Textbox:Clear()
    self.Value = ""
    self.Input.Text = ""
    self.ClearButton.Visible = false
    
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    self.Changed:Fire("")
end

function Textbox:Focus()
    self.Input:CaptureFocus()
end

function Textbox:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function Textbox:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function Textbox:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        self.Container.BackgroundTransparency = 0.5
        self.TitleLabel.TextTransparency = 0
        self.Input.TextTransparency = 0
        self.InputContainer.BackgroundTransparency = 0.3
    else
        self.Container.BackgroundTransparency = 0.7
        self.TitleLabel.TextTransparency = 0.5
        self.Input.TextTransparency = 0.5
        self.InputContainer.BackgroundTransparency = 0.5
        
        if self.Focused then
            self.Input:ReleaseFocus()
        end
    end
end

function Textbox:SetPlaceholder(placeholder)
    self.Config.Placeholder = placeholder
    self.Input.PlaceholderText = placeholder
end

--// Number Input (Specialized Textbox)
local NumberInput = setmetatable({}, {__index = Textbox})
NumberInput.__index = NumberInput

function Tab:AddNumberInput(config)
    config.NumbersOnly = true
    return NumberInput.new(config, self.ContentFrame, self)
end

function Section:AddNumberInput(config)
    config.NumbersOnly = true
    return NumberInput.new(config, self.ContentContainer, self)
end

function NumberInput.new(config, parent, parentObject)
    local self = setmetatable(Textbox.new(config, parent, parentObject), NumberInput)
    
    self.Config.Min = config.Min
    self.Config.Max = config.Max
    self.Config.Increment = config.Increment or 1
    
    -- Add increment/decrement buttons
    self:_AddNumberControls()
    
    return self
end

function NumberInput:_AddNumberControls()
    -- Decrement Button
    self.DecrementButton = Utility.Create("TextButton", {
        Name = "Decrement",
        Parent = self.InputContainer,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        Position = UDim2.new(0, 4, 0.5, 0),
        Size = UDim2.new(0, 24, 0, 24),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.DecrementButton
    })
    
    Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.DecrementButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 12, 0, 12),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Minus,
        ImageColor3 = Theme.TextSecondary
    })
    
    -- Increment Button
    self.IncrementButton = Utility.Create("TextButton", {
        Name = "Increment",
        Parent = self.InputContainer,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        Position = UDim2.new(1, -28, 0.5, 0),
        Size = UDim2.new(0, 24, 0, 24),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.IncrementButton
    })
    
    Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.IncrementButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 12, 0, 12),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Plus,
        ImageColor3 = Theme.TextSecondary
    })
    
    -- Adjust input position
    self.Input.Position = UDim2.new(0, 36, 0, 0)
    self.Input.Size = UDim2.new(1, -72, 1, 0)
    self.Input.TextXAlignment = Enum.TextXAlignment.Center
    
    -- Interactions
    self.DecrementButton.MouseButton1Click:Connect(function()
        self:Decrement()
    end)
    
    self.IncrementButton.MouseButton1Click:Connect(function()
        self:Increment()
    end)
    
    -- Hover effects
    for _, btn in ipairs({self.DecrementButton, self.IncrementButton}) do
        btn.MouseEnter:Connect(function()
            Utility.Tween(btn, {BackgroundTransparency = 0.3}, 0.1)
        end)
        
        btn.MouseLeave:Connect(function()
            Utility.Tween(btn, {BackgroundTransparency = 0.5}, 0.1)
        end)
    end
end

function NumberInput:Increment()
    local currentValue = tonumber(self.Value) or 0
    local newValue = currentValue + self.Config.Increment
    
    if self.Config.Max then
        newValue = math.min(newValue, self.Config.Max)
    end
    
    self:SetValue(newValue)
    self.Changed:Fire(newValue)
    
    task.spawn(function()
        self.Config.Callback(newValue)
    end)
end

function NumberInput:Decrement()
    local currentValue = tonumber(self.Value) or 0
    local newValue = currentValue - self.Config.Increment
    
    if self.Config.Min then
        newValue = math.max(newValue, self.Config.Min)
    end
    
    self:SetValue(newValue)
    self.Changed:Fire(newValue)
    
    task.spawn(function()
        self.Config.Callback(newValue)
    end)
end

--// Textarea (Multi-line Textbox)
function Tab:AddTextarea(config)
    config.Multiline = true
    return Textbox.new(config, self.ContentFrame, self)
end

function Section:AddTextarea(config)
    config.Multiline = true
    return Textbox.new(config, self.ContentContainer, self)
end

--[[
    FlexUI - Part 6
    Special Elements: ColorPicker, Keybind, MultiDropdown, List
    Advanced Interactive Components
]]

--// ColorPicker Element
local ColorPicker = setmetatable({}, {__index = Element})
ColorPicker.__index = ColorPicker

function Tab:AddColorPicker(config)
    return ColorPicker.new(config, self.ContentFrame, self)
end

function Section:AddColorPicker(config)
    return ColorPicker.new(config, self.ContentContainer, self)
end

function ColorPicker.new(config, parent, parentObject)
    local self = setmetatable(Element.new("ColorPicker", config, parentObject), ColorPicker)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Color Picker",
        Description = config.Description or config.Desc,
        Default = config.Default or Color3.fromRGB(255, 0, 0),
        Callback = config.Callback or function() end,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
        ShowAlpha = config.ShowAlpha or false,
        ShowRGB = config.ShowRGB ~= false,
        ShowHEX = config.ShowHEX ~= false,
    }
    
    self.Value = self.Config.Default
    self.Hue = 0
    self.Saturation = 1
    self.Value_HSV = 1
    self.Alpha = config.Alpha or 1
    self.Enabled = self.Config.Enabled
    self.PickerOpen = false
    
    -- Convert default color to HSV
    local h, s, v = Color3.toHSV(self.Config.Default)
    self.Hue = h
    self.Saturation = s
    self.Value_HSV = v
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    return self
end

function ColorPicker:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local height = hasDescription and 70 or 54
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "ColorPicker",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, height),
        ClipsDescendants = false,
        LayoutOrder = self.Config.Order,
        ZIndex = 10
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 10),
        Size = UDim2.new(1, -80, 0, 16),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 14, 0, 26),
            Size = UDim2.new(1, -80, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Color Display Button
    local buttonYPos = hasDescription and 44 or 30
    
    self.ColorButton = Utility.Create("TextButton", {
        Name = "ColorButton",
        Parent = self.Container,
        BackgroundColor3 = self.Value,
        Position = UDim2.new(1, -58, 0, buttonYPos),
        Size = UDim2.new(0, 44, 0, 32),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.ColorButton
    })
    
    Utility.Create("UIStroke", {
        Parent = self.ColorButton,
        Color = Theme.Border,
        Thickness = 2,
        Transparency = 0.3
    })
    
    -- Rainbow Gradient Overlay
    local rainbowGradient = Utility.Create("Frame", {
        Name = "RainbowOverlay",
        Parent = self.ColorButton,
        BackgroundTransparency = 0.9,
        Size = UDim2.new(1, 0, 1, 0)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = rainbowGradient
    })
    
    Utility.Create("UIGradient", {
        Parent = rainbowGradient,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 255, 0)),
            ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
            ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 0, 255)),
            ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 0, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
        }),
        Rotation = 45
    })
    
    -- Eyedropper Icon
    local eyedropperIcon = Utility.Create("ImageLabel", {
        Name = "Eyedropper",
        Parent = self.ColorButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = LucideIcons.Pipette,
        ImageColor3 = ColorUtility.Invert(self.Value),
        ImageTransparency = 0.3
    })
    
    -- Create Color Picker Panel
    self:_CreateColorPickerPanel()
    
    -- Setup Interactions
    self:_SetupInteractions()
end

function ColorPicker:_CreateColorPickerPanel()
    -- Picker Panel Container
    self.PickerPanel = Utility.Create("Frame", {
        Name = "PickerPanel",
        Parent = self.Container,
        BackgroundColor3 = Theme.Background,
        Position = UDim2.new(0, 14, 1, 8),
        Size = UDim2.new(0, 280, 0, 0),
        ClipsDescendants = true,
        Visible = false,
        ZIndex = 100
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.PickerPanel
    })
    
    Utility.Create("UIStroke", {
        Parent = self.PickerPanel,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Shadow
    Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = self.PickerPanel,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 4),
        Size = UDim2.new(1, 20, 1, 20),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 99,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.4,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    Utility.Create("UIPadding", {
        Parent = self.PickerPanel,
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    -- Saturation/Value Picker
    self.SVPicker = Utility.Create("Frame", {
        Name = "SVPicker",
        Parent = self.PickerPanel,
        BackgroundColor3 = Color3.fromHSV(self.Hue, 1, 1),
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, -40, 0, 180),
        ZIndex = 101
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.SVPicker
    })
    
    -- White to Transparent Gradient (Saturation)
    local saturationGradient = Utility.Create("Frame", {
        Name = "Saturation",
        Parent = self.SVPicker,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 102
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = saturationGradient
    })
    
    Utility.Create("UIGradient", {
        Parent = saturationGradient,
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0),
            NumberSequenceKeypoint.new(1, 1)
        }),
        Rotation = 0
    })
    
    -- Black Gradient (Value)
    local valueGradient = Utility.Create("Frame", {
        Name = "Value",
        Parent = self.SVPicker,
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 103
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = valueGradient
    })
    
    Utility.Create("UIGradient", {
        Parent = valueGradient,
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 1),
            NumberSequenceKeypoint.new(1, 0)
        }),
        Rotation = 90
    })
    
    -- SV Picker Cursor
    self.SVCursor = Utility.Create("Frame", {
        Name = "Cursor",
        Parent = self.SVPicker,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        Position = UDim2.new(self.Saturation, 0, 1 - self.Value_HSV, 0),
        Size = UDim2.new(0, 12, 0, 12),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 105
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.SVCursor
    })
    
    Utility.Create("UIStroke", {
        Parent = self.SVCursor,
        Color = Color3.fromRGB(0, 0, 0),
        Thickness = 2,
        Transparency = 0.3
    })
    
    -- Hue Slider
    self.HueSlider = Utility.Create("Frame", {
        Name = "HueSlider",
        Parent = self.PickerPanel,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        Position = UDim2.new(1, -32, 0, 0),
        Size = UDim2.new(0, 24, 0, 180),
        ZIndex = 101
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.HueSlider
    })
    
    Utility.Create("UIGradient", {
        Parent = self.HueSlider,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 255, 0)),
            ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
            ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 0, 255)),
            ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 0, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
        }),
        Rotation = 90
    })
    
    -- Hue Cursor
    self.HueCursor = Utility.Create("Frame", {
        Name = "Cursor",
        Parent = self.HueSlider,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        Position = UDim2.new(0.5, 0, self.Hue, 0),
        Size = UDim2.new(1, 4, 0, 4),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 105
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = self.HueCursor
    })
    
    Utility.Create("UIStroke", {
        Parent = self.HueCursor,
        Color = Color3.fromRGB(0, 0, 0),
        Thickness = 2,
        Transparency = 0.3
    })
    
    -- Alpha Slider (if enabled)
    local inputYPos = 192
    if self.Config.ShowAlpha then
        inputYPos = 222
        
        self.AlphaSlider = Utility.Create("Frame", {
            Name = "AlphaSlider",
            Parent = self.PickerPanel,
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            Position = UDim2.new(0, 0, 0, 192),
            Size = UDim2.new(1, 0, 0, 20),
            ZIndex = 101
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = self.AlphaSlider
        })
        
        -- Checkerboard pattern for transparency
        local checkerboard = Utility.Create("ImageLabel", {
            Name = "Checkerboard",
            Parent = self.AlphaSlider,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Image = "rbxassetid://14192071065",
            ImageColor3 = Color3.fromRGB(200, 200, 200),
            ScaleType = Enum.ScaleType.Tile,
            TileSize = UDim2.new(0, 10, 0, 10),
            ZIndex = 102
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = checkerboard
        })
        
        -- Alpha gradient
        local alphaGradient = Utility.Create("Frame", {
            Name = "Gradient",
            Parent = self.AlphaSlider,
            BackgroundColor3 = self.Value,
            Size = UDim2.new(1, 0, 1, 0),
            ZIndex = 103
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = alphaGradient
        })
        
        Utility.Create("UIGradient", {
            Parent = alphaGradient,
            Transparency = NumberSequence.new({
                NumberSequenceKeypoint.new(0, 1),
                NumberSequenceKeypoint.new(1, 0)
            }),
            Rotation = 0
        })
        
        -- Alpha Cursor
        self.AlphaCursor = Utility.Create("Frame", {
            Name = "Cursor",
            Parent = self.AlphaSlider,
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            Position = UDim2.new(self.Alpha, 0, 0.5, 0),
            Size = UDim2.new(0, 4, 1, 4),
            AnchorPoint = Vector2.new(0.5, 0.5),
            ZIndex = 105
        })
        
        Utility.Create("UICorner", {
            CornerRadius = UDim.new(0, 2),
            Parent = self.AlphaCursor
        })
        
        Utility.Create("UIStroke", {
            Parent = self.AlphaCursor,
            Color = Color3.fromRGB(0, 0, 0),
            Thickness = 2,
            Transparency = 0.3
        })
    end
    
    -- Color Input Fields
    self.InputContainer = Utility.Create("Frame", {
        Name = "Inputs",
        Parent = self.PickerPanel,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, inputYPos),
        Size = UDim2.new(1, 0, 0, 70)
    })
    
    -- RGB Inputs
    if self.Config.ShowRGB then
        local rgbContainer = Utility.Create("Frame", {
            Name = "RGB",
            Parent = self.InputContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 28)
        })
        
        local rgb = {
            {Name = "R", Value = math.floor(self.Value.R * 255)},
            {Name = "G", Value = math.floor(self.Value.G * 255)},
            {Name = "B", Value = math.floor(self.Value.B * 255)}
        }
        
        self.RGBInputs = {}
        
        for i, channel in ipairs(rgb) do
            local input = self:_CreateChannelInput(rgbContainer, channel.Name, channel.Value, i)
            self.RGBInputs[channel.Name] = input
        end
    end
    
    -- HEX Input
    if self.Config.ShowHEX then
        local hexYPos = self.Config.ShowRGB and 36 or 0
        
        local hexContainer = Utility.Create("Frame", {
            Name = "HEX",
            Parent = self.InputContainer,
            BackgroundColor3 = Theme.Surface,
            BackgroundTransparency = 0.5,
            Position = UDim2.new(0, 0, 0, hexYPos),
            Size = UDim2.new(1, 0, 0, 28)
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = hexContainer
        })
        
        local hexLabel = Utility.Create("TextLabel", {
            Name = "Label",
            Parent = hexContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 8, 0.5, 0),
            Size = UDim2.new(0, 30, 0, 16),
            AnchorPoint = Vector2.new(0, 0.5),
            Font = Theme.Font,
            Text = "HEX",
            TextColor3 = Theme.TextSecondary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        self.HEXInput = Utility.Create("TextBox", {
            Name = "Input",
            Parent = hexContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 42, 0, 0),
            Size = UDim2.new(1, -50, 1, 0),
            Font = Theme.Font,
            PlaceholderText = "#FFFFFF",
            Text = Utility.RGBToHex(self.Value),
            TextColor3 = Theme.TextPrimary,
            TextSize = 11,
            ClearTextOnFocus = false
        })
        
        self.HEXInput.FocusLost:Connect(function()
            local hex = self.HEXInput.Text
            if hex:match("^#?%x%x%x%x%x%x$") then
                local color = Utility.HexToRGB(hex)
                self:SetColor(color)
            else
                self.HEXInput.Text = Utility.RGBToHex(self.Value)
            end
        end)
    end
    
    -- Preset Colors
    self:_CreatePresets()
    
    -- Setup Picker Interactions
    self:_SetupPickerInteractions()
end

function ColorPicker:_CreateChannelInput(parent, name, value, index)
    local width = 1 / 3
    local xPos = (index - 1) * width
    
    local container = Utility.Create("Frame", {
        Name = name .. "Container",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        Position = UDim2.new(xPos, (index - 1) * 4, 0, 0),
        Size = UDim2.new(width, -4, 1, 0)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = container
    })
    
    local label = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 6, 0.5, 0),
        Size = UDim2.new(0, 12, 0, 14),
        AnchorPoint = Vector2.new(0, 0.5),
        Font = Theme.Font,
        Text = name,
        TextColor3 = Theme.TextSecondary,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local input = Utility.Create("TextBox", {
        Name = "Input",
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 22, 0, 0),
        Size = UDim2.new(1, -28, 1, 0),
        Font = Theme.Font,
        Text = tostring(value),
        TextColor3 = Theme.TextPrimary,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false
    })
    
    input.FocusLost:Connect(function()
        local num = tonumber(input.Text)
        if num then
            num = math.clamp(num, 0, 255)
            input.Text = tostring(math.floor(num))
            
            local r = tonumber(self.RGBInputs.R.Text) or 0
            local g = tonumber(self.RGBInputs.G.Text) or 0
            local b = tonumber(self.RGBInputs.B.Text) or 0
            
            self:SetColor(Color3.fromRGB(r, g, b))
        else
            input.Text = tostring(value)
        end
    end)
    
    return input
end

function ColorPicker:_CreatePresets()
    local presets = {
        Color3.fromRGB(255, 0, 0),
        Color3.fromRGB(255, 127, 0),
        Color3.fromRGB(255, 255, 0),
        Color3.fromRGB(0, 255, 0),
        Color3.fromRGB(0, 255, 255),
        Color3.fromRGB(0, 0, 255),
        Color3.fromRGB(127, 0, 255),
        Color3.fromRGB(255, 0, 255),
        Color3.fromRGB(255, 255, 255),
        Color3.fromRGB(128, 128, 128),
        Color3.fromRGB(0, 0, 0),
    }
    
    local presetsYPos = self.Config.ShowRGB and (self.Config.ShowHEX and 276 or 232) or (self.Config.ShowHEX and 232 or 192)
    
    local presetsContainer = Utility.Create("Frame", {
        Name = "Presets",
        Parent = self.PickerPanel,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, presetsYPos),
        Size = UDim2.new(1, 0, 0, 28)
    })
    
    Utility.Create("UIListLayout", {
        Parent = presetsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        Padding = UDim.new(0, 4)
    })
    
    for _, color in ipairs(presets) do
        local preset = Utility.Create("TextButton", {
            Name = "Preset",
            Parent = presetsContainer,
            BackgroundColor3 = color,
            Size = UDim2.new(0, 22, 0, 22),
            Text = "",
            AutoButtonColor = false
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = preset
        })
        
        Utility.Create("UIStroke", {
            Parent = preset,
            Color = Theme.Border,
            Thickness = 1,
            Transparency = 0.5
        })
        
        preset.MouseButton1Click:Connect(function()
            self:SetColor(color)
        end)
        
        preset.MouseEnter:Connect(function()
            Utility.Tween(preset, {Size = UDim2.new(0, 26, 0, 26)}, 0.1)
        end)
        
        preset.MouseLeave:Connect(function()
            Utility.Tween(preset, {Size = UDim2.new(0, 22, 0, 22)}, 0.1)
        end)
    end
    
    -- Update panel size
    local totalHeight = presetsYPos + 40
    self.PickerPanel.Size = UDim2.new(0, 280, 0, totalHeight)
end

function ColorPicker:_SetupPickerInteractions()
    local svDragging = false
    local hueDragging = false
    local alphaDragging = false
    
    -- SV Picker
    self.SVPicker.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.Touch then
            svDragging = true
            self:_UpdateSVFromInput(input.Position)
        end
    end)
    
    -- Hue Slider
    self.HueSlider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.Touch then
            hueDragging = true
            self:_UpdateHueFromInput(input.Position)
        end
    end)
    
    -- Alpha Slider
    if self.AlphaSlider then
        self.AlphaSlider.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                alphaDragging = true
                self:_UpdateAlphaFromInput(input.Position)
            end
        end)
    end
    
    -- Global Input Changed
    local mainParent = self:_GetMainParent()
    if mainParent then
        table.insert(mainParent.Connections, UserInputService.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement or
               input.UserInputType == Enum.UserInputType.Touch then
                if svDragging then
                    self:_UpdateSVFromInput(input.Position)
                elseif hueDragging then
                    self:_UpdateHueFromInput(input.Position)
                elseif alphaDragging then
                    self:_UpdateAlphaFromInput(input.Position)
                end
            end
        end))
        
        table.insert(mainParent.Connections, UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                svDragging = false
                hueDragging = false
                alphaDragging = false
            end
        end))
    end
end

function ColorPicker:_UpdateSVFromInput(position)
    local posX = position.X - self.SVPicker.AbsolutePosition.X
    local posY = position.Y - self.SVPicker.AbsolutePosition.Y
    
    local saturation = math.clamp(posX / self.SVPicker.AbsoluteSize.X, 0, 1)
    local value = 1 - math.clamp(posY / self.SVPicker.AbsoluteSize.Y, 0, 1)
    
    self.Saturation = saturation
    self.Value_HSV = value
    
    -- Update cursor
    self.SVCursor.Position = UDim2.new(saturation, 0, 1 - value, 0)
    
    -- Update color
    local color = Color3.fromHSV(self.Hue, saturation, value)
    self:_UpdateColor(color)
end

function ColorPicker:_UpdateHueFromInput(position)
    local posY = position.Y - self.HueSlider.AbsolutePosition.Y
    local hue = math.clamp(posY / self.HueSlider.AbsoluteSize.Y, 0, 1)
    
    self.Hue = hue
    
    -- Update cursor
    self.HueCursor.Position = UDim2.new(0.5, 0, hue, 0)
    
    -- Update SV picker background
    self.SVPicker.BackgroundColor3 = Color3.fromHSV(hue, 1, 1)
    
    -- Update color
    local color = Color3.fromHSV(hue, self.Saturation, self.Value_HSV)
    self:_UpdateColor(color)
end

function ColorPicker:_UpdateAlphaFromInput(position)
    local posX = position.X - self.AlphaSlider.AbsolutePosition.X
    local alpha = math.clamp(posX / self.AlphaSlider.AbsoluteSize.X, 0, 1)
    
    self.Alpha = alpha
    
    -- Update cursor
    self.AlphaCursor.Position = UDim2.new(alpha, 0, 0.5, 0)
end

function ColorPicker:_UpdateColor(color)
    self.Value = color
    
    -- Update color button
    self.ColorButton.BackgroundColor3 = color
    
    -- Update RGB inputs
    if self.RGBInputs then
        self.RGBInputs.R.Text = tostring(math.floor(color.R * 255))
        self.RGBInputs.G.Text = tostring(math.floor(color.G * 255))
        self.RGBInputs.B.Text = tostring(math.floor(color.B * 255))
    end
    
    -- Update HEX input
    if self.HEXInput then
        self.HEXInput.Text = Utility.RGBToHex(color)
    end
    
    -- Update alpha gradient
    if self.AlphaSlider then
        self.AlphaSlider:FindFirstChild("Gradient").BackgroundColor3 = color
    end
    
    -- Update flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    -- Fire callback
    self.Changed:Fire(color)
    
    task.spawn(function()
        self.Config.Callback(color)
    end)
end

function ColorPicker:_SetupInteractions()
    -- Color button click
    self.ColorButton.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        self:TogglePicker()
    end)
    
    -- Hover
    self.ColorButton.MouseEnter:Connect(function()
        if not self.Enabled then return end
        Utility.Tween(self.ColorButton, {Size = UDim2.new(0, 48, 0, 36)}, 0.15)
    end)
    
    self.ColorButton.MouseLeave:Connect(function()
        if not self.Enabled then return end
        Utility.Tween(self.ColorButton, {Size = UDim2.new(0, 44, 0, 32)}, 0.15)
    end)
    
    -- Close on click outside
    local mainParent = self:_GetMainParent()
    if mainParent then
        table.insert(mainParent.Connections, UserInputService.InputBegan:Connect(function(input)
            if not self.PickerOpen then return end
            
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                
                local mousePos = input.Position
                local panelPos = self.PickerPanel.AbsolutePosition
                local panelSize = self.PickerPanel.AbsoluteSize
                local buttonPos = self.ColorButton.AbsolutePosition
                local buttonSize = self.ColorButton.AbsoluteSize
                
                local inPanel = mousePos.X >= panelPos.X and mousePos.X <= panelPos.X + panelSize.X and
                               mousePos.Y >= panelPos.Y and mousePos.Y <= panelPos.Y + panelSize.Y
                               
                local inButton = mousePos.X >= buttonPos.X and mousePos.X <= buttonPos.X + buttonSize.X and
                                mousePos.Y >= buttonPos.Y and mousePos.Y <= buttonPos.Y + buttonSize.Y
                
                if not inPanel and not inButton then
                    self:ClosePicker()
                end
            end
        end))
    end
end

function ColorPicker:TogglePicker()
    if self.PickerOpen then
        self:ClosePicker()
    else
        self:OpenPicker()
    end
end

function ColorPicker:OpenPicker()
    self.PickerOpen = true
    self.PickerPanel.Visible = true
    
    local targetHeight = self.PickerPanel.Size.Y.Offset
    self.PickerPanel.Size = UDim2.new(0, 280, 0, 0)
    
    Utility.Tween(self.PickerPanel, {Size = UDim2.new(0, 280, 0, targetHeight)}, 0.3, Enum.EasingStyle.Back)
end

function ColorPicker:ClosePicker()
    self.PickerOpen = false
    
    Utility.Tween(self.PickerPanel, {Size = UDim2.new(0, 280, 0, 0)}, 0.2)
    
    task.delay(0.2, function()
        if not self.PickerOpen then
            self.PickerPanel.Visible = false
        end
    end)
end

function ColorPicker:SetColor(color)
    self.Value = color
    
    local h, s, v = Color3.toHSV(color)
    self.Hue = h
    self.Saturation = s
    self.Value_HSV = v
    
    -- Update visuals
    self.ColorButton.BackgroundColor3 = color
    self.SVPicker.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
    self.SVCursor.Position = UDim2.new(s, 0, 1 - v, 0)
    self.HueCursor.Position = UDim2.new(0.5, 0, h, 0)
    
    -- Update inputs
    if self.RGBInputs then
        self.RGBInputs.R.Text = tostring(math.floor(color.R * 255))
        self.RGBInputs.G.Text = tostring(math.floor(color.G * 255))
        self.RGBInputs.B.Text = tostring(math.floor(color.B * 255))
    end
    
    if self.HEXInput then
        self.HEXInput.Text = Utility.RGBToHex(color)
    end
    
    -- Update flag
    if self.Config.Flag then
        self:_SetFlag()
    end
end

function ColorPicker:GetColor()
    return self.Value
end

function ColorPicker:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function ColorPicker:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function ColorPicker:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        self.Container.BackgroundTransparency = 0.5
        self.TitleLabel.TextTransparency = 0
        self.ColorButton.BackgroundTransparency = 0
    else
        self.Container.BackgroundTransparency = 0.7
        self.TitleLabel.TextTransparency = 0.5
        self.ColorButton.BackgroundTransparency = 0.3
        
        if self.PickerOpen then
            self:ClosePicker()
        end
    end
end

--// Keybind Element
local Keybind = setmetatable({}, {__index = Element})
Keybind.__index = Keybind

function Tab:AddKeybind(config)
    return Keybind.new(config, self.ContentFrame, self)
end

function Section:AddKeybind(config)
    return Keybind.new(config, self.ContentContainer, self)
end

function Keybind.new(config, parent, parentObject)
    local self = setmetatable(Element.new("Keybind", config, parentObject), Keybind)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Keybind",
        Description = config.Description or config.Desc,
        Default = config.Default or Enum.KeyCode.E,
        Callback = config.Callback or function() end,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
        Mode = config.Mode or "Toggle", -- Toggle, Hold, Always
        AllowMouse = config.AllowMouse or false,
    }
    
    self.Value = self.Config.Default
    self.Enabled = self.Config.Enabled
    self.Listening = false
    self.Active = false
    self.Pressing = false
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    -- Setup global listener
    self:_SetupGlobalListener()
    
    return self
end

function Keybind:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local height = hasDescription and 70 or 54
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "Keybind",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, height),
        LayoutOrder = self.Config.Order
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 10),
        Size = UDim2.new(1, -110, 0, 16),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 14, 0, 26),
            Size = UDim2.new(1, -110, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Keybind Button
    local buttonYPos = hasDescription and 44 or 30
    
    self.KeybindButton = Utility.Create("TextButton", {
        Name = "KeybindButton",
        Parent = self.Container,
        BackgroundColor3 = Theme.BackgroundTertiary,
        BackgroundTransparency = 0.3,
        Position = UDim2.new(1, -92, 0, buttonYPos),
        Size = UDim2.new(0, 78, 0, 32),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.KeybindButton
    })
    
    self.KeybindStroke = Utility.Create("UIStroke", {
        Parent = self.KeybindButton,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Key Icon
    self.KeyIcon = Utility.Create("ImageLabel", {
        Name = "KeyIcon",
        Parent = self.KeybindButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0.5, 0),
        Size = UDim2.new(0, 14, 0, 14),
        AnchorPoint = Vector2.new(0, 0.5),
        Image = LucideIcons.Keyboard,
        ImageColor3 = Theme.TextSecondary
    })
    
    -- Key Text
    self.KeyText = Utility.Create("TextLabel", {
        Name = "KeyText",
        Parent = self.KeybindButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 26, 0, 0),
        Size = UDim2.new(1, -30, 1, 0),
        Font = Theme.Font,
        Text = self:_GetKeyName(self.Value),
        TextColor3 = Theme.TextPrimary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Mode Indicator
    self.ModeIndicator = Utility.Create("Frame", {
        Name = "ModeIndicator",
        Parent = self.KeybindButton,
        BackgroundColor3 = Theme.Primary,
        Position = UDim2.new(1, -4, 0.5, 0),
        Size = UDim2.new(0, 4, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5),
        Visible = self.Active
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(0, 2),
        Parent = self.ModeIndicator
    })
    
    -- Setup Interactions
    self:_SetupInteractions()
end

function Keybind:_SetupInteractions()
    -- Click to listen
    self.KeybindButton.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        self:StartListening()
    end)
    
    -- Hover
    self.KeybindButton.MouseEnter:Connect(function()
        if not self.Enabled then return end
        
        Utility.Tween(self.KeybindButton, {BackgroundTransparency = 0.1}, 0.15)
        Utility.Tween(self.KeybindStroke, {Transparency = 0.3}, 0.15)
        Utility.Tween(self.KeyIcon, {ImageColor3 = Theme.Primary}, 0.15)
    end)
    
    self.KeybindButton.MouseLeave:Connect(function()
        if not self.Enabled then return end
        
        if not self.Listening then
            Utility.Tween(self.KeybindButton, {BackgroundTransparency = 0.3}, 0.15)
            Utility.Tween(self.KeybindStroke, {Transparency = 0.5}, 0.15)
            Utility.Tween(self.KeyIcon, {ImageColor3 = Theme.TextSecondary}, 0.15)
        end
    end)
end

function Keybind:_SetupGlobalListener()
    local mainParent = self:_GetMainParent()
    if not mainParent then return end
    
    -- Key listener
    table.insert(mainParent.Connections, UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if self.Listening then
            -- Capture new key
            if input.UserInputType == Enum.UserInputType.Keyboard or
               (self.Config.AllowMouse and input.UserInputType == Enum.UserInputType.MouseButton1) then
                
                local key = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType
                self:SetKey(key)
                self:StopListening()
            end
        elseif not gameProcessed then
            -- Check if this keybind is triggered
            local inputKey = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType
            
            if inputKey == self.Value then
                if self.Config.Mode == "Toggle" then
                    self:Toggle()
                elseif self.Config.Mode == "Hold" then
                    self.Pressing = true
                    self:Activate()
                elseif self.Config.Mode == "Always" then
                    self:Activate()
                end
            end
        end
    end))
    
    -- Key release (for Hold mode)
    table.insert(mainParent.Connections, UserInputService.InputEnded:Connect(function(input)
        if self.Config.Mode == "Hold" and self.Pressing then
            local inputKey = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType
            
            if inputKey == self.Value then
                self.Pressing = false
                self:Deactivate()
            end
        end
    end))
end

function Keybind:StartListening()
    self.Listening = true
    
    -- Update UI
    self.KeyText.Text = "..."
    Utility.Tween(self.KeybindStroke, {Color = Theme.Primary, Transparency = 0}, 0.2)
    Utility.Tween(self.KeyIcon, {ImageColor3 = Theme.Primary}, 0.2)
    
    -- Animate button
    local originalSize = self.KeybindButton.Size
    Utility.Tween(self.KeybindButton, {Size = UDim2.new(0, 82, 0, 36)}, 0.1)
    
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Config.SoundEnabled then
        PlaySound("Click", 0.3)
    end
end

function Keybind:StopListening()
    self.Listening = false
    
    -- Update UI
    self.KeyText.Text = self:_GetKeyName(self.Value)
    Utility.Tween(self.KeybindStroke, {Color = Theme.Border, Transparency = 0.5}, 0.2)
    Utility.Tween(self.KeyIcon, {ImageColor3 = Theme.TextSecondary}, 0.2)
    Utility.Tween(self.KeybindButton, {Size = UDim2.new(0, 78, 0, 32)}, 0.1)
end

function Keybind:Toggle()
    self.Active = not self.Active
    
    if self.Active then
        self:Activate()
    else
        self:Deactivate()
    end
end

function Keybind:Activate()
    self.Active = true
    
    -- Show indicator
    self.ModeIndicator.Visible = true
    Utility.Tween(self.ModeIndicator, {BackgroundColor3 = Theme.Success}, 0.2)
    
    -- Callback
    self.Changed:Fire(true)
    
    task.spawn(function()
        self.Config.Callback(true)
    end)
end

function Keybind:Deactivate()
    self.Active = false
    
    -- Hide indicator
    Utility.Tween(self.ModeIndicator, {BackgroundColor3 = Theme.Error}, 0.2)
    
    task.delay(0.2, function()
        if not self.Active then
            self.ModeIndicator.Visible = false
        end
    end)
    
    -- Callback
    self.Changed:Fire(false)
    
    task.spawn(function()
        self.Config.Callback(false)
    end)
end

function Keybind:SetKey(key)
    self.Value = key
    self.KeyText.Text = self:_GetKeyName(key)
    
    -- Update flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Config.SoundEnabled then
        PlaySound("Success", 0.5)
    end
end

function Keybind:GetKey()
    return self.Value
end

function Keybind:_GetKeyName(key)
    if not key then return "None" end
    
    local name = tostring(key):gsub("Enum.KeyCode.", ""):gsub("Enum.UserInputType.", "")
    
    -- Special names
    local specialNames = {
        MouseButton1 = "MB1",
        MouseButton2 = "MB2",
        MouseButton3 = "MB3",
        LeftShift = "LShift",
        RightShift = "RShift",
        LeftControl = "LCtrl",
        RightControl = "RCtrl",
        LeftAlt = "LAlt",
        RightAlt = "RAlt",
    }
    
    return specialNames[name] or name
end

function Keybind:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function Keybind:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function Keybind:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        self.Container.BackgroundTransparency = 0.5
        self.TitleLabel.TextTransparency = 0
        self.KeybindButton.BackgroundTransparency = 0.3
    else
        self.Container.BackgroundTransparency = 0.7
        self.TitleLabel.TextTransparency = 0.5
        self.KeybindButton.BackgroundTransparency = 0.5
        
        if self.Listening then
            self:StopListening()
        end
        
        if self.Active then
            self:Deactivate()
        end
    end
end

--// MultiDropdown Element
local MultiDropdown = setmetatable({}, {__index = Element})
MultiDropdown.__index = MultiDropdown

function Tab:AddMultiDropdown(config)
    return MultiDropdown.new(config, self.ContentFrame, self)
end

function Section:AddMultiDropdown(config)
    return MultiDropdown.new(config, self.ContentContainer, self)
end

function MultiDropdown.new(config, parent, parentObject)
    local self = setmetatable(Element.new("MultiDropdown", config, parentObject), MultiDropdown)
    
    -- Configuration
    self.Config = {
        Name = config.Name or config.Title or "Multi Select",
        Description = config.Description or config.Desc,
        Options = config.Options or config.Items or {},
        Default = config.Default or {},
        Placeholder = config.Placeholder or "Select options...",
        Callback = config.Callback or function() end,
        Flag = config.Flag,
        Enabled = config.Enabled ~= false,
        Order = config.Order or 0,
        Searchable = config.Searchable or false,
        MaxVisibleItems = config.MaxVisibleItems or 6,
        AllowEmpty = config.AllowEmpty ~= false,
        MaxSelections = config.MaxSelections,
    }
    
    self.Value = config.Default or {}
    self.Enabled = self.Config.Enabled
    self.Open = false
    self.Options = {}
    
    self:_Create(parent)
    
    -- Set flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    return self
end

function MultiDropdown:_Create(parent)
    local hasDescription = self.Config.Description ~= nil
    local height = hasDescription and 70 or 54
    
    -- Container
    self.Container = Utility.Create("Frame", {
        Name = self.Config.Name .. "MultiDropdown",
        Parent = parent,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, height),
        ClipsDescendants = false,
        LayoutOrder = self.Config.Order,
        ZIndex = 10
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.Container
    })
    
    -- Title
    self.TitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.Container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 10),
        Size = UDim2.new(1, -28, 0, 16),
        Font = Theme.Font,
        Text = self.Config.Name,
        TextColor3 = Theme.TextPrimary,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Description
    if hasDescription then
        self.DescriptionLabel = Utility.Create("TextLabel", {
            Name = "Description",
            Parent = self.Container,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 14, 0, 26),
            Size = UDim2.new(1, -28, 0, 14),
            Font = Theme.FontLight,
            Text = self.Config.Description,
            TextColor3 = Theme.TextTertiary,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Dropdown Button
    local buttonYPos = hasDescription and 44 or 30
    
    self.DropdownButton = Utility.Create("TextButton", {
        Name = "DropdownButton",
        Parent = self.Container,
        BackgroundColor3 = Theme.BackgroundTertiary,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 14, 0, buttonYPos),
        Size = UDim2.new(1, -28, 0, 32),
        Text = "",
        AutoButtonColor = false
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = self.DropdownButton
    })
    
    self.DropdownStroke = Utility.Create("UIStroke", {
        Parent = self.DropdownButton,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Selected Count Badge
    self.CountBadge = Utility.Create("Frame", {
        Name = "CountBadge",
        Parent = self.DropdownButton,
        BackgroundColor3 = Theme.Primary,
        Position = UDim2.new(0, 8, 0.5, 0),
        Size = UDim2.new(0, 20, 0, 18),
        AnchorPoint = Vector2.new(0, 0.5),
        Visible = #self.Value > 0
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = self.CountBadge
    })
    
    self.CountLabel = Utility.Create("TextLabel", {
        Name = "Count",
        Parent = self.CountBadge,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Theme.FontBold,
        Text = tostring(#self.Value),
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 10
    })
    
    -- Selected Text
    self.SelectedLabel = Utility.Create("TextLabel", {
        Name = "Selected",
        Parent = self.DropdownButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, #self.Value > 0 and 36 or 12, 0, 0),
        Size = UDim2.new(1, -(#self.Value > 0 and 80 or 56), 1, 0),
        Font = Theme.Font,
        Text = self:_GetSelectedText(),
        TextColor3 = #self.Value > 0 and Theme.TextPrimary or Theme.TextTertiary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Clear Button
    self.ClearButton = Utility.Create("TextButton", {
        Name = "Clear",
        Parent = self.DropdownButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -44, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(0, 0.5),
        Text = "",
        Visible = #self.Value > 0
    })
    
    Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = self.ClearButton,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Image = LucideIcons.X,
        ImageColor3 = Theme.TextTertiary
    })
    
    self.ClearButton.MouseButton1Click:Connect(function()
        self:Clear()
    end)
    
    -- Arrow Icon
    self.ArrowIcon = Utility.Create("ImageLabel", {
        Name = "Arrow",
        Parent = self.DropdownButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -28, 0.5, 0),
        Size = UDim2.new(0, 16, 0, 16),
        AnchorPoint = Vector2.new(0, 0.5),
        Image = LucideIcons.ChevronDown,
        ImageColor3 = Theme.TextSecondary
    })
    
    -- Create Dropdown Menu
    self:_CreateDropdownMenu()
    
    -- Setup Interactions
    self:_SetupInteractions()
end

function MultiDropdown:_CreateDropdownMenu()
    local itemHeight = 32
    local maxItems = self.Config.MaxVisibleItems
    local menuHeight = math.min(#self.Config.Options, maxItems) * itemHeight + (self.Config.Searchable and 40 or 8) + 40
    
    -- Menu Container
    self.MenuContainer = Utility.Create("Frame", {
        Name = "Menu",
        Parent = self.Container,
        BackgroundColor3 = Theme.DropdownBackground,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 14, 1, 4),
        Size = UDim2.new(1, -28, 0, 0),
        ClipsDescendants = true,
        Visible = false,
        ZIndex = 100
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = self.MenuContainer
    })
    
    Utility.Create("UIStroke", {
        Parent = self.MenuContainer,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Options Scroll Frame (same as regular dropdown)
    self.OptionsScroll = Utility.Create("ScrollingFrame", {
        Name = "Options",
        Parent = self.MenuContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 4, 0, 4),
        Size = UDim2.new(1, -8, 1, -48),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Theme.ScrollbarThumb,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        ZIndex = 101
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.OptionsScroll,
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 2)
    })
    
    -- Create Options
    self:_PopulateOptions()
    
    -- Action Buttons
    local actionsContainer = Utility.Create("Frame", {
        Name = "Actions",
        Parent = self.MenuContainer,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.5,
        Position = UDim2.new(0, 4, 1, -40),
        Size = UDim2.new(1, -8, 0, 36),
        ZIndex = 101
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = actionsContainer
    })
    
    Utility.Create("UIListLayout", {
        Parent = actionsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        Padding = UDim.new(0, 8)
    })
    
    Utility.Create("UIPadding", {
        Parent = actionsContainer,
        PaddingTop = UDim.new(0, 6),
        PaddingBottom = UDim.new(0, 6),
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8)
    })
    
    -- Select All Button
    local selectAllBtn = Utility.Create("TextButton", {
        Name = "SelectAll",
        Parent = actionsContainer,
        BackgroundColor3 = Theme.Primary,
        BackgroundTransparency = 0.5,
        Size = UDim2.new(0.5, -4, 1, 0),
        Text = "",
        AutoButtonColor = false,
        ZIndex = 102
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = selectAllBtn
    })
    
    Utility.Create("TextLabel", {
        Parent = selectAllBtn,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Theme.Font,
        Text = "Select All",
        TextColor3 = Theme.TextPrimary,
        TextSize = 11,
        ZIndex = 103
    })
    
    selectAllBtn.MouseButton1Click:Connect(function()
        self:SelectAll()
    end)
    
    -- Deselect All Button
    local deselectAllBtn = Utility.Create("TextButton", {
        Name = "DeselectAll",
        Parent = actionsContainer,
        BackgroundColor3 = Theme.Surface,
        BackgroundTransparency = 0.3,
        Size = UDim2.new(0.5, -4, 1, 0),
        Text = "",
        AutoButtonColor = false,
        ZIndex = 102
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusSmall,
        Parent = deselectAllBtn
    })
    
    Utility.Create("TextLabel", {
        Parent = deselectAllBtn,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Theme.Font,
        Text = "Clear All",
        TextColor3 = Theme.TextSecondary,
        TextSize = 11,
        ZIndex = 103
    })
    
    deselectAllBtn.MouseButton1Click:Connect(function()
        self:Clear()
    end)
end

function MultiDropdown:_PopulateOptions()
    -- Clear existing
    for _, child in ipairs(self.OptionsScroll:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    self.Options = {}
    
    -- Create options
    for i, option in ipairs(self.Config.Options) do
        local isSelected = table.find(self.Value, option) ~= nil
        
        local optionButton = Utility.Create("TextButton", {
            Name = "Option_" .. tostring(option),
            Parent = self.OptionsScroll,
            BackgroundColor3 = Theme.DropdownHover,
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 30),
            Text = "",
            AutoButtonColor = false,
            ZIndex = 102
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadiusSmall,
            Parent = optionButton
        })
        
        -- Checkbox
        local checkbox = Utility.Create("Frame", {
            Name = "Checkbox",
            Parent = optionButton,
            BackgroundColor3 = isSelected and Theme.Primary or Theme.Surface,
            Position = UDim2.new(0, 8, 0.5, 0),
            Size = UDim2.new(0, 18, 0, 18),
            AnchorPoint = Vector2.new(0, 0.5),
            ZIndex = 103
        })
        
        Utility.Create("UICorner", {
            CornerRadius = UDim.new(0, 4),
            Parent = checkbox
        })
        
        Utility.Create("UIStroke", {
            Parent = checkbox,
            Color = isSelected and Theme.Primary or Theme.Border,
            Thickness = 2
        })
        
        local checkIcon = Utility.Create("ImageLabel", {
            Name = "Check",
            Parent = checkbox,
            BackgroundTransparency = 1,
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 12, 0, 12),
            AnchorPoint = Vector2.new(0.5, 0.5),
            Image = LucideIcons.Check,
            ImageColor3 = Color3.fromRGB(255, 255, 255),
            ImageTransparency = isSelected and 0 or 1,
            ZIndex = 104
        })
        
        -- Option Text
        local optionText = Utility.Create("TextLabel", {
            Name = "Text",
            Parent = optionButton,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 34, 0, 0),
            Size = UDim2.new(1, -40, 1, 0),
            Font = Theme.Font,
            Text = tostring(option),
            TextColor3 = Theme.TextPrimary,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            ZIndex = 103
        })
        
        -- Interactions
        optionButton.MouseEnter:Connect(function()
            Utility.Tween(optionButton, {BackgroundTransparency = 0.5}, 0.1)
        end)
        
        optionButton.MouseLeave:Connect(function()
            Utility.Tween(optionButton, {BackgroundTransparency = 1}, 0.1)
        end)
        
        optionButton.MouseButton1Click:Connect(function()
            self:ToggleOption(option)
        end)
        
        self.Options[option] = {
            Button = optionButton,
            Checkbox = checkbox,
            Check = checkIcon,
            Text = optionText
        }
    end
end

function MultiDropdown:_SetupInteractions()
    -- Dropdown button click
    self.DropdownButton.MouseButton1Click:Connect(function()
        if not self.Enabled then return end
        self:Toggle()
    end)
    
    -- Hover
    self.DropdownButton.MouseEnter:Connect(function()
        if not self.Enabled then return end
        
        Utility.Tween(self.DropdownButton, {BackgroundTransparency = 0.1}, 0.15)
        Utility.Tween(self.DropdownStroke, {Transparency = 0.3}, 0.15)
    end)
    
    self.DropdownButton.MouseLeave:Connect(function()
        if not self.Enabled then return end
        
        if not self.Open then
            Utility.Tween(self.DropdownButton, {BackgroundTransparency = 0.3}, 0.15)
            Utility.Tween(self.DropdownStroke, {Transparency = 0.5}, 0.15)
        end
    end)
    
    -- Close on click outside (same as regular dropdown)
    local mainParent = self:_GetMainParent()
    if mainParent then
        table.insert(mainParent.Connections, UserInputService.InputBegan:Connect(function(input)
            if not self.Open then return end
            
            if input.UserInputType == Enum.UserInputType.MouseButton1 or
               input.UserInputType == Enum.UserInputType.Touch then
                
                local mousePos = input.Position
                local menuPos = self.MenuContainer.AbsolutePosition
                local menuSize = self.MenuContainer.AbsoluteSize
                local buttonPos = self.DropdownButton.AbsolutePosition
                local buttonSize = self.DropdownButton.AbsoluteSize
                
                local inMenu = mousePos.X >= menuPos.X and mousePos.X <= menuPos.X + menuSize.X and
                              mousePos.Y >= menuPos.Y and mousePos.Y <= menuPos.Y + menuSize.Y
                              
                local inButton = mousePos.X >= buttonPos.X and mousePos.X <= buttonPos.X + buttonSize.X and
                                mousePos.Y >= buttonPos.Y and mousePos.Y <= buttonPos.Y + buttonSize.Y
                
                if not inMenu and not inButton then
                    self:Close()
                end
            end
        end))
    end
end

function MultiDropdown:Toggle()
    if self.Open then
        self:Close()
    else
        self:OpenMenu()
    end
end

function MultiDropdown:OpenMenu()
    self.Open = true
    
    local itemHeight = 30
    local maxItems = self.Config.MaxVisibleItems
    local menuHeight = math.min(#self.Config.Options, maxItems) * itemHeight + 48
    
    self.MenuContainer.Visible = true
    
    Utility.Tween(self.MenuContainer, {Size = UDim2.new(1, -28, 0, menuHeight)}, 0.2, Enum.EasingStyle.Back)
    Utility.Tween(self.ArrowIcon, {Rotation = 180}, 0.2)
    Utility.Tween(self.DropdownStroke, {Color = Theme.Primary}, 0.2)
end

function MultiDropdown:Close()
    self.Open = false
    
    Utility.Tween(self.MenuContainer, {Size = UDim2.new(1, -28, 0, 0)}, 0.15)
    Utility.Tween(self.ArrowIcon, {Rotation = 0}, 0.2)
    Utility.Tween(self.DropdownStroke, {Color = Theme.Border}, 0.2)
    Utility.Tween(self.DropdownButton, {BackgroundTransparency = 0.3}, 0.15)
    
    task.delay(0.15, function()
        if not self.Open then
            self.MenuContainer.Visible = false
        end
    end)
end

function MultiDropdown:ToggleOption(option)
    local index = table.find(self.Value, option)
    
    if index then
        -- Deselect
        if self.Config.AllowEmpty or #self.Value > 1 then
            table.remove(self.Value, index)
            self:_UpdateOption(option, false)
        end
    else
        -- Select
        if not self.Config.MaxSelections or #self.Value < self.Config.MaxSelections then
            table.insert(self.Value, option)
            self:_UpdateOption(option, true)
        end
    end
    
    self:_UpdateDisplay()
    
    -- Update flag
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    -- Callback
    self.Changed:Fire(self.Value)
    
    task.spawn(function()
        self.Config.Callback(self.Value)
    end)
end

function MultiDropdown:_UpdateOption(option, selected)
    local elements = self.Options[option]
    if not elements then return end
    
    if selected then
        Utility.Tween(elements.Checkbox, {BackgroundColor3 = Theme.Primary}, 0.15)
        Utility.Tween(elements.Check, {ImageTransparency = 0}, 0.15)
    else
        Utility.Tween(elements.Checkbox, {BackgroundColor3 = Theme.Surface}, 0.15)
        Utility.Tween(elements.Check, {ImageTransparency = 1}, 0.15)
    end
end

function MultiDropdown:_UpdateDisplay()
    local count = #self.Value
    
    -- Update count badge
    if count > 0 then
        self.CountBadge.Visible = true
        self.CountLabel.Text = tostring(count)
        self.SelectedLabel.Position = UDim2.new(0, 36, 0, 0)
        self.SelectedLabel.Size = UDim2.new(1, -80, 1, 0)
        self.ClearButton.Visible = true
    else
        self.CountBadge.Visible = false
        self.SelectedLabel.Position = UDim2.new(0, 12, 0, 0)
        self.SelectedLabel.Size = UDim2.new(1, -56, 1, 0)
        self.ClearButton.Visible = false
    end
    
    -- Update selected text
    self.SelectedLabel.Text = self:_GetSelectedText()
    self.SelectedLabel.TextColor3 = count > 0 and Theme.TextPrimary or Theme.TextTertiary
end

function MultiDropdown:_GetSelectedText()
    if #self.Value == 0 then
        return self.Config.Placeholder
    elseif #self.Value == 1 then
        return tostring(self.Value[1])
    elseif #self.Value <= 3 then
        return table.concat(self.Value, ", ")
    else
        return tostring(self.Value[1]) .. ", " .. tostring(self.Value[2]) .. " +" .. (#self.Value - 2) .. " more"
    end
end

function MultiDropdown:SelectAll()
    self.Value = Utility.DeepCopy(self.Config.Options)
    
    for option, elements in pairs(self.Options) do
        self:_UpdateOption(option, true)
    end
    
    self:_UpdateDisplay()
    
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    self.Changed:Fire(self.Value)
    
    task.spawn(function()
        self.Config.Callback(self.Value)
    end)
end

function MultiDropdown:Clear()
    if not self.Config.AllowEmpty and #self.Value == 0 then return end
    
    self.Value = {}
    
    for option, elements in pairs(self.Options) do
        self:_UpdateOption(option, false)
    end
    
    self:_UpdateDisplay()
    
    if self.Config.Flag then
        self:_SetFlag()
    end
    
    self.Changed:Fire(self.Value)
    
    task.spawn(function()
        self.Config.Callback(self.Value)
    end)
end

function MultiDropdown:SetValue(value)
    self.Value = value or {}
    
    for option, elements in pairs(self.Options) do
        self:_UpdateOption(option, table.find(self.Value, option) ~= nil)
    end
    
    self:_UpdateDisplay()
    
    if self.Config.Flag then
        self:_SetFlag()
    end
end

function MultiDropdown:GetValue()
    return self.Value
end

function MultiDropdown:_SetFlag()
    local mainParent = self:_GetMainParent()
    if mainParent and mainParent.Flags then
        mainParent.Flags[self.Config.Flag] = self.Value
    end
    FlexUI.Flags[self.Config.Flag] = self.Value
end

function MultiDropdown:_GetMainParent()
    local parent = self.Parent
    while parent do
        if parent.Config and parent.Flags then
            return parent
        end
        if parent.Config and parent.Config.Parent then
            parent = parent.Config.Parent
        else
            break
        end
    end
    return nil
end

function MultiDropdown:SetEnabled(enabled)
    self.Enabled = enabled
    
    if enabled then
        self.Container.BackgroundTransparency = 0.5
        self.TitleLabel.TextTransparency = 0
        self.DropdownButton.BackgroundTransparency = 0.3
    else
        self.Container.BackgroundTransparency = 0.7
        self.TitleLabel.TextTransparency = 0.5
        self.DropdownButton.BackgroundTransparency = 0.6
        
        if self.Open then
            self:Close()
        end
    end
end

--[[
    FlexUI - Part 7 (FINAL)
    Notification System, Prompts, Context Menu, Final Integration
    Complete Professional UI Library
]]

--// Notification System
local NotificationManager = {}
NotificationManager.__index = NotificationManager
NotificationManager.Notifications = {}
NotificationManager.Queue = {}
NotificationManager.MaxVisible = 5
NotificationManager.Container = nil

function NotificationManager:Initialize()
    if self.Container then return end
    
    -- Create notification container
    self.Container = Utility.Create("Frame", {
        Name = "NotificationContainer",
        Parent = GetSafeParent(),
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 1, -20),
        Size = UDim2.new(0, 320, 0, 0),
        AnchorPoint = Vector2.new(1, 1),
        ZIndex = 1000
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.Container,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        VerticalAlignment = Enum.VerticalAlignment.Bottom,
        Padding = UDim.new(0, 10),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
end

function NotificationManager:Create(config)
    self:Initialize()
    
    local notification = {
        Title = config.Title or "Notification",
        Description = config.Description or config.Content or "",
        Type = config.Type or "Info", -- Info, Success, Warning, Error
        Duration = config.Duration or 5,
        Icon = config.Icon,
        Buttons = config.Buttons or {},
        Callback = config.Callback,
        Sound = config.Sound ~= false,
        Timestamp = tick()
    }
    
    -- Add to queue if too many visible
    if #self.Notifications >= self.MaxVisible then
        table.insert(self.Queue, notification)
        return
    end
    
    self:Show(notification)
end

function NotificationManager:Show(notification)
    table.insert(self.Notifications, notification)
    
    local typeConfigs = {
        Info = {
            Color = Theme.Info,
            Icon = LucideIcons.Info,
            Sound = "Notification"
        },
        Success = {
            Color = Theme.Success,
            Icon = LucideIcons.CheckCircle,
            Sound = "Success"
        },
        Warning = {
            Color = Theme.Warning,
            Icon = LucideIcons.AlertTriangle,
            Sound = "Error"
        },
        Error = {
            Color = Theme.Error,
            Icon = LucideIcons.XCircle,
            Sound = "Error"
        }
    }
    
    local typeConfig = typeConfigs[notification.Type] or typeConfigs.Info
    
    -- Create notification frame
    local frame = Utility.Create("Frame", {
        Name = "Notification",
        Parent = self.Container,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = #self.Notifications,
        ClipsDescendants = true
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = frame
    })
    
    local stroke = Utility.Create("UIStroke", {
        Parent = frame,
        Color = typeConfig.Color,
        Thickness = 2,
        Transparency = 1
    })
    
    -- Shadow
    Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = frame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 4),
        Size = UDim2.new(1, 20, 1, 20),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = -1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.3,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    Utility.Create("UIPadding", {
        Parent = frame,
        PaddingTop = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 14),
        PaddingRight = UDim.new(0, 14)
    })
    
    -- Top Bar (Icon, Title, Close)
    local topBar = Utility.Create("Frame", {
        Name = "TopBar",
        Parent = frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20)
    })
    
    -- Icon
    local icon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = topBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0, 20, 0, 20),
        Image = notification.Icon or typeConfig.Icon,
        ImageColor3 = typeConfig.Color
    })
    
    -- Title
    local title = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = topBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 28, 0, 0),
        Size = UDim2.new(1, -56, 1, 0),
        Font = Theme.FontBold,
        Text = notification.Title,
        TextColor3 = Theme.TextPrimary,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Close button
    local closeButton = Utility.Create("TextButton", {
        Name = "Close",
        Parent = topBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 0, 0),
        Size = UDim2.new(0, 20, 0, 20),
        Text = ""
    })
    
    local closeIcon = Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = closeButton,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Image = LucideIcons.X,
        ImageColor3 = Theme.TextTertiary
    })
    
    -- Description
    local description = Utility.Create("TextLabel", {
        Name = "Description",
        Parent = frame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 28),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = Theme.Font,
        Text = notification.Description,
        TextColor3 = Theme.TextSecondary,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true
    })
    
    -- Progress bar
    local progressBg = Utility.Create("Frame", {
        Name = "ProgressBg",
        Parent = frame,
        BackgroundColor3 = Theme.Border,
        BackgroundTransparency = 0.7,
        Position = UDim2.new(0, -14, 1, -4),
        Size = UDim2.new(1, 28, 0, 3)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = progressBg
    })
    
    local progress = Utility.Create("Frame", {
        Name = "Progress",
        Parent = progressBg,
        BackgroundColor3 = typeConfig.Color,
        Size = UDim2.new(1, 0, 1, 0)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = progress
    })
    
    -- Buttons (if any)
    if #notification.Buttons > 0 then
        local buttonsContainer = Utility.Create("Frame", {
            Name = "Buttons",
            Parent = frame,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 1, 0),
            Size = UDim2.new(1, 0, 0, 32),
            AnchorPoint = Vector2.new(0, 1)
        })
        
        Utility.Create("UIListLayout", {
            Parent = buttonsContainer,
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
            VerticalAlignment = Enum.VerticalAlignment.Center,
            Padding = UDim.new(0, 8)
        })
        
        for _, btnConfig in ipairs(notification.Buttons) do
            local button = Utility.Create("TextButton", {
                Name = btnConfig.Name or "Button",
                Parent = buttonsContainer,
                BackgroundColor3 = btnConfig.Primary and typeConfig.Color or Theme.Surface,
                BackgroundTransparency = 0.3,
                Size = UDim2.new(0, 0, 0, 28),
                AutomaticSize = Enum.AutomaticSize.X,
                Text = "",
                AutoButtonColor = false
            })
            
            Utility.Create("UICorner", {
                CornerRadius = Theme.CornerRadiusSmall,
                Parent = button
            })
            
            Utility.Create("UIPadding", {
                Parent = button,
                PaddingLeft = UDim.new(0, 12),
                PaddingRight = UDim.new(0, 12)
            })
            
            Utility.Create("TextLabel", {
                Parent = button,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Font = Theme.Font,
                Text = btnConfig.Name or "Button",
                TextColor3 = Theme.TextPrimary,
                TextSize = 11
            })
            
            button.MouseButton1Click:Connect(function()
                if btnConfig.Callback then
                    btnConfig.Callback()
                end
                self:Remove(notification, frame)
            end)
            
            button.MouseEnter:Connect(function()
                Utility.Tween(button, {BackgroundTransparency = 0.1}, 0.1)
            end)
            
            button.MouseLeave:Connect(function()
                Utility.Tween(button, {BackgroundTransparency = 0.3}, 0.1)
            end)
        end
    end
    
    -- Close button interaction
    closeButton.MouseEnter:Connect(function()
        Utility.Tween(closeIcon, {ImageColor3 = Theme.Error}, 0.15)
    end)
    
    closeButton.MouseLeave:Connect(function()
        Utility.Tween(closeIcon, {ImageColor3 = Theme.TextTertiary}, 0.15)
    end)
    
    closeButton.MouseButton1Click:Connect(function()
        self:Remove(notification, frame)
    end)
    
    -- Store reference
    notification.Frame = frame
    notification.Progress = progress
    
    -- Entrance animation
    Utility.Tween(frame, {BackgroundTransparency = 0.05}, 0.3)
    Utility.Tween(stroke, {Transparency = 0}, 0.3)
    
    -- Play sound
    if notification.Sound and typeConfig.Sound then
        PlaySound(typeConfig.Sound, 0.5)
    end
    
    -- Progress animation
    if notification.Duration > 0 then
        Utility.Tween(progress, {Size = UDim2.new(0, 0, 1, 0)}, notification.Duration, Enum.EasingStyle.Linear)
        
        task.delay(notification.Duration, function()
            self:Remove(notification, frame)
        end)
    end
end

function NotificationManager:Remove(notification, frame)
    -- Exit animation
    Utility.Tween(frame, {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0)
    }, 0.2)
    
    task.delay(0.2, function()
        frame:Destroy()
        
        -- Remove from list
        for i, n in ipairs(self.Notifications) do
            if n == notification then
                table.remove(self.Notifications, i)
                break
            end
        end
        
        -- Show queued notification
        if #self.Queue > 0 then
            local queued = table.remove(self.Queue, 1)
            self:Show(queued)
        end
    end)
end

function NotificationManager:Clear()
    for _, notification in ipairs(self.Notifications) do
        if notification.Frame then
            notification.Frame:Destroy()
        end
    end
    
    self.Notifications = {}
    self.Queue = {}
end

-- Add to FlexUI
function FlexUI:Notify(config)
    NotificationManager:Create(config)
end

--// Prompt/Dialog System
local PromptManager = {}
PromptManager.__index = PromptManager
PromptManager.ActivePrompt = nil

function PromptManager:Create(config)
    if self.ActivePrompt then
        self.ActivePrompt:Destroy()
    end
    
    local prompt = {
        Title = config.Title or "Prompt",
        Description = config.Description or "",
        Type = config.Type or "Info",
        Buttons = config.Buttons or {
            {Name = "OK", Primary = true}
        },
        Input = config.Input,
        CloseOnOutsideClick = config.CloseOnOutsideClick ~= false
    }
    
    -- Create overlay
    prompt.Overlay = Utility.Create("Frame", {
        Name = "PromptOverlay",
        Parent = GetSafeParent(),
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 2000
    })
    
    -- Blur effect
    prompt.Blur = Utility.Create("BlurEffect", {
        Name = "PromptBlur",
        Size = 0,
        Parent = Lighting
    })
    
    Utility.Tween(prompt.Blur, {Size = 10}, 0.3)
    Utility.Tween(prompt.Overlay, {BackgroundTransparency = 0.4}, 0.3)
    
    -- Prompt window
    prompt.Window = Utility.Create("Frame", {
        Name = "PromptWindow",
        Parent = prompt.Overlay,
        BackgroundColor3 = Theme.Background,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ClipsDescendants = true
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadiusLarge,
        Parent = prompt.Window
    })
    
    Utility.Create("UIStroke", {
        Parent = prompt.Window,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    -- Shadow
    Utility.Create("ImageLabel", {
        Name = "Shadow",
        Parent = prompt.Window,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 4),
        Size = UDim2.new(1, 40, 1, 40),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = -1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.3,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    Utility.Create("UIPadding", {
        Parent = prompt.Window,
        PaddingTop = UDim.new(0, 24),
        PaddingBottom = UDim.new(0, 20),
        PaddingLeft = UDim.new(0, 24),
        PaddingRight = UDim.new(0, 24)
    })
    
    -- Icon
    local typeIcons = {
        Info = {Icon = LucideIcons.Info, Color = Theme.Info},
        Success = {Icon = LucideIcons.CheckCircle, Color = Theme.Success},
        Warning = {Icon = LucideIcons.AlertTriangle, Color = Theme.Warning},
        Error = {Icon = LucideIcons.XCircle, Color = Theme.Error},
        Question = {Icon = LucideIcons.HelpCircle, Color = Theme.Primary}
    }
    
    local typeConfig = typeIcons[prompt.Type] or typeIcons.Info
    
    local iconContainer = Utility.Create("Frame", {
        Name = "IconContainer",
        Parent = prompt.Window,
        BackgroundColor3 = typeConfig.Color,
        BackgroundTransparency = 0.9,
        Position = UDim2.new(0.5, 0, 0, 0),
        Size = UDim2.new(0, 56, 0, 56),
        AnchorPoint = Vector2.new(0.5, 0)
    })
    
    Utility.Create("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = iconContainer
    })
    
    Utility.Create("ImageLabel", {
        Name = "Icon",
        Parent = iconContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 32, 0, 32),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Image = typeConfig.Icon,
        ImageColor3 = typeConfig.Color
    })
    
    -- Title
    Utility.Create("TextLabel", {
        Name = "Title",
        Parent = prompt.Window,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 68),
        Size = UDim2.new(1, 0, 0, 24),
        Font = Theme.FontBold,
        Text = prompt.Title,
        TextColor3 = Theme.TextPrimary,
        TextSize = 18,
        TextWrapped = true
    })
    
    -- Description
    Utility.Create("TextLabel", {
        Name = "Description",
        Parent = prompt.Window,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 100),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Font = Theme.Font,
        Text = prompt.Description,
        TextColor3 = Theme.TextSecondary,
        TextSize = 13,
        TextWrapped = true,
        TextYAlignment = Enum.TextYAlignment.Top
    })
    
    local contentHeight = 140
    
    -- Input field (if specified)
    if prompt.Input then
        contentHeight = contentHeight + 50
        
        local inputContainer = Utility.Create("Frame", {
            Name = "InputContainer",
            Parent = prompt.Window,
            BackgroundColor3 = Theme.Surface,
            BackgroundTransparency = 0.5,
            Position = UDim2.new(0, 0, 0, contentHeight - 50),
            Size = UDim2.new(1, 0, 0, 40)
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadius,
            Parent = inputContainer
        })
        
        prompt.InputBox = Utility.Create("TextBox", {
            Name = "Input",
            Parent = inputContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 12, 0, 0),
            Size = UDim2.new(1, -24, 1, 0),
            Font = Theme.Font,
            PlaceholderText = prompt.Input.Placeholder or "Enter text...",
            Text = prompt.Input.Default or "",
            TextColor3 = Theme.TextPrimary,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            ClearTextOnFocus = false
        })
        
        task.delay(0.3, function()
            prompt.InputBox:CaptureFocus()
        end)
    end
    
    -- Buttons
    local buttonsContainer = Utility.Create("Frame", {
        Name = "Buttons",
        Parent = prompt.Window,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, contentHeight),
        Size = UDim2.new(1, 0, 0, 40)
    })
    
    Utility.Create("UIListLayout", {
        Parent = buttonsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 10)
    })
    
    for _, btnConfig in ipairs(prompt.Buttons) do
        local button = Utility.Create("TextButton", {
            Name = btnConfig.Name or "Button",
            Parent = buttonsContainer,
            BackgroundColor3 = btnConfig.Primary and Theme.Primary or Theme.Surface,
            BackgroundTransparency = 0.2,
            Size = UDim2.new(0, 0, 1, 0),
            AutomaticSize = Enum.AutomaticSize.X,
            Text = "",
            AutoButtonColor = false
        })
        
        Utility.Create("UICorner", {
            CornerRadius = Theme.CornerRadius,
            Parent = button
        })
        
        Utility.Create("UIPadding", {
            Parent = button,
            PaddingLeft = UDim.new(0, 20),
            PaddingRight = UDim.new(0, 20)
        })
        
        Utility.Create("TextLabel", {
            Parent = button,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Font = Theme.Font,
            Text = btnConfig.Name or "Button",
            TextColor3 = Theme.TextPrimary,
            TextSize = 13
        })
        
        button.MouseEnter:Connect(function()
            Utility.Tween(button, {BackgroundTransparency = 0}, 0.15)
        end)
        
        button.MouseLeave:Connect(function()
            Utility.Tween(button, {BackgroundTransparency = 0.2}, 0.15)
        end)
        
        button.MouseButton1Click:Connect(function()
            local inputValue = prompt.InputBox and prompt.InputBox.Text or nil
            
            if btnConfig.Callback then
                btnConfig.Callback(inputValue)
            end
            
            self:Close(prompt)
        end)
    end
    
    contentHeight = contentHeight + 60
    
    -- Animate open
    Utility.Tween(prompt.Window, {Size = UDim2.new(0, 420, 0, contentHeight)}, 0.3, Enum.EasingStyle.Back)
    
    -- Click outside to close
    if prompt.CloseOnOutsideClick then
        prompt.Overlay.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                local mousePos = input.Position
                local windowPos = prompt.Window.AbsolutePosition
                local windowSize = prompt.Window.AbsoluteSize
                
                local inWindow = mousePos.X >= windowPos.X and mousePos.X <= windowPos.X + windowSize.X and
                                mousePos.Y >= windowPos.Y and mousePos.Y <= windowPos.Y + windowSize.Y
                
                if not inWindow then
                    self:Close(prompt)
                end
            end
        end)
    end
    
    self.ActivePrompt = prompt
    PlaySound("Open", 0.5)
end

function PromptManager:Close(prompt)
    Utility.Tween(prompt.Window, {Size = UDim2.new(0, 0, 0, 0)}, 0.2)
    Utility.Tween(prompt.Overlay, {BackgroundTransparency = 1}, 0.2)
    Utility.Tween(prompt.Blur, {Size = 0}, 0.2)
    
    task.delay(0.2, function()
        prompt.Overlay:Destroy()
        prompt.Blur:Destroy()
        
        if self.ActivePrompt == prompt then
            self.ActivePrompt = nil
        end
    end)
    
    PlaySound("Close", 0.3)
end

-- Add to FlexUI
function FlexUI:Prompt(config)
    PromptManager:Create(config)
end

function FlexUI:Confirm(title, description, callback)
    PromptManager:Create({
        Title = title,
        Description = description,
        Type = "Question",
        Buttons = {
            {
                Name = "Cancel",
                Callback = function()
                    if callback then callback(false) end
                end
            },
            {
                Name = "Confirm",
                Primary = true,
                Callback = function()
                    if callback then callback(true) end
                end
            }
        }
    })
end

function FlexUI:Input(title, description, placeholder, callback)
    PromptManager:Create({
        Title = title,
        Description = description,
        Type = "Info",
        Input = {
            Placeholder = placeholder
        },
        Buttons = {
            {
                Name = "Cancel"
            },
            {
                Name = "Submit",
                Primary = true,
                Callback = callback
            }
        }
    })
end

--// Context Menu System
local ContextMenu = {}
ContextMenu.__index = ContextMenu
ContextMenu.ActiveMenu = nil

function ContextMenu:Create(config)
    if self.ActiveMenu then
        self.ActiveMenu:Destroy()
    end
    
    local menu = {
        Items = config.Items or {},
        Position = config.Position or UDim2.new(0, Mouse.X, 0, Mouse.Y)
    }
    
    -- Create menu frame
    menu.Frame = Utility.Create("Frame", {
        Name = "ContextMenu",
        Parent = GetSafeParent(),
        BackgroundColor3 = Theme.Background,
        Position = menu.Position,
        Size = UDim2.new(0, 200, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ZIndex = 3000,
        ClipsDescendants = true
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = menu.Frame
    })
    
    Utility.Create("UIStroke", {
        Parent = menu.Frame,
        Color = Theme.Border,
        Thickness = 1,
        Transparency = 0.5
    })
    
    Utility.Create("UIPadding", {
        Parent = menu.Frame,
        PaddingTop = UDim.new(0, 6),
        PaddingBottom = UDim.new(0, 6),
        PaddingLeft = UDim.new(0, 6),
        PaddingRight = UDim.new(0, 6)
    })
    
    Utility.Create("UIListLayout", {
        Parent = menu.Frame,
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 2)
    })
    
    -- Create items
    for _, item in ipairs(menu.Items) do
        if item.Type == "Separator" then
            Utility.Create("Frame", {
                Name = "Separator",
                Parent = menu.Frame,
                BackgroundColor3 = Theme.Border,
                BackgroundTransparency = 0.5,
                Size = UDim2.new(1, -12, 0, 1)
            })
        else
            local itemButton = Utility.Create("TextButton", {
                Name = item.Name or "Item",
                Parent = menu.Frame,
                BackgroundColor3 = Theme.Surface,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 32),
                Text = "",
                AutoButtonColor = false
            })
            
            Utility.Create("UICorner", {
                CornerRadius = Theme.CornerRadiusSmall,
                Parent = itemButton
            })
            
            -- Icon
            if item.Icon then
                Utility.Create("ImageLabel", {
                    Name = "Icon",
                    Parent = itemButton,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 8, 0.5, 0),
                    Size = UDim2.new(0, 16, 0, 16),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Image = item.Icon,
                    ImageColor3 = item.Color or Theme.TextSecondary
                })
            end
            
            -- Text
            Utility.Create("TextLabel", {
                Name = "Text",
                Parent = itemButton,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, item.Icon and 32 or 12, 0, 0),
                Size = UDim2.new(1, -(item.Icon and 32 or 12) - 12, 1, 0),
                Font = Theme.Font,
                Text = item.Name or "Item",
                TextColor3 = item.Color or Theme.TextPrimary,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            -- Hover
            itemButton.MouseEnter:Connect(function()
                Utility.Tween(itemButton, {BackgroundTransparency = 0.5}, 0.1)
            end)
            
            itemButton.MouseLeave:Connect(function()
                Utility.Tween(itemButton, {BackgroundTransparency = 1}, 0.1)
            end)
            
            -- Click
            itemButton.MouseButton1Click:Connect(function()
                if item.Callback then
                    item.Callback()
                end
                self:Close(menu)
            end)
        end
    end
    
    -- Position adjustment (keep on screen)
    local screenSize = Camera.ViewportSize
    local menuSize = menu.Frame.AbsoluteSize
    local pos = menu.Position
    
    if pos.X.Offset + menuSize.X > screenSize.X then
        pos = UDim2.new(0, screenSize.X - menuSize.X - 10, pos.Y.Scale, pos.Y.Offset)
    end
    
    if pos.Y.Offset + menuSize.Y > screenSize.Y then
        pos = UDim2.new(pos.X.Scale, pos.X.Offset, 0, screenSize.Y - menuSize.Y - 10)
    end
    
    menu.Frame.Position = pos
    
    -- Click outside to close
    local connection
    connection = UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
           input.UserInputType == Enum.UserInputType.MouseButton2 then
            
            local mousePos = input.Position
            local framePos = menu.Frame.AbsolutePosition
            local frameSize = menu.Frame.AbsoluteSize
            
            local inMenu = mousePos.X >= framePos.X and mousePos.X <= framePos.X + frameSize.X and
                          mousePos.Y >= framePos.Y and mousePos.Y <= framePos.Y + frameSize.Y
            
            if not inMenu then
                self:Close(menu)
                connection:Disconnect()
            end
        end
    end)
    
    self.ActiveMenu = menu
    PlaySound("Dropdown", 0.3)
end

function ContextMenu:Close(menu)
    if menu.Frame then
        menu.Frame:Destroy()
    end
    
    if self.ActiveMenu == menu then
        self.ActiveMenu = nil
    end
end

-- Add to FlexUI
function FlexUI:ContextMenu(config)
    ContextMenu:Create(config)
end

--// Utility Functions for Library
function FlexUI:SetTheme(themeName)
    if ThemePresets[themeName] then
        for key, value in pairs(ThemePresets[themeName]) do
            Theme[key] = value
        end
        
        -- Update all windows
        for _, window in ipairs(self.Windows) do
            -- You would update window colors here
        end
    end
end

function FlexUI:GetFlag(flag)
    return self.Flags[flag]
end

function FlexUI:SetFlag(flag, value)
    self.Flags[flag] = value
end

function FlexUI:DestroyAll()
    -- Destroy all windows
    for i = #self.Windows, 1, -1 do
        self.Windows[i]:Destroy()
    end
    
    -- Clear notifications
    NotificationManager:Clear()
    
    -- Close prompt
    if PromptManager.ActivePrompt then
        PromptManager:Close(PromptManager.ActivePrompt)
    end
    
    -- Close context menu
    if ContextMenu.ActiveMenu then
        ContextMenu:Close(ContextMenu.ActiveMenu)
    end
end

--// Anti-AFK System
function FlexUI:EnableAntiAFK()
    local VirtualUser = game:GetService("VirtualUser")
    
    local connection = LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
        
        self:Notify({
            Title = "Anti-AFK",
            Description = "Prevented idle kick",
            Type = "Info",
            Duration = 3
        })
    end)
    
    table.insert(self.Connections, connection)
end

--// FPS Counter
function FlexUI:AddFPSCounter()
    local fpsLabel = Utility.Create("TextLabel", {
        Name = "FPSCounter",
        Parent = GetSafeParent(),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.3,
        Position = UDim2.new(1, -120, 0, 10),
        Size = UDim2.new(0, 110, 0, 30),
        Font = Theme.Font,
        Text = "FPS: 60",
        TextColor3 = Theme.Success,
        TextSize = 13,
        ZIndex = 999
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = fpsLabel
    })
    
    local lastUpdate = tick()
    local frames = 0
    
    local connection = RunService.RenderStepped:Connect(function()
        frames = frames + 1
        
        if tick() - lastUpdate >= 1 then
            local fps = frames
            frames = 0
            lastUpdate = tick()
            
            fpsLabel.Text = "FPS: " .. tostring(fps)
            
            if fps >= 50 then
                fpsLabel.TextColor3 = Theme.Success
            elseif fps >= 30 then
                fpsLabel.TextColor3 = Theme.Warning
            else
                fpsLabel.TextColor3 = Theme.Error
            end
        end
    end)
    
    table.insert(self.Connections, connection)
    
    return fpsLabel
end

--// Watermark
function FlexUI:AddWatermark(text)
    local watermark = Utility.Create("TextLabel", {
        Name = "Watermark",
        Parent = GetSafeParent(),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.3,
        Position = UDim2.new(0, 10, 0, 10),
        Size = UDim2.new(0, 0, 0, 30),
        AutomaticSize = Enum.AutomaticSize.X,
        Font = Theme.FontBold,
        Text = "  " .. (text or "FlexUI v" .. self.Version) .. "  ",
        TextColor3 = Theme.Primary,
        TextSize = 13,
        ZIndex = 999
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = watermark
    })
    
    Utility.Create("UIGradient", {
        Parent = watermark,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Theme.Primary),
            ColorSequenceKeypoint.new(1, Theme.Secondary)
        }),
        Rotation = 45
    })
    
    return watermark
end

--// Key System (Simple)
function FlexUI:CreateKeySystem(config)
    local keySystem = {
        Key = config.Key,
        Title = config.Title or "Key System",
        Description = config.Description or "Enter the key to continue",
        ValidateURL = config.ValidateURL,
        OnSuccess = config.OnSuccess or function() end,
        OnFail = config.OnFail or function() end
    }
    
    self:Prompt({
        Title = keySystem.Title,
        Description = keySystem.Description,
        Type = "Info",
        Input = {
            Placeholder = "Enter key..."
        },
        Buttons = {
            {
                Name = "Get Key",
                Callback = function()
                    if config.GetKeyURL then
                        setclipboard(config.GetKeyURL)
                        self:Notify({
                            Title = "Key System",
                            Description = "Link copied to clipboard!",
                            Type = "Success",
                            Duration = 3
                        })
                    end
                end
            },
            {
                Name = "Submit",
                Primary = true,
                Callback = function(key)
                    if key == keySystem.Key then
                        self:Notify({
                            Title = "Key System",
                            Description = "Key accepted! Loading...",
                            Type = "Success",
                            Duration = 3
                        })
                        keySystem.OnSuccess()
                    else
                        self:Notify({
                            Title = "Key System",
                            Description = "Invalid key!",
                            Type = "Error",
                            Duration = 3
                        })
                        keySystem.OnFail()
                    end
                end
            }
        },
        CloseOnOutsideClick = false
    })
end

--// Discord Invite
function FlexUI:CopyDiscordInvite(inviteCode)
    local fullLink = "https://discord.gg/" .. inviteCode
    
    if setclipboard then
        setclipboard(fullLink)
        self:Notify({
            Title = "Discord",
            Description = "Invite link copied to clipboard!",
            Type = "Success",
            Duration = 3
        })
    else
        self:Notify({
            Title = "Discord",
            Description = "Clipboard not supported",
            Type = "Warning",
            Duration = 3
        })
    end
end

--// Performance Monitor
function FlexUI:CreatePerformanceMonitor()
    local monitor = Utility.Create("Frame", {
        Name = "PerformanceMonitor",
        Parent = GetSafeParent(),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.2,
        Position = UDim2.new(0, 10, 1, -120),
        Size = UDim2.new(0, 200, 0, 110),
        ZIndex = 998
    })
    
    Utility.Create("UICorner", {
        CornerRadius = Theme.CornerRadius,
        Parent = monitor
    })
    
    Utility.Create("UIPadding", {
        Parent = monitor,
        PaddingTop = UDim.new(0, 8),
        PaddingBottom = UDim.new(0, 8),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10)
    })
    
    local stats = {
        {Name = "FPS", Getter = function() return Stats.FrameRate end, Suffix = ""},
        {Name = "Ping", Getter = function() return Stats.Network.ServerStatsItem["Data Ping"]:GetValue() end, Suffix = " ms"},
        {Name = "Memory", Getter = function() return math.floor(Stats:GetTotalMemoryUsageMb()) end, Suffix = " MB"}
    }
    
    local labels = {}
    
    for i, stat in ipairs(stats) do
        local label = Utility.Create("TextLabel", {
            Name = stat.Name,
            Parent = monitor,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, (i - 1) * 30),
            Size = UDim2.new(1, 0, 0, 24),
            Font = Theme.Font,
            Text = stat.Name .. ": 0" .. stat.Suffix,
            TextColor3 = Theme.TextPrimary,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        labels[stat.Name] = {Label = label, Stat = stat}
    end
    
    -- Update loop
    local connection = RunService.RenderStepped:Connect(function()
        for _, data in pairs(labels) do
            local value = data.Stat.Getter()
            local rounded = Utility.Round(value, 0)
            data.Label.Text = data.Stat.Name .. ": " .. tostring(rounded) .. data.Stat.Suffix
        end
    end)
    
    table.insert(self.Connections, connection)
    
    return monitor
end

--// Example Usage Documentation
--[[

EXAMPLE USAGE:

-- Create window
local window = FlexUI.new({
    Title = "My Script",
    SubTitle = "v1.0.0",
    Size = UDim2.new(0, 580, 0, 460),
    Theme = "Dark", -- or "Midnight", "Ocean", etc.
    SaveConfig = true,
    ConfigName = "MyConfig"
})

-- Add tabs
local mainTab = window:AddTab({Name = "Main", Icon = LucideIcons.Home})
local settingsTab = window:AddTab({Name = "Settings", Icon = LucideIcons.Settings})

-- Add section
local section = mainTab:AddSection({
    Name = "Features",
    Description = "Main features"
})

-- Add elements
section:AddButton({
    Name = "Click Me",
    Description = "This is a button",
    Callback = function()
        print("Button clicked!")
    end
})

section:AddToggle({
    Name = "Auto Farm",
    Default = false,
    Flag = "AutoFarm",
    Callback = function(value)
        print("Auto Farm:", value)
    end
})

section:AddSlider({
    Name = "Speed",
    Min = 0,
    Max = 100,
    Default = 50,
    Flag = "Speed",
    Callback = function(value)
        print("Speed:", value)
    end
})

section:AddDropdown({
    Name = "Weapon",
    Options = {"Sword", "Gun", "Bow"},
    Default = "Sword",
    Callback = function(value)
        print("Selected:", value)
    end
})

section:AddColorPicker({
    Name = "ESP Color",
    Default = Color3.fromRGB(255, 0, 0),
    Callback = function(color)
        print("Color:", color)
    end
})

section:AddKeybind({
    Name = "Toggle Menu",
    Default = Enum.KeyCode.RightControl,
    Callback = function(active)
        print("Keybind:", active)
    end
})

-- Notifications
window:Notify({
    Title = "Script Loaded",
    Description = "Welcome to FlexUI!",
    Type = "Success",
    Duration = 5
})

-- Prompts
window:Confirm("Delete Item", "Are you sure?", function(confirmed)
    if confirmed then
        print("Deleted!")
    end
end)

-- Save/Load configs
window:SaveConfig("MyConfig")
window:LoadConfig("MyConfig")

]]

--// Final Print
print([[

                                                           
                       
                     
                           
                           
                   
                      
                                                           
          Professional Roblox UI Library v2.0              
                                                           
    Fully Loaded - All Parts Complete                   
    Mobile & PC Compatible                               
    Executor Compatible (]] .. ExecutorName .. [[)                      
    Device: ]] .. DeviceType .. [[                                      
                                                           
   Features:                                               
    Window System with Tabs & Sections                   
    15+ Interactive Elements                             
    Color Picker with RGB/HEX/HSV                        
    Keybind System                                       
    Notification System                                  
    Prompt/Dialog System                                 
    Context Menu                                         
    Config Save/Load                                     
    Theme System                                         
    Smooth Animations                                    
                                                           

]])

print("[FlexUI] Part 7 Loaded - Notification System & Final Integration")
print("[FlexUI] Library fully loaded and ready to use!")
print("[FlexUI] Thank you for using FlexUI!")

return FlexUI
